"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports["default"] = prompt;

var _onETX = _interopRequireDefault(require("./onETX"));

var _asynchronous = require("../../utilities/asynchronous");

var _constants = require("../../constants");

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { "default": obj }; }

function prompt(options, callback) {
  var answer = options.answer;

  if (answer !== undefined) {
    callback(answer);
    return;
  }

  answer = null;
  var _options$attempts = options.attempts,
      attempts = _options$attempts === void 0 ? _constants.DEFAULT_ATTEMPTS : _options$attempts,
      context = {
    answer: answer,
    attempts: attempts,
    options: options
  };
  (0, _asynchronous.whilst)(attempt, function () {
    var answer = context.answer;
    callback(answer);
  }, context);
}

function attempt(next, done, context) {
  var attempts = context.attempts;
  var terminate = attempts-- === 0;

  if (terminate) {
    done();
    return;
  }

  var options = context.options,
      _options$hidden = options.hidden,
      hidden = _options$hidden === void 0 ? false : _options$hidden,
      _options$encoding = options.encoding,
      encoding = _options$encoding === void 0 ? _constants.DEFAULT_ENCODING : _options$encoding,
      description = options.description,
      errorMessage = options.errorMessage,
      _options$initialAnswe = options.initialAnswer,
      initialAnswer = _options$initialAnswe === void 0 ? _constants.DEFAULT_INITIAL_ANSWER : _options$initialAnswe,
      validationPattern = options.validationPattern,
      validationFunction = options.validationFunction;
  input(description, initialAnswer, encoding, hidden, callback);

  function callback(answer) {
    var valid = validationFunction ? ///
    validationFunction(answer) : validationPattern.test(answer);

    if (valid) {
      Object.assign(context, {
        answer: answer
      });
      done();
    } else {
      console.log(errorMessage);
      Object.assign(context, {
        attempts: attempts
      });
      next();
    }
  }
}

function input(description, initialAnswer, encoding, hidden, callback) {
  var answer = initialAnswer; ///

  var event = _constants.DATA_EVENT,
      rawMode = true,
      offETX = (0, _onETX["default"])(function () {
    console.log(_constants.CTRL_C);
    process.exit();
  });
  process.stdin.setEncoding(encoding);
  process.stdin.setRawMode(rawMode);
  process.stdout.write(description);

  if (!hidden) {
    process.stdout.write(answer);
  }

  process.stdin.resume();
  process.stdin.on(event, listener);

  function listener(chunk) {
    var character = chunk.toString(encoding);

    switch (character) {
      case _constants.LINE_FEED_CHARACTER:
      case _constants.CARRIAGE_RETURN_CHARACTER:
        process.stdout.write(_constants.LINE_FEED_CHARACTER);
        process.stdin.removeListener(event, listener);
        process.stdin.pause();
        offETX();
        callback(answer);
        break;

      case _constants.BACKSPACE_CHARACTER:
        answer = answer.slice(0, answer.length - 1);
        process.stdout.clearLine();
        process.stdout.cursorTo(0);
        process.stdout.write(description);

        if (!hidden) {
          process.stdout.write(answer);
        }

        break;

      default:
        answer += character;

        if (!hidden) {
          process.stdout.clearLine();
          process.stdout.cursorTo(0);
          process.stdout.write(description);
          process.stdout.write(answer);
        }

        break;
    }
  }
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInByb21wdC5qcyJdLCJuYW1lcyI6WyJwcm9tcHQiLCJvcHRpb25zIiwiY2FsbGJhY2siLCJhbnN3ZXIiLCJ1bmRlZmluZWQiLCJhdHRlbXB0cyIsIkRFRkFVTFRfQVRURU1QVFMiLCJjb250ZXh0IiwiYXR0ZW1wdCIsIm5leHQiLCJkb25lIiwidGVybWluYXRlIiwiaGlkZGVuIiwiZW5jb2RpbmciLCJERUZBVUxUX0VOQ09ESU5HIiwiZGVzY3JpcHRpb24iLCJlcnJvck1lc3NhZ2UiLCJpbml0aWFsQW5zd2VyIiwiREVGQVVMVF9JTklUSUFMX0FOU1dFUiIsInZhbGlkYXRpb25QYXR0ZXJuIiwidmFsaWRhdGlvbkZ1bmN0aW9uIiwiaW5wdXQiLCJ2YWxpZCIsInRlc3QiLCJPYmplY3QiLCJhc3NpZ24iLCJjb25zb2xlIiwibG9nIiwiZXZlbnQiLCJEQVRBX0VWRU5UIiwicmF3TW9kZSIsIm9mZkVUWCIsIkNUUkxfQyIsInByb2Nlc3MiLCJleGl0Iiwic3RkaW4iLCJzZXRFbmNvZGluZyIsInNldFJhd01vZGUiLCJzdGRvdXQiLCJ3cml0ZSIsInJlc3VtZSIsIm9uIiwibGlzdGVuZXIiLCJjaHVuayIsImNoYXJhY3RlciIsInRvU3RyaW5nIiwiTElORV9GRUVEX0NIQVJBQ1RFUiIsIkNBUlJJQUdFX1JFVFVSTl9DSEFSQUNURVIiLCJyZW1vdmVMaXN0ZW5lciIsInBhdXNlIiwiQkFDS1NQQUNFX0NIQVJBQ1RFUiIsInNsaWNlIiwibGVuZ3RoIiwiY2xlYXJMaW5lIiwiY3Vyc29yVG8iXSwibWFwcGluZ3MiOiJBQUFBOzs7Ozs7O0FBRUE7O0FBRUE7O0FBRUE7Ozs7QUFTZSxTQUFTQSxNQUFULENBQWdCQyxPQUFoQixFQUF5QkMsUUFBekIsRUFBbUM7QUFBQSxNQUMxQ0MsTUFEMEMsR0FDL0JGLE9BRCtCLENBQzFDRSxNQUQwQzs7QUFHaEQsTUFBSUEsTUFBTSxLQUFLQyxTQUFmLEVBQTBCO0FBQ3hCRixJQUFBQSxRQUFRLENBQUNDLE1BQUQsQ0FBUjtBQUVB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QWYsQ0FBcUJ4QixXQUFyQjs7QUFFQSxZQUFJLENBQUNILE1BQUwsRUFBYTtBQUNYcUIsVUFBQUEsT0FBTyxDQUFDSyxNQUFSLENBQWVDLEtBQWYsQ0FBcUJwQyxNQUFyQjtBQUNEOztBQUVEOztBQUVGO0FBQ0VBLFFBQUFBLE1BQU0sSUFBSXlDLFNBQVY7O0FBRUEsWUFBSSxDQUFDaEMsTUFBTCxFQUFhO0FBQ1hxQixVQUFBQSxPQUFPLENBQUNLLE1BQVIsQ0FBZWUsU0FBZjtBQUVBcEIsVUFBQUEsT0FBTyxDQUFDSyxNQUFSLENBQWVnQixRQUFmLENBQXdCLENBQXhCO0FBRUFyQixVQUFBQSxPQUFPLENBQUNLLE1BQVIsQ0FBZUMsS0FBZixDQUFxQnhCLFdBQXJCO0FBRUFrQixVQUFBQSxPQUFPLENBQUNLLE1BQVIsQ0FBZUMsS0FBZixDQUFxQnBDLE1BQXJCO0FBQ0Q7O0FBRUQ7QUEzQ0o7QUE2Q0Q7QUFDRiIsInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiO1xuXG5pbXBvcnQgb25FVFggZnJvbSBcIi4vb25FVFhcIjtcblxuaW1wb3J0IHsgd2hpbHN0IH0gZnJvbSBcIi4uLy4uL3V0aWxpdGllcy9hc3luY2hyb25vdXNcIjtcblxuaW1wb3J0IHsgQ1RSTF9DLFxuICAgICAgICAgREFUQV9FVkVOVCxcbiAgICAgICAgIERFRkFVTFRfRU5DT0RJTkcsXG4gICAgICAgICBERUZBVUxUX0FUVEVNUFRTLFxuICAgICAgICAgQkFDS1NQQUNFX0NIQVJBQ1RFUixcbiAgICAgICAgIExJTkVfRkVFRF9DSEFSQUNURVIsXG4gICAgICAgICBERUZBVUxUX0lOSVRJQUxfQU5TV0VSLFxuICAgICAgICAgQ0FSUklBR0VfUkVUVVJOX0NIQVJBQ1RFUiB9IGZyb20gXCIuLi8uLi9jb25zdGFudHNcIjtcblxuZXhwb3J0IGRlZmF1bHQgZnVuY3Rpb24gcHJvbXB0KG9wdGlvbnMsIGNhbGxiYWNrKSB7XG4gIGxldCB7IGFuc3dlciB9ID0gb3B0aW9ucztcblxuICBpZiAoYW5zd2VyICE9PSB1bmRlZmluZWQpIHtcbiAgICBjYWxsYmFjayhhbnN3ZXIpO1xuXG4gICAgcmV0dXJuO1xuICB9XG5cbiAgYW5zd2VyID0gbnVsbDtcblxuICBjb25zdCB7IGF0dGVtcHRzID0gREVGQVVMVF9BVFRFTVBUUyB9ID0gb3B0aW9ucyxcbiAgICAgICAgY29udGV4dCA9IHtcbiAgICAgICAgICBhbnN3ZXIsXG4gICAgICAgICAgYXR0ZW1wdHMsXG4gICAgICAgICAgb3B0aW9uc1xuICAgICAgICB9O1xuXG4gIHdoaWxzdChhdHRlbXB0LCAoKSA9PiB7XG4gICAgY29uc3QgeyBhbnN3ZXIgfSA9IGNvbnRleHQ7XG4gICAgXG4gICAgY2FsbGJhY2soYW5zd2VyKTtcbiAgfSwgY29udGV4dCk7XG59XG5cbmZ1bmN0aW9uIGF0dGVtcHQobmV4dCwgZG9uZSwgY29udGV4dCkge1xuICBsZXQgeyBhdHRlbXB0cyB9ID0gY29udGV4dDtcblxuICBjb25zdCB0ZXJtaW5hdGUgPSAoYXR0ZW1wdHMtLSA9PT0gMCk7XG4gIFxuICBpZiAodGVybWluYXRlKSB7XG4gICAgZG9uZSgpO1xuICAgIFxuICAgIHJldHVybjtcbiAgfVxuXG4gIGNvbnN0IHsgb3B0aW9ucyB9ID0gY29udGV4dCxcbiAgICAgICAgeyBoaWRkZW4gPSBmYWxzZSxcbiAgICAgICAgICBlbmNvZGluZyA9IERFRkFVTFRfRU5DT0RJTkcsXG4gICAgICAgICAgZGVzY3JpcHRpb24sXG4gICAgICAgICAgZXJyb3JNZXNzYWdlLFxuICAgICAgICAgIGluaXRpYWxBbnN3ZXIgPSBERUZBVUxUX0lOSVRJQUxfQU5TV0VSLFxuICAgICAgICAgIHZhbGlkYXRpb25QYXR0ZXJuLFxuICAgICAgICAgIHZhbGlkYXRpb25GdW5jdGlvbiB9ID0gb3B0aW9ucztcblxuICBpbnB1dChkZXNjcmlwdGlvbiwgaW5pdGlhbEFuc3dlciwgZW5jb2RpbmcsIGhpZGRlbiwgY2FsbGJhY2spO1xuXG4gIGZ1bmN0aW9uIGNhbGxiYWNrKGFuc3dlcikge1xuICAgIGNvbnN0IHZhbGlkID0gdmFsaWRhdGlvbkZ1bmN0aW9uID8gIC8vL1xuICAgICAgICAgICAgICAgICAgICB2YWxpZGF0aW9uRnVuY3Rpb24oYW5zd2VyKSA6XG4gICAgICAgICAgICAgICAgICAgICAgdmFsaWRhdGlvblBhdHRlcm4udGVzdChhbnN3ZXIpO1xuXG4gICAgaWYgKHZhbGlkKSB7XG4gICAgICBPYmplY3QuYXNzaWduKGNvbnRleHQsIHtcbiAgICAgICAgYW5zd2VyXG4gICAgICB9KTtcblxuICAgICAgZG9uZSgpO1xuICAgIH0gZWxzZSB7XG4gICAgICBjb25zb2xlLmxvZyhlcnJvck1lc3NhZ2UpO1xuXG4gICAgICBPYmplY3QuYXNzaWduKGNvbnRleHQsIHtcbiAgICAgICAgYXR0ZW1wdHNcbiAgICAgIH0pO1xuXG4gICAgICBuZXh0KCk7XG4gICAgfVxuICB9XG59XG5cbmZ1bmN0aW9uIGlucHV0KGRlc2NyaXB0aW9uLCBpbml0aWFsQW5zd2VyLCBlbmNvZGluZywgaGlkZGVuLCBjYWxsYmFjaykge1xuICBsZXQgYW5zd2VyID0gaW5pdGlhbEFuc3dlcjsgLy8vXG5cbiAgY29uc3QgZXZlbnQgPSBEQVRBX0VWRU5ULFxuICAgICAgICByYXdNb2RlID0gdHJ1ZSxcbiAgICAgICAgb2ZmRVRYID0gb25FVFgoKCkgPT4ge1xuICAgICAgICAgIGNvbnNvbGUubG9nKENUUkxfQyk7XG5cbiAgICAgICAgICBwcm9jZXNzLmV4aXQoKTtcbiAgICAgICAgfSk7XG5cbiAgcHJvY2Vzcy5zdGRpbi5zZXRFbmNvZGluZyhlbmNvZGluZyk7XG5cbiAgcHJvY2Vzcy5zdGRpbi5zZXRSYXdNb2RlKHJhd01vZGUpO1xuXG4gIHByb2Nlc3Muc3Rkb3V0LndyaXRlKGRlc2NyaXB0aW9uKTtcblxuICBpZiAoIWhpZGRlbikge1xuICAgIHByb2Nlc3Muc3Rkb3V0LndyaXRlKGFuc3dlcik7XG4gIH1cblxuICBwcm9jZXNzLnN0ZGluLnJlc3VtZSgpO1xuXG4gIHByb2Nlc3Muc3RkaW4ub24oZXZlbnQsIGxpc3RlbmVyKTtcblxuICBmdW5jdGlvbiBsaXN0ZW5lcihjaHVuaykge1xuICAgIGNvbnN0IGNoYXJhY3RlciA9IGNodW5rLnRvU3RyaW5nKGVuY29kaW5nKTtcblxuICAgIHN3aXRjaCAoY2hhcmFjdGVyKSB7XG4gICAgICBjYXNlIExJTkVfRkVFRF9DSEFSQUNURVIgOlxuICAgICAgY2FzZSBDQVJSSUFHRV9SRVRVUk5fQ0hBUkFDVEVSIDpcbiAgICAgICAgcHJvY2Vzcy5zdGRvdXQud3JpdGUoTElORV9GRUVEX0NIQVJBQ1RFUik7XG5cbiAgICAgICAgcHJvY2Vzcy5zdGRpbi5yZW1vdmVMaXN0ZW5lcihldmVudCwgbGlzdGVuZXIpO1xuXG4gICAgICAgIHByb2Nlc3Muc3RkaW4ucGF1c2UoKTtcblxuICAgICAgICBvZmZFVFgoKTtcblxuICAgICAgICBjYWxsYmFjayhhbnN3ZXIpO1xuXG4gICAgICAgIGJyZWFrO1xuXG4gICAgICBjYXNlIEJBQ0tTUEFDRV9DSEFSQUNURVIgOlxuICAgICAgICBhbnN3ZXIgPSBhbnN3ZXIuc2xpY2UoMCwgYW5zd2VyLmxlbmd0aCAtIDEpO1xuXG4gICAgICAgIHByb2Nlc3Muc3Rkb3V0LmNsZWFyTGluZSgpO1xuXG4gICAgICAgIHByb2Nlc3Muc3Rkb3V0LmN1cnNvclRvKDApO1xuXG4gICAgICAgIHByb2Nlc3Muc3Rkb3V0LndyaXRlKGRlc2NyaXB0aW9uKTtcblxuICAgICAgICBpZiAoIWhpZGRlbikge1xuICAgICAgICAgIHByb2Nlc3Muc3Rkb3V0LndyaXRlKGFuc3dlcik7XG4gICAgICAgIH1cblxuICAgICAgICBicmVhaztcblxuICAgICAgZGVmYXVsdDpcbiAgICAgICAgYW5zd2VyICs9IGNoYXJhY3RlcjtcblxuICAgICAgICBpZiAoIWhpZGRlbikge1xuICAgICAgICAgIHByb2Nlc3Muc3Rkb3V0LmNsZWFyTGluZSgpO1xuXG4gICAgICAgICAgcHJvY2Vzcy5zdGRvdXQuY3Vyc29yVG8oMCk7XG5cbiAgICAgICAgICBwcm9jZXNzLnN0ZG91dC53cml0ZShkZXNjcmlwdGlvbik7XG5cbiAgICAgICAgICBwcm9jZXNzLnN0ZG91dC53cml0ZShhbnN3ZXIpO1xuICAgICAgICB9XG5cbiAgICAgICAgYnJlYWs7XG4gICAgfVxuICB9XG59XG4iXX0=