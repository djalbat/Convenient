'use strict';

var path = require('path');

var pathUtilities = require('../../utilities/path'),
    arrayUtilities = require('../../utilities/array'),
    fileSystemUtilities = require('../../utilities/fileSystem');

var second = arrayUtilities.second,
    concatenatePaths = pathUtilities.concatenatePaths,
    checkFileExists = fileSystemUtilities.checkFileExists,
    readFile = fileSystemUtilities.readFile,
    appendToFile = fileSystemUtilities.appendToFile,
    renameFile = fileSystemUtilities.renameFile,
    getStats = fileSystemUtilities.getStats;


var TRACE = 'TRACE',
    DEBUG = 'DEBUG',
    INFO = 'INFO',
    WARNING = 'WARNING',
    ERROR = 'ERROR',
    FATAL = 'FATAL';

var logLevel = WARNING,
    logFileBaseName = 'default',
    logDirectoryPath = null;

function log(message) {
  var level = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : '';

  var pertinentStackMessageIndex = 2;

  var levels = [TRACE, DEBUG, INFO, WARNING, ERROR, FATAL];

  if (level) {
    ///
    var levelIndex = levels.indexOf(level),
        logLevelIndex = levels.indexOf(logLevel);

    if (levelIndex < logLevelIndex) {
      return;
    }

    pertinentStackMessageIndex += 1;

    level = level + ' '; ///
  }

  var error = new Error(),
      stack = error.stack,
      stackMessages = stack.split(/\r\n|\n/),
      pertinentStackMessage = stackMessages[pertinentStackMessageIndex],
      currentDateAndTimeString = getCurrentDateAndTimeString(),
      filePath = filePathFromStackMessage(pertinentStackMessage),
      lineNumber = lineNumberFromStackMessage(pertinentStackMessage),
      logMessage = '' + level + currentDateAndTimeString + ' ' + filePath + '(' + lineNumber + ') ' + message;


  console.log(logMessage);

  if (logDirectoryPath !== null) {
    rollOverLogFile();

    var logFilePath = getLogFilePath(),
        logFileContent = logMessage + '\n';

    appendToFile(logFilePath, logFileContent);
  }

  return logMessage;
}

function trace(message) {
  return log(message, TRACE);
}

function debug(message) {
  return log(message, DEBUG);
}

function info(message) {
  return log(message, INFO);
}

function warning(message) {
  return log(message, WARNING);
}

function error(message) {
  return log(message, ERROR);
}

function fatal(message) {
  return log(message, FATAL);
}

function setLogLevel(level) {
  logLevel = level;
}

function setLogFileBaseName(fileBaseName) {
  logFileBaseName = fileBaseName;
}

function setLogDirectoryPath(directoryPath) {
  logDirectoryPath = directoryPath;
}

function getLogFileContent() {
  var logFilePath = getLogFilePath(),
      logFileContent = readFile(logFilePath);

  return logFileContent;
}

Object.assign(log, {
  TRACE: TRACE,
  DEBUG: DEBUG,
  INFO: INFO,
  WARNING: WARNING,
  ERROR: ERROR,
  FATAL: FATAL,
  trace: trace,
  debug: debug,
  info: info,
  warning: warning,
  error: error,
  fatal: fatal,
  setLogLevel: setLogLevel,
  setLogFileBaseName: setLogFileBaseName,
  setLogDirectoryPath: setLogDirectoryPath,
  getLogFileContent: getLogFileContent
});

module.exports = log;

function getLogFilePath() {
  var logFileName = logFileBaseName + '.log',
      logFilePath = concatenatePaths(logDirectoryPath, logFileName);

  return logFilePath;
}

function getRolledOverLogFilePath() {
  var currentDateString = getCurrentDateString(),
      rolledOverLogFileName = logFileBaseName + '.' + currentDateString + '.log',
      rolledOverLogFilePath = concatenatePaths(logDirectoryPath, rolledOverLogFileName);

  return rolledOverLogFilePath;
}

function getLogFileLastModifiedDate() {
  var logFilePath = getLogFilePath(),
      logFileStats = getStats(logFilePath),
      mtime = logFileStats.mtime,
      logFileLastModifiedDate = new Date(mtime); ///

  return logFileLastModifiedDate;
}

function rollOverLogFile() {
  var logFilePath = getLogFilePath(),
      logFileExists = checkFileExists(logFilePath);

  if (!logFileExists) {
    return;
  }

  var logFileLastModifiedDate = getLogFileLastModifiedDate(),
      logFileLastModifiedDateCurrentDate = isDateCurrentDate(logFileLastModifiedDate);

  if (!logFileLastModifiedDateCurrentDate) {
    var rolledOverLogFilePath = getRolledOverLogFilePath();

    renameFile(logFilePath, rolledOverLogFilePath);
  }
}

function isDateCurrentDate(date) {
  var currentDate = new Date(),
      dateString = date.toDateString(),
      currentDateString = currentDate.toDateString(),
      dateCurrentDate = dateString === currentDateString;

  return dateCurrentDate;
}

function getCurrentDateString() {
  var date = new Date(),
      day = padStartWithZeroes(date.getDate(), 2),
      ///
  month = padStartWithZeroes(date.getMonth() + 1, 2),
      ///
  year = date.getFullYear(),
      currentDateAndTimeString = day + '-' + month + '-' + year;

  return currentDateAndTimeString;
}

function getCurrentDateAndTimeString() {
  var date = new Date(),
      day = padStartWithZeroes(date.getDate(), 2),
      ///
  month = padStartWithZeroes(date.getMonth() + 1, 2),
      ///
  year = date.getFullYear(),
      hours = padStartWithZeroes(date.getHours(), 2),
      minutes = padStartWithZeroes(date.getMinutes(), 2),
      seconds = padStartWithZeroes(date.getSeconds(), 2),
      milliseconds = padStartWithZeroes(date.getMilliseconds(), 3),
      currentDateAndTimeString = day + '-' + month + '-' + year + ' ' + hours + ':' + minutes + ':' + seconds + '.' + milliseconds;

  return currentDateAndTimeString;
}

function filePathFromStackMessage(stackMessage) {
  var matches = stackMessage.match(/(\/.+)\:\d+\:\d+/),
      secondMatch = second(matches),
      absoluteFilePath = secondMatch,
      ///
  currentWorkingDirectoryPath = path.resolve('.'),
      ///
  currentWorkingDirectoryPathLength = currentWorkingDirectoryPath.length,
      start = currentWorkingDirectoryPathLength + 1,
      ///
  filePath = absoluteFilePath.substr(start);

  return filePath;
}

function lineNumberFromStackMessage(stackMessage) {
  var matches = stackMessage.match(/\:(\d+)/),
      secondMatch = second(matches),
      lineNumber = secondMatch; ///

  return lineNumber;
}

function padStartWithZeroes(string, targetLength) {
  var padString = '0',
      paddedString = padStart(string, targetLength, padString);

  return paddedString;
}

function padStart(string, targetLength, padString) {
  var padding = '';

  for (var index = 0; index < targetLength; index++) {
    padding += padString;
  }

  var paddedString = ('' + padding + string).substr(-targetLength);

  return paddedString;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL2VzNi91dGlsaXRpZXMvbWlzY2VsbGFuZW91cy9sb2cuanMiXSwibmFtZXMiOlsicGF0aCIsInJlcXVpcmUiLCJwYXRoVXRpbGl0aWVzIiwiYXJyYXlVdGlsaXRpZXMiLCJmaWxlU3lzdGVtVXRpbGl0aWVzIiwic2Vjb25kIiwiY29uY2F0ZW5hdGVQYXRocyIsImNoZWNrRmlsZUV4aXN0cyIsInJlYWRGaWxlIiwiYXBwZW5kVG9GaWxlIiwicmVuYW1lRmlsZSIsImdldFN0YXRzIiwiVFJBQ0UiLCJERUJVRyIsIklORk8iLCJXQVJOSU5HIiwiRVJST1IiLCJGQVRBTCIsImxvZ0xldmVsIiwibG9nRmlsZUJhc2VOYW1lIiwibG9nRGlyZWN0b3J5UGF0aCIsImxvZyIsIm1lc3NhZ2UiLCJsZXZlbCIsInBlcnRpbmVudFN0YWNrTWVzc2FnZUluZGV4IiwibGV2ZWxzIiwibGV2ZWxJbmRleCIsImluZGV4T2YiLCJsb2dMZXZlbEluZGV4IiwiRXJyb3IiLCJzdGFjayIsImVycm9yIiwic3RhY2tNZXNzYWdlcyIsInNwbGl0IiwicGVydGluZW50U3RhY2tNZXNzYWdlIiwiY3VycmVudERhdGVBbmRUaW1lU3RyaW5nIiwiZ2V0Q3VycmVudERhdGVBbmRUaW1lU3RyaW5nIiwiZmlsZVBhdGgiLCJmaWxlUGF0aEZyb21TdGFja01lc3NhZ2UiLCJsaW5lTnVtYmVyIiwibGluZU51bWJlckZyb21TdGFja01lc3NhZ2UiLCJsb2dNZXNzYWdlIiwiY29uc29sZSIsInJvbGxPdmVyTG9nRmlsZSIsImxvZ0ZpbGVQYXRoIiwiZ2V0TG9nRmlsZVBhdGgiLCJsb2dGaWxlQ29udGVudCIsInRyYWNlIiwiZGVidWciLCJpbmZvIiwid2FybmluZyIsImZhdGFsIiwic2V0TG9nTGV2ZWwiLCJzZXRMb2dGaWxlQmFzZU5hbWUiLCJmaWxlQmFzZU5hbWUiLCJzZXRMb2dEaXJlY3RvcnlQYXRoIiwiZGlyZWN0b3J5UGF0aCIsImdldExvZ0ZpbGVDb250ZW50IiwiT2JqZWN0IiwiYXNzaWduIiwibW9kdWxlIiwiZXhwb3J0cyIsImxvZ0ZpbGVOYW1lIiwiZ2V0Um9sbGVkT3ZlckxvZ0ZpbGVQYXRoIiwiY3VycmVudERhdGVTdHJpbmciLCJnZXRDdXJyZW50RGF0ZVN0cmluZyIsInJvbGxlZE92ZXJMb2dGaWxlTmFtZSIsInJvbGxlZE92ZXJMb2dGaWxlUGF0aCIsImdldExvZ0ZpbGVMYXN0TW9kaWZpZWREYXRlIiwibG9nRmlsZVN0YXRzIiwibXRpbWUiLCJsb2dGaWxlTGFzdE1vZGlmaWVkRGF0ZSIsIkRhdGUiLCJsb2dGaWxlRXhpc3RzIiwibG9nRmlsZUxhc3RNb2RpZmllZERhdGVDdXJyZW50RGF0ZSIsImlzRGF0ZUN1cnJlbnREYXRlIiwiZGF0ZSIsImN1cnJlbnREYXRlIiwiZGF0ZVN0cmluZyIsInRvRGF0ZVN0cmluZyIsImRhdGVDdXJyZW50RGF0ZSIsImRheSIsInBhZFN0YXJ0V2l0aFplcm9lcyIsImdldERhdGUiLCJtb250aCIsImdldE1vbnRoIiwieWVhciIsImdldEZ1bGxZZWFyIiwiaG91cnMiLCJnZXRIb3VycyIsIm1pbnV0ZXMiLCJnZXRNaW51dGVzIiwic2Vjb25kcyIsImdldFNlY29uZHMiLCJtaWxsaXNlY29uZHMiLCJnZXRNaWxsaXNlY29uZHMiLCJzdGFja01lc3NhZ2UiLCJtYXRjaGVzIiwibWF0Y2giLCJzZWNvbmRNYXRjaCIsImFic29sdXRlRmlsZVBhdGgiLCJjdXJyZW50V29ya2luZ0RpcmVjdG9yeVBhdGgiLCJyZXNvbHZlIiwiY3VycmVudFdvcmtpbmdEaXJlY3RvcnlQYXRoTGVuZ3RoIiwibGVuZ3RoIiwic3RhcnQiLCJzdWJzdHIiLCJzdHJpbmciLCJ0YXJnZXRMZW5ndGgiLCJwYWRTdHJpbmciLCJwYWRkZWRTdHJpbmciLCJwYWRTdGFydCIsInBhZGRpbmciLCJpbmRleCJdLCJtYXBwaW5ncyI6IkFBQUE7O0FBRUEsSUFBTUEsT0FBT0MsUUFBUSxNQUFSLENBQWI7O0FBRUEsSUFBTUMsZ0JBQWdCRCxRQUFRLHNCQUFSLENBQXRCO0FB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QkEsUUFBUUwsWUFBNUIsRUFBMENLLE9BQTFDLEVBQW1EO0FBQ2pERCxlQUFXSCxTQUFYO0FBQ0Q7O0FBRUQsTUFBTUMsZUFBZSxNQUFHRSxPQUFILEdBQWFMLE1BQWIsRUFBc0JELE1BQXRCLENBQTZCLENBQUNFLFlBQTlCLENBQXJCOztBQUVBLFNBQU9FLFlBQVA7QUFDRCIsImZpbGUiOiJsb2cuanMiLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIHN0cmljdCc7XG5cbmNvbnN0IHBhdGggPSByZXF1aXJlKCdwYXRoJyk7XG5cbmNvbnN0IHBhdGhVdGlsaXRpZXMgPSByZXF1aXJlKCcuLi8uLi91dGlsaXRpZXMvcGF0aCcpLFxuICAgICAgYXJyYXlVdGlsaXRpZXMgPSByZXF1aXJlKCcuLi8uLi91dGlsaXRpZXMvYXJyYXknKSxcbiAgICAgIGZpbGVTeXN0ZW1VdGlsaXRpZXMgPSByZXF1aXJlKCcuLi8uLi91dGlsaXRpZXMvZmlsZVN5c3RlbScpO1xuXG5jb25zdCB7IHNlY29uZCB9ID0gYXJyYXlVdGlsaXRpZXMsXG4gICAgICB7IGNvbmNhdGVuYXRlUGF0aHMgfSA9IHBhdGhVdGlsaXRpZXMsXG4gICAgICB7IGNoZWNrRmlsZUV4aXN0cywgcmVhZEZpbGUsIGFwcGVuZFRvRmlsZSwgcmVuYW1lRmlsZSwgZ2V0U3RhdHMgfSA9IGZpbGVTeXN0ZW1VdGlsaXRpZXM7XG5cbmNvbnN0IFRSQUNFID0gJ1RSQUNFJyxcbiAgICAgIERFQlVHID0gJ0RFQlVHJyxcbiAgICAgIElORk8gPSAnSU5GTycsXG4gICAgICBXQVJOSU5HID0gJ1dBUk5JTkcnLFxuICAgICAgRVJST1IgPSAnRVJST1InLFxuICAgICAgRkFUQUwgPSAnRkFUQUwnO1xuXG5sZXQgbG9nTGV2ZWwgPSBXQVJOSU5HLFxuICAgIGxvZ0ZpbGVCYXNlTmFtZSA9ICdkZWZhdWx0JyxcbiAgICBsb2dEaXJlY3RvcnlQYXRoID0gbnVsbDtcblxuZnVuY3Rpb24gbG9nKG1lc3NhZ2UsIGxldmVsID0gJycpIHtcbiAgbGV0IHBlcnRpbmVudFN0YWNrTWVzc2FnZUluZGV4ID0gMjtcblxuICBjb25zdCBsZXZlbHMgPSBbXG4gICAgVFJBQ0UsXG4gICAgREVCVUcsXG4gICAgSU5GTyxcbiAgICBXQVJOSU5HLFxuICAgIEVSUk9SLFxuICAgIEZBVEFMXG4gIF07XG5cbiAgaWYgKGxldmVsKSB7IC8vL1xuICAgIGNvbnN0IGxldmVsSW5kZXggPSBsZXZlbHMuaW5kZXhPZihsZXZlbCksXG4gICAgICAgICAgbG9nTGV2ZWxJbmRleCA9IGxldmVscy5pbmRleE9mKGxvZ0xldmVsKTtcblxuICAgIGlmIChsZXZlbEluZGV4IDwgbG9nTGV2ZWxJbmRleCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHBlcnRpbmVudFN0YWNrTWVzc2FnZUluZGV4ICs9IDE7XG5cbiAgICBsZXZlbCA9IGAke2xldmVsfSBgOyAgLy8vXG4gIH1cblxuICBjb25zdCBlcnJvciA9IG5ldyBFcnJvcigpLFxuICAgICAgICB7IHN0YWNrIH0gPSBlcnJvcixcbiAgICAgICAgc3RhY2tNZXNzYWdlcyA9IHN0YWNrLnNwbGl0KC9cXHJcXG58XFxuLyksXG4gICAgICAgIHBlcnRpbmVudFN0YWNrTWVzc2FnZSA9IHN0YWNrTWVzc2FnZXNbcGVydGluZW50U3RhY2tNZXNzYWdlSW5kZXhdLFxuICAgICAgICBjdXJyZW50RGF0ZUFuZFRpbWVTdHJpbmcgPSBnZXRDdXJyZW50RGF0ZUFuZFRpbWVTdHJpbmcoKSxcbiAgICAgICAgZmlsZVBhdGggPSBmaWxlUGF0aEZyb21TdGFja01lc3NhZ2UocGVydGluZW50U3RhY2tNZXNzYWdlKSxcbiAgICAgICAgbGluZU51bWJlciA9IGxpbmVOdW1iZXJGcm9tU3RhY2tNZXNzYWdlKHBlcnRpbmVudFN0YWNrTWVzc2FnZSksXG4gICAgICAgIGxvZ01lc3NhZ2UgPSBgJHtsZXZlbH0ke2N1cnJlbnREYXRlQW5kVGltZVN0cmluZ30gJHtmaWxlUGF0aH0oJHtsaW5lTnVtYmVyfSkgJHttZXNzYWdlfWA7XG5cbiAgY29uc29sZS5sb2cobG9nTWVzc2FnZSk7XG5cbiAgaWYgKGxvZ0RpcmVjdG9yeVBhdGggIT09IG51bGwpIHtcbiAgICByb2xsT3ZlckxvZ0ZpbGUoKTtcblxuICAgIGNvbnN0IGxvZ0ZpbGVQYXRoID0gZ2V0TG9nRmlsZVBhdGgoKSxcbiAgICAgICAgICBsb2dGaWxlQ29udGVudCA9IGAke2xvZ01lc3NhZ2V9XFxuYDtcblxuICAgIGFwcGVuZFRvRmlsZShsb2dGaWxlUGF0aCwgbG9nRmlsZUNvbnRlbnQpO1xuICB9XG5cbiAgcmV0dXJuIGxvZ01lc3NhZ2U7XG59XG5cbmZ1bmN0aW9uIHRyYWNlKG1lc3NhZ2UpIHsgcmV0dXJuIGxvZyhtZXNzYWdlLCBUUkFDRSk7IH1cblxuZnVuY3Rpb24gZGVidWcobWVzc2FnZSkgeyByZXR1cm4gbG9nKG1lc3NhZ2UsIERFQlVHKTsgfVxuXG5mdW5jdGlvbiBpbmZvKG1lc3NhZ2UpIHsgcmV0dXJuIGxvZyhtZXNzYWdlLCBJTkZPKTsgfVxuXG5mdW5jdGlvbiB3YXJuaW5nKG1lc3NhZ2UpIHsgcmV0dXJuIGxvZyhtZXNzYWdlLCBXQVJOSU5HKTsgfVxuXG5mdW5jdGlvbiBlcnJvcihtZXNzYWdlKSB7IHJldHVybiBsb2cobWVzc2FnZSwgRVJST1IpOyB9XG5cbmZ1bmN0aW9uIGZhdGFsKG1lc3NhZ2UpIHsgcmV0dXJuIGxvZyhtZXNzYWdlLCBGQVRBTCk7IH1cblxuZnVuY3Rpb24gc2V0TG9nTGV2ZWwobGV2ZWwpIHsgbG9nTGV2ZWwgPSBsZXZlbDsgfVxuXG5mdW5jdGlvbiBzZXRMb2dGaWxlQmFzZU5hbWUoZmlsZUJhc2VOYW1lKSB7IGxvZ0ZpbGVCYXNlTmFtZSA9IGZpbGVCYXNlTmFtZTsgfVxuXG5mdW5jdGlvbiBzZXRMb2dEaXJlY3RvcnlQYXRoKGRpcmVjdG9yeVBhdGgpIHsgbG9nRGlyZWN0b3J5UGF0aCA9IGRpcmVjdG9yeVBhdGg7IH1cblxuZnVuY3Rpb24gZ2V0TG9nRmlsZUNvbnRlbnQoKSB7XG4gIGNvbnN0IGxvZ0ZpbGVQYXRoID0gZ2V0TG9nRmlsZVBhdGgoKSxcbiAgICAgICAgbG9nRmlsZUNvbnRlbnQgPSByZWFkRmlsZShsb2dGaWxlUGF0aCk7XG5cbiAgcmV0dXJuIGxvZ0ZpbGVDb250ZW50O1xufVxuXG5PYmplY3QuYXNzaWduKGxvZywge1xuICBUUkFDRTogVFJBQ0UsXG4gIERFQlVHOiBERUJVRyxcbiAgSU5GTzogSU5GTyxcbiAgV0FSTklORzogV0FSTklORyxcbiAgRVJST1I6IEVSUk9SLFxuICBGQVRBTDogRkFUQUwsXG4gIHRyYWNlOiB0cmFjZSxcbiAgZGVidWc6IGRlYnVnLFxuICBpbmZvOiBpbmZvLFxuICB3YXJuaW5nOiB3YXJuaW5nLFxuICBlcnJvcjogZXJyb3IsXG4gIGZhdGFsOiBmYXRhbCxcbiAgc2V0TG9nTGV2ZWw6IHNldExvZ0xldmVsLFxuICBzZXRMb2dGaWxlQmFzZU5hbWU6IHNldExvZ0ZpbGVCYXNlTmFtZSxcbiAgc2V0TG9nRGlyZWN0b3J5UGF0aDogc2V0TG9nRGlyZWN0b3J5UGF0aCxcbiAgZ2V0TG9nRmlsZUNvbnRlbnQ6IGdldExvZ0ZpbGVDb250ZW50XG59KTtcblxubW9kdWxlLmV4cG9ydHMgPSBsb2c7XG5cbmZ1bmN0aW9uIGdldExvZ0ZpbGVQYXRoKCkge1xuICBjb25zdCBsb2dGaWxlTmFtZSA9IGAke2xvZ0ZpbGVCYXNlTmFtZX0ubG9nYCxcbiAgICAgICAgbG9nRmlsZVBhdGggPSBjb25jYXRlbmF0ZVBhdGhzKGxvZ0RpcmVjdG9yeVBhdGgsIGxvZ0ZpbGVOYW1lKTtcblxuICByZXR1cm4gbG9nRmlsZVBhdGg7XG59XG5cbmZ1bmN0aW9uIGdldFJvbGxlZE92ZXJMb2dGaWxlUGF0aCgpIHtcbiAgY29uc3QgY3VycmVudERhdGVTdHJpbmcgPSBnZXRDdXJyZW50RGF0ZVN0cmluZygpLFxuICAgICAgICByb2xsZWRPdmVyTG9nRmlsZU5hbWUgPSBgJHtsb2dGaWxlQmFzZU5hbWV9LiR7Y3VycmVudERhdGVTdHJpbmd9LmxvZ2AsXG4gICAgICAgIHJvbGxlZE92ZXJMb2dGaWxlUGF0aCA9IGNvbmNhdGVuYXRlUGF0aHMobG9nRGlyZWN0b3J5UGF0aCwgcm9sbGVkT3ZlckxvZ0ZpbGVOYW1lKTtcblxuICByZXR1cm4gcm9sbGVkT3ZlckxvZ0ZpbGVQYXRoO1xufVxuXG5mdW5jdGlvbiBnZXRMb2dGaWxlTGFzdE1vZGlmaWVkRGF0ZSgpIHtcbiAgY29uc3QgbG9nRmlsZVBhdGggPSBnZXRMb2dGaWxlUGF0aCgpLFxuICAgICAgICBsb2dGaWxlU3RhdHMgPSBnZXRTdGF0cyhsb2dGaWxlUGF0aCksXG4gICAgICAgIHsgbXRpbWUgfSA9IGxvZ0ZpbGVTdGF0cyxcbiAgICAgICAgbG9nRmlsZUxhc3RNb2RpZmllZERhdGUgPSBuZXcgRGF0ZShtdGltZSk7ICAvLy9cblxuICByZXR1cm4gbG9nRmlsZUxhc3RNb2RpZmllZERhdGU7XG59XG5cbmZ1bmN0aW9uIHJvbGxPdmVyTG9nRmlsZSgpIHtcbiAgY29uc3QgbG9nRmlsZVBhdGggPSBnZXRMb2dGaWxlUGF0aCgpLFxuICAgICAgICBsb2dGaWxlRXhpc3RzID0gY2hlY2tGaWxlRXhpc3RzKGxvZ0ZpbGVQYXRoKTtcblxuICBpZiAoIWxvZ0ZpbGVFeGlzdHMpIHtcbiAgICByZXR1cm47XG4gIH1cblxuICBjb25zdCBsb2dGaWxlTGFzdE1vZGlmaWVkRGF0ZSA9IGdldExvZ0ZpbGVMYXN0TW9kaWZpZWREYXRlKCksXG4gICAgICAgIGxvZ0ZpbGVMYXN0TW9kaWZpZWREYXRlQ3VycmVudERhdGUgPSBpc0RhdGVDdXJyZW50RGF0ZShsb2dGaWxlTGFzdE1vZGlmaWVkRGF0ZSk7XG5cbiAgaWYgKCFsb2dGaWxlTGFzdE1vZGlmaWVkRGF0ZUN1cnJlbnREYXRlKSB7XG4gICAgY29uc3Qgcm9sbGVkT3ZlckxvZ0ZpbGVQYXRoID0gZ2V0Um9sbGVkT3ZlckxvZ0ZpbGVQYXRoKCk7XG5cbiAgICByZW5hbWVGaWxlKGxvZ0ZpbGVQYXRoLCByb2xsZWRPdmVyTG9nRmlsZVBhdGgpO1xuICB9XG59XG5cbmZ1bmN0aW9uIGlzRGF0ZUN1cnJlbnREYXRlKGRhdGUpIHtcbiAgY29uc3QgY3VycmVudERhdGUgPSBuZXcgRGF0ZSgpLFxuICAgICAgICBkYXRlU3RyaW5nID0gZGF0ZS50b0RhdGVTdHJpbmcoKSxcbiAgICAgICAgY3VycmVudERhdGVTdHJpbmcgPSBjdXJyZW50RGF0ZS50b0RhdGVTdHJpbmcoKSxcbiAgICAgICAgZGF0ZUN1cnJlbnREYXRlID0gKGRhdGVTdHJpbmcgPT09IGN1cnJlbnREYXRlU3RyaW5nKTtcblxuICByZXR1cm4gZGF0ZUN1cnJlbnREYXRlO1xufVxuXG5mdW5jdGlvbiBnZXRDdXJyZW50RGF0ZVN0cmluZygpIHtcbiAgY29uc3QgZGF0ZSA9IG5ldyBEYXRlKCksXG4gICAgICAgIGRheSA9IHBhZFN0YXJ0V2l0aFplcm9lcyhkYXRlLmdldERhdGUoKSwgMiksICAvLy9cbiAgICAgICAgbW9udGggPSBwYWRTdGFydFdpdGhaZXJvZXMoZGF0ZS5nZXRNb250aCgpICsgMSwgMiksIC8vL1xuICAgICAgICB5ZWFyID0gZGF0ZS5nZXRGdWxsWWVhcigpLFxuICAgICAgICBjdXJyZW50RGF0ZUFuZFRpbWVTdHJpbmcgPSBgJHtkYXl9LSR7bW9udGh9LSR7eWVhcn1gO1xuXG4gIHJldHVybiBjdXJyZW50RGF0ZUFuZFRpbWVTdHJpbmc7XG59XG5cbmZ1bmN0aW9uIGdldEN1cnJlbnREYXRlQW5kVGltZVN0cmluZygpIHtcbiAgY29uc3QgZGF0ZSA9IG5ldyBEYXRlKCksXG4gICAgICAgIGRheSA9IHBhZFN0YXJ0V2l0aFplcm9lcyhkYXRlLmdldERhdGUoKSwgMiksICAvLy9cbiAgICAgICAgbW9udGggPSBwYWRTdGFydFdpdGhaZXJvZXMoZGF0ZS5nZXRNb250aCgpICsgMSwgMiksIC8vL1xuICAgICAgICB5ZWFyID0gZGF0ZS5nZXRGdWxsWWVhcigpLFxuICAgICAgICBob3VycyA9IHBhZFN0YXJ0V2l0aFplcm9lcyhkYXRlLmdldEhvdXJzKCksIDIpLFxuICAgICAgICBtaW51dGVzID0gcGFkU3RhcnRXaXRoWmVyb2VzKGRhdGUuZ2V0TWludXRlcygpLCAyKSxcbiAgICAgICAgc2Vjb25kcyA9IHBhZFN0YXJ0V2l0aFplcm9lcyhkYXRlLmdldFNlY29uZHMoKSwgMiksXG4gICAgICAgIG1pbGxpc2Vjb25kcyA9IHBhZFN0YXJ0V2l0aFplcm9lcyhkYXRlLmdldE1pbGxpc2Vjb25kcygpLCAzKSxcbiAgICAgICAgY3VycmVudERhdGVBbmRUaW1lU3RyaW5nID0gYCR7ZGF5fS0ke21vbnRofS0ke3llYXJ9ICR7aG91cnN9OiR7bWludXRlc306JHtzZWNvbmRzfS4ke21pbGxpc2Vjb25kc31gO1xuXG4gIHJldHVybiBjdXJyZW50RGF0ZUFuZFRpbWVTdHJpbmc7XG59XG5cbmZ1bmN0aW9uIGZpbGVQYXRoRnJvbVN0YWNrTWVzc2FnZShzdGFja01lc3NhZ2UpIHtcbiAgY29uc3QgbWF0Y2hlcyA9IHN0YWNrTWVzc2FnZS5tYXRjaCgvKFxcLy4rKVxcOlxcZCtcXDpcXGQrLyksXG4gICAgICAgIHNlY29uZE1hdGNoID0gc2Vjb25kKG1hdGNoZXMpLFxuICAgICAgICBhYnNvbHV0ZUZpbGVQYXRoID0gc2Vjb25kTWF0Y2gsICAvLy9cbiAgICAgICAgY3VycmVudFdvcmtpbmdEaXJlY3RvcnlQYXRoID0gcGF0aC5yZXNvbHZlKCcuJyksICAvLy9cbiAgICAgICAgY3VycmVudFdvcmtpbmdEaXJlY3RvcnlQYXRoTGVuZ3RoID0gY3VycmVudFdvcmtpbmdEaXJlY3RvcnlQYXRoLmxlbmd0aCxcbiAgICAgICAgc3RhcnQgPSBjdXJyZW50V29ya2luZ0RpcmVjdG9yeVBhdGhMZW5ndGggKyAxLCAgLy8vXG4gICAgICAgIGZpbGVQYXRoID0gYWJzb2x1dGVGaWxlUGF0aC5zdWJzdHIoc3RhcnQpO1xuXG4gIHJldHVybiBmaWxlUGF0aDtcbn1cblxuZnVuY3Rpb24gbGluZU51bWJlckZyb21TdGFja01lc3NhZ2Uoc3RhY2tNZXNzYWdlKSB7XG4gIGNvbnN0IG1hdGNoZXMgPSBzdGFja01lc3NhZ2UubWF0Y2goL1xcOihcXGQrKS8pLFxuICAgICAgICBzZWNvbmRNYXRjaCA9IHNlY29uZChtYXRjaGVzKSxcbiAgICAgICAgbGluZU51bWJlciA9IHNlY29uZE1hdGNoOyAvLy9cblxuICByZXR1cm4gbGluZU51bWJlcjtcbn1cblxuZnVuY3Rpb24gcGFkU3RhcnRXaXRoWmVyb2VzKHN0cmluZywgdGFyZ2V0TGVuZ3RoKSB7XG4gIGNvbnN0IHBhZFN0cmluZyA9ICcwJyxcbiAgICAgICAgcGFkZGVkU3RyaW5nID0gcGFkU3RhcnQoc3RyaW5nLCB0YXJnZXRMZW5ndGgsIHBhZFN0cmluZyk7XG5cbiAgcmV0dXJuIHBhZGRlZFN0cmluZztcbn1cblxuZnVuY3Rpb24gcGFkU3RhcnQoc3RyaW5nLCB0YXJnZXRMZW5ndGgsIHBhZFN0cmluZykge1xuICBsZXQgcGFkZGluZyA9ICcnO1xuXG4gIGZvciAobGV0IGluZGV4ID0gMDsgaW5kZXggPCB0YXJnZXRMZW5ndGg7IGluZGV4KyspIHtcbiAgICBwYWRkaW5nICs9IHBhZFN0cmluZztcbiAgfVxuXG4gIGNvbnN0IHBhZGRlZFN0cmluZyA9IGAke3BhZGRpbmd9JHtzdHJpbmd9YC5zdWJzdHIoLXRhcmdldExlbmd0aCk7XG5cbiAgcmV0dXJuIHBhZGRlZFN0cmluZztcbn1cblxuIl19