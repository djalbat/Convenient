'use strict';

var path = require('path');

var pathUtilities = require('../../utilities/path'),
    arrayUtilities = require('../../utilities/array'),
    fileSystemUtilities = require('../../utilities/fileSystem');

var second = arrayUtilities.second,
    concatenatePaths = pathUtilities.concatenatePaths,
    checkFileExists = fileSystemUtilities.checkFileExists,
    readFile = fileSystemUtilities.readFile,
    appendToFile = fileSystemUtilities.appendToFile,
    renameFile = fileSystemUtilities.renameFile,
    getStats = fileSystemUtilities.getStats;


var TRACE = 'TRACE',
    DEBUG = 'DEBUG',
    INFO = 'INFO',
    WARNING = 'WARNING',
    ERROR = 'ERROR',
    FATAL = 'FATAL';

var logLevel = WARNING,
    logFileBaseName = 'default',
    logDirectoryPath = null;

function log(messageOrError) {
  var level = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : '';

  var pertinentStackMessageIndex = 2;

  var levels = [TRACE, DEBUG, INFO, WARNING, ERROR, FATAL];

  if (level) {
    ///
    var levelIndex = levels.indexOf(level),
        logLevelIndex = levels.indexOf(logLevel);

    if (levelIndex < logLevelIndex) {
      return;
    }

    pertinentStackMessageIndex += 1;

    level = level + ' '; ///
  }

  var error = void 0,
      message = void 0;

  if (messageOrError instanceof Error) {
    error = messageOrError; ///

    var _error = error;
    message = _error.message;
  } else {
    message = messageOrError; ///

    error = new Error(message);
  }

  var _error2 = error,
      stack = _error2.stack,
      stackMessages = stack.split(/\r\n|\n/),
      pertinentStackMessage = stackMessages[pertinentStackMessageIndex],
      stackMessage = pertinentStackMessage,
      currentDateAndTimeString = getCurrentDateAndTimeString(),
      filePath = filePathFromStackMessage(stackMessage),
      lineNumber = lineNumberFromStackMessage(stackMessage),
      logMessage = '' + level + currentDateAndTimeString + ' ' + filePath + '(' + lineNumber + ') ' + message;


  console.log(logMessage);

  if (logDirectoryPath !== null) {
    rollOverLogFile();

    var logFilePath = getLogFilePath(),
        logFileContent = logMessage + '\n';

    appendToFile(logFilePath, logFileContent);
  }

  return logMessage;
}

function trace(message) {
  return log(message, TRACE);
}

function debug(message) {
  return log(message, DEBUG);
}

function info(message) {
  return log(message, INFO);
}

function warning(message) {
  return log(message, WARNING);
}

function error(message) {
  return log(message, ERROR);
}

function fatal(message) {
  return log(message, FATAL);
}

function setLogLevel(level) {
  logLevel = level;
}

function setLogFileBaseName(fileBaseName) {
  logFileBaseName = fileBaseName;
}

function setLogDirectoryPath(directoryPath) {
  logDirectoryPath = directoryPath;
}

function getLogFileContent() {
  var logFilePath = getLogFilePath(),
      logFileContent = readFile(logFilePath);

  return logFileContent;
}

Object.assign(log, {
  TRACE: TRACE,
  DEBUG: DEBUG,
  INFO: INFO,
  WARNING: WARNING,
  ERROR: ERROR,
  FATAL: FATAL,
  trace: trace,
  debug: debug,
  info: info,
  warning: warning,
  error: error,
  fatal: fatal,
  setLogLevel: setLogLevel,
  setLogFileBaseName: setLogFileBaseName,
  setLogDirectoryPath: setLogDirectoryPath,
  getLogFileContent: getLogFileContent
});

module.exports = log;

function getLogFilePath() {
  var logFileName = logFileBaseName + '.log',
      logFilePath = concatenatePaths(logDirectoryPath, logFileName);

  return logFilePath;
}

function getRolledOverLogFilePath() {
  var currentDateString = getCurrentDateString(),
      rolledOverLogFileName = logFileBaseName + '.' + currentDateString + '.log',
      rolledOverLogFilePath = concatenatePaths(logDirectoryPath, rolledOverLogFileName);

  return rolledOverLogFilePath;
}

function getLogFileLastModifiedDate() {
  var logFilePath = getLogFilePath(),
      logFileStats = getStats(logFilePath),
      mtime = logFileStats.mtime,
      logFileLastModifiedDate = new Date(mtime); ///

  return logFileLastModifiedDate;
}

function rollOverLogFile() {
  var logFilePath = getLogFilePath(),
      logFileExists = checkFileExists(logFilePath);

  if (!logFileExists) {
    return;
  }

  var logFileLastModifiedDate = getLogFileLastModifiedDate(),
      logFileLastModifiedDateCurrentDate = isDateCurrentDate(logFileLastModifiedDate);

  if (!logFileLastModifiedDateCurrentDate) {
    var rolledOverLogFilePath = getRolledOverLogFilePath();

    renameFile(logFilePath, rolledOverLogFilePath);
  }
}

function isDateCurrentDate(date) {
  var currentDate = new Date(),
      dateString = date.toDateString(),
      currentDateString = currentDate.toDateString(),
      dateCurrentDate = dateString === currentDateString;

  return dateCurrentDate;
}

function getCurrentDateString() {
  var date = new Date(),
      day = padStartWithZeroes(date.getDate(), 2),
      ///
  month = padStartWithZeroes(date.getMonth() + 1, 2),
      ///
  year = date.getFullYear(),
      currentDateAndTimeString = day + '-' + month + '-' + year;

  return currentDateAndTimeString;
}

function getCurrentDateAndTimeString() {
  var date = new Date(),
      day = padStartWithZeroes(date.getDate(), 2),
      ///
  month = padStartWithZeroes(date.getMonth() + 1, 2),
      ///
  year = date.getFullYear(),
      hours = padStartWithZeroes(date.getHours(), 2),
      minutes = padStartWithZeroes(date.getMinutes(), 2),
      seconds = padStartWithZeroes(date.getSeconds(), 2),
      milliseconds = padStartWithZeroes(date.getMilliseconds(), 3),
      currentDateAndTimeString = day + '-' + month + '-' + year + ' ' + hours + ':' + minutes + ':' + seconds + '.' + milliseconds;

  return currentDateAndTimeString;
}

function filePathFromStackMessage(stackMessage) {
  var matches = stackMessage.match(/(\/.+)\:\d+\:\d+/),
      secondMatch = second(matches),
      absoluteFilePath = secondMatch,
      ///
  currentWorkingDirectoryPath = path.resolve('.'),
      ///
  currentWorkingDirectoryPathLength = currentWorkingDirectoryPath.length,
      start = currentWorkingDirectoryPathLength + 1,
      ///
  filePath = absoluteFilePath.substr(start);

  return filePath;
}

function lineNumberFromStackMessage(stackMessage) {
  var matches = stackMessage.match(/\:(\d+)/),
      secondMatch = second(matches),
      lineNumber = secondMatch; ///

  return lineNumber;
}

function padStartWithZeroes(string, targetLength) {
  var padString = '0',
      paddedString = padStart(string, targetLength, padString);

  return paddedString;
}

function padStart(string, targetLength, padString) {
  var padding = '';

  for (var index = 0; index < targetLength; index++) {
    padding += padString;
  }

  var paddedString = ('' + padding + string).substr(-targetLength);

  return paddedString;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL2VzNi91dGlsaXRpZXMvbWlzY2VsbGFuZW91cy9sb2cuanMiXSwibmFtZXMiOlsicGF0aCIsInJlcXVpcmUiLCJwYXRoVXRpbGl0aWVzIiwiYXJyYXlVdGlsaXRpZXMiLCJmaWxlU3lzdGVtVXRpbGl0aWVzIiwic2Vjb25kIiwiY29uY2F0ZW5hdGVQYXRocyIsImNoZWNrRmlsZUV4aXN0cyIsInJlYWRGaWxlIiwiYXBwZW5kVG9GaWxlIiwicmVuYW1lRmlsZSIsImdldFN0YXRzIiwiVFJBQ0UiLCJERUJVRyIsIklORk8iLCJXQVJOSU5HIiwiRVJST1IiLCJGQVRBTCIsImxvZ0xldmVsIiwibG9nRmlsZUJhc2VOYW1lIiwibG9nRGlyZWN0b3J5UGF0aCIsImxvZyIsIm1lc3NhZ2VPckVycm9yIiwibGV2ZWwiLCJwZXJ0aW5lbnRTdGFja01lc3NhZ2VJbmRleCIsImxldmVscyIsImxldmVsSW5kZXgiLCJpbmRleE9mIiwibG9nTGV2ZWxJbmRleCIsImVycm9yIiwibWVzc2FnZSIsIkVycm9yIiwic3RhY2siLCJzdGFja01lc3NhZ2VzIiwic3BsaXQiLCJwZXJ0aW5lbnRTdGFja01lc3NhZ2UiLCJzdGFja01lc3NhZ2UiLCJjdXJyZW50RGF0ZUFuZFRpbWVTdHJpbmciLCJnZXRDdXJyZW50RGF0ZUFuZFRpbWVTdHJpbmciLCJmaWxlUGF0aCIsImZpbGVQYXRoRnJvbVN0YWNrTWVzc2FnZSIsImxpbmVOdW1iZXIiLCJsaW5lTnVtYmVyRnJvbVN0YWNrTWVzc2FnZSIsImxvZ01lc3NhZ2UiLCJjb25zb2xlIiwicm9sbE92ZXJMb2dGaWxlIiwibG9nRmlsZVBhdGgiLCJnZXRMb2dGaWxlUGF0aCIsImxvZ0ZpbGVDb250ZW50IiwidHJhY2UiLCJkZWJ1ZyIsImluZm8iLCJ3YXJuaW5nIiwiZmF0YWwiLCJzZXRMb2dMZXZlbCIsInNldExvZ0ZpbGVCYXNlTmFtZSIsImZpbGVCYXNlTmFtZSIsInNldExvZ0RpcmVjdG9yeVBhdGgiLCJkaXJlY3RvcnlQYXRoIiwiZ2V0TG9nRmlsZUNvbnRlbnQiLCJPYmplY3QiLCJhc3NpZ24iLCJtb2R1bGUiLCJleHBvcnRzIiwibG9nRmlsZU5hbWUiLCJnZXRSb2xsZWRPdmVyTG9nRmlsZVBhdGgiLCJjdXJyZW50RGF0ZVN0cmluZyIsImdldEN1cnJlbnREYXRlU3RyaW5nIiwicm9sbGVkT3ZlckxvZ0ZpbGVOYW1lIiwicm9sbGVkT3ZlckxvZ0ZpbGVQYXRoIiwiZ2V0TG9nRmlsZUxhc3RNb2RpZmllZERhdGUiLCJsb2dGaWxlU3RhdHMiLCJtdGltZSIsImxvZ0ZpbGVMYXN0TW9kaWZpZWREYXRlIiwiRGF0ZSIsImxvZ0ZpbGVFeGlzdHMiLCJsb2dGaWxlTGFzdE1vZGlmaWVkRGF0ZUN1cnJlbnREYXRlIiwiaXNEYXRlQ3VycmVudERhdGUiLCJkYXRlIiwiY3VycmVudERhdGUiLCJkYXRlU3RyaW5nIiwidG9EYXRlU3RyaW5nIiwiZGF0ZUN1cnJlbnREYXRlIiwiZGF5IiwicGFkU3RhcnRXaXRoWmVyb2VzIiwiZ2V0RGF0ZSIsIm1vbnRoIiwiZ2V0TW9udGgiLCJ5ZWFyIiwiZ2V0RnVsbFllYXIiLCJob3VycyIsImdldEhvdXJzIiwibWludXRlcyIsImdldE1pbnV0ZXMiLCJzZWNvbmRzIiwiZ2V0U2Vjb25kcyIsIm1pbGxpc2Vjb25kcyIsImdldE1pbGxpc2Vjb25kcyIsIm1hdGNoZXMiLCJtYXRjaCIsInNlY29uZE1hdGNoIiwiYWJzb2x1dGVGaWxlUGF0aCIsImN1cnJlbnRXb3JraW5nRGlyZWN0b3J5UGF0aCIsInJlc29sdmUiLCJjdXJyZW50V29ya2luZ0RpcmVjdG9yeVBhdGhMZW5ndGgiLCJsZW5ndGgiLCJzdGFydCIsInN1YnN0ciIsInN0cmluZyIsInRhcmdldExlbmd0aCIsInBhZFN0cmluZyIsInBhZGRlZFN0cmluZyIsInBhZFN0YXJ0IiwicGFkZGluZyIsImluZGV4Il0sIm1hcHBpbmdzIjoiQUFBQTs7QUFFQSxJQUFNQSxPQUFPQyxRQUFRLE1BQVIsQ0FBYjs7QUFFQSxJQUFNQyxnQkFBZ0JELFFB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RUFBb0NDLFlBQXBDLEVBQWtEO0FBQ2hELE1BQU1DLFlBQVksR0FBbEI7QUFBQSxNQUNNQyxlQUFlQyxTQUFTSixNQUFULEVBQWlCQyxZQUFqQixFQUErQkMsU0FBL0IsQ0FEckI7O0FBR0EsU0FBT0MsWUFBUDtBQUNEOztBQUVELFNBQVNDLFFBQVQsQ0FBa0JKLE1BQWxCLEVBQTBCQyxZQUExQixFQUF3Q0MsU0FBeEMsRUFBbUQ7QUFDakQsTUFBSUcsVUFBVSxFQUFkOztBQUVBLE9BQUssSUFBSUMsUUFBUSxDQUFqQixFQUFvQkEsUUFBUUwsWUFBNUIsRUFBMENLLE9BQTFDLEVBQW1EO0FBQ2pERCxlQUFXSCxTQUFYO0FBQ0Q7O0FBRUQsTUFBTUMsZUFBZSxNQUFHRSxPQUFILEdBQWFMLE1BQWIsRUFBc0JELE1BQXRCLENBQTZCLENBQUNFLFlBQTlCLENBQXJCOztBQUVBLFNBQU9FLFlBQVA7QUFDRCIsImZpbGUiOiJsb2cuanMiLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIHN0cmljdCc7XG5cbmNvbnN0IHBhdGggPSByZXF1aXJlKCdwYXRoJyk7XG5cbmNvbnN0IHBhdGhVdGlsaXRpZXMgPSByZXF1aXJlKCcuLi8uLi91dGlsaXRpZXMvcGF0aCcpLFxuICAgICAgYXJyYXlVdGlsaXRpZXMgPSByZXF1aXJlKCcuLi8uLi91dGlsaXRpZXMvYXJyYXknKSxcbiAgICAgIGZpbGVTeXN0ZW1VdGlsaXRpZXMgPSByZXF1aXJlKCcuLi8uLi91dGlsaXRpZXMvZmlsZVN5c3RlbScpO1xuXG5jb25zdCB7IHNlY29uZCB9ID0gYXJyYXlVdGlsaXRpZXMsXG4gICAgICB7IGNvbmNhdGVuYXRlUGF0aHMgfSA9IHBhdGhVdGlsaXRpZXMsXG4gICAgICB7IGNoZWNrRmlsZUV4aXN0cywgcmVhZEZpbGUsIGFwcGVuZFRvRmlsZSwgcmVuYW1lRmlsZSwgZ2V0U3RhdHMgfSA9IGZpbGVTeXN0ZW1VdGlsaXRpZXM7XG5cbmNvbnN0IFRSQUNFID0gJ1RSQUNFJyxcbiAgICAgIERFQlVHID0gJ0RFQlVHJyxcbiAgICAgIElORk8gPSAnSU5GTycsXG4gICAgICBXQVJOSU5HID0gJ1dBUk5JTkcnLFxuICAgICAgRVJST1IgPSAnRVJST1InLFxuICAgICAgRkFUQUwgPSAnRkFUQUwnO1xuXG5sZXQgbG9nTGV2ZWwgPSBXQVJOSU5HLFxuICAgIGxvZ0ZpbGVCYXNlTmFtZSA9ICdkZWZhdWx0JyxcbiAgICBsb2dEaXJlY3RvcnlQYXRoID0gbnVsbDtcblxuZnVuY3Rpb24gbG9nKG1lc3NhZ2VPckVycm9yLCBsZXZlbCA9ICcnKSB7XG4gIGxldCBwZXJ0aW5lbnRTdGFja01lc3NhZ2VJbmRleCA9IDI7XG5cbiAgY29uc3QgbGV2ZWxzID0gW1xuICAgIFRSQUNFLFxuICAgIERFQlVHLFxuICAgIElORk8sXG4gICAgV0FSTklORyxcbiAgICBFUlJPUixcbiAgICBGQVRBTFxuICBdO1xuXG4gIGlmIChsZXZlbCkgeyAvLy9cbiAgICBjb25zdCBsZXZlbEluZGV4ID0gbGV2ZWxzLmluZGV4T2YobGV2ZWwpLFxuICAgICAgICAgIGxvZ0xldmVsSW5kZXggPSBsZXZlbHMuaW5kZXhPZihsb2dMZXZlbCk7XG5cbiAgICBpZiAobGV2ZWxJbmRleCA8IGxvZ0xldmVsSW5kZXgpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBwZXJ0aW5lbnRTdGFja01lc3NhZ2VJbmRleCArPSAxO1xuXG4gICAgbGV2ZWwgPSBgJHtsZXZlbH0gYDsgIC8vL1xuICB9XG5cbiAgbGV0IGVycm9yLFxuICAgICAgbWVzc2FnZTtcblxuICBpZiAobWVzc2FnZU9yRXJyb3IgaW5zdGFuY2VvZiBFcnJvcikge1xuICAgIGVycm9yID0gbWVzc2FnZU9yRXJyb3I7IC8vL1xuXG4gICAgKHsgbWVzc2FnZSB9ID0gZXJyb3IpO1xuICB9IGVsc2Uge1xuICAgIG1lc3NhZ2UgPSBtZXNzYWdlT3JFcnJvcjsgLy8vXG5cbiAgICBlcnJvciA9IG5ldyBFcnJvcihtZXNzYWdlKTtcbiAgfVxuXG4gIGNvbnN0IHsgc3RhY2sgfSA9IGVycm9yLFxuICAgICAgICBzdGFja01lc3NhZ2VzID0gc3RhY2suc3BsaXQoL1xcclxcbnxcXG4vKSxcbiAgICAgICAgcGVydGluZW50U3RhY2tNZXNzYWdlID0gc3RhY2tNZXNzYWdlc1twZXJ0aW5lbnRTdGFja01lc3NhZ2VJbmRleF0sXG4gICAgICAgIHN0YWNrTWVzc2FnZSA9IHBlcnRpbmVudFN0YWNrTWVzc2FnZSwgLy8vXG4gICAgICAgIGN1cnJlbnREYXRlQW5kVGltZVN0cmluZyA9IGdldEN1cnJlbnREYXRlQW5kVGltZVN0cmluZygpLFxuICAgICAgICBmaWxlUGF0aCA9IGZpbGVQYXRoRnJvbVN0YWNrTWVzc2FnZShzdGFja01lc3NhZ2UpLFxuICAgICAgICBsaW5lTnVtYmVyID0gbGluZU51bWJlckZyb21TdGFja01lc3NhZ2Uoc3RhY2tNZXNzYWdlKSxcbiAgICAgICAgbG9nTWVzc2FnZSA9IGAke2xldmVsfSR7Y3VycmVudERhdGVBbmRUaW1lU3RyaW5nfSAke2ZpbGVQYXRofSgke2xpbmVOdW1iZXJ9KSAke21lc3NhZ2V9YDtcblxuICBjb25zb2xlLmxvZyhsb2dNZXNzYWdlKTtcblxuICBpZiAobG9nRGlyZWN0b3J5UGF0aCAhPT0gbnVsbCkge1xuICAgIHJvbGxPdmVyTG9nRmlsZSgpO1xuXG4gICAgY29uc3QgbG9nRmlsZVBhdGggPSBnZXRMb2dGaWxlUGF0aCgpLFxuICAgICAgICAgIGxvZ0ZpbGVDb250ZW50ID0gYCR7bG9nTWVzc2FnZX1cXG5gO1xuXG4gICAgYXBwZW5kVG9GaWxlKGxvZ0ZpbGVQYXRoLCBsb2dGaWxlQ29udGVudCk7XG4gIH1cblxuICByZXR1cm4gbG9nTWVzc2FnZTtcbn1cblxuZnVuY3Rpb24gdHJhY2UobWVzc2FnZSkgeyByZXR1cm4gbG9nKG1lc3NhZ2UsIFRSQUNFKTsgfVxuXG5mdW5jdGlvbiBkZWJ1ZyhtZXNzYWdlKSB7IHJldHVybiBsb2cobWVzc2FnZSwgREVCVUcpOyB9XG5cbmZ1bmN0aW9uIGluZm8obWVzc2FnZSkgeyByZXR1cm4gbG9nKG1lc3NhZ2UsIElORk8pOyB9XG5cbmZ1bmN0aW9uIHdhcm5pbmcobWVzc2FnZSkgeyByZXR1cm4gbG9nKG1lc3NhZ2UsIFdBUk5JTkcpOyB9XG5cbmZ1bmN0aW9uIGVycm9yKG1lc3NhZ2UpIHsgcmV0dXJuIGxvZyhtZXNzYWdlLCBFUlJPUik7IH1cblxuZnVuY3Rpb24gZmF0YWwobWVzc2FnZSkgeyByZXR1cm4gbG9nKG1lc3NhZ2UsIEZBVEFMKTsgfVxuXG5mdW5jdGlvbiBzZXRMb2dMZXZlbChsZXZlbCkgeyBsb2dMZXZlbCA9IGxldmVsOyB9XG5cbmZ1bmN0aW9uIHNldExvZ0ZpbGVCYXNlTmFtZShmaWxlQmFzZU5hbWUpIHsgbG9nRmlsZUJhc2VOYW1lID0gZmlsZUJhc2VOYW1lOyB9XG5cbmZ1bmN0aW9uIHNldExvZ0RpcmVjdG9yeVBhdGgoZGlyZWN0b3J5UGF0aCkgeyBsb2dEaXJlY3RvcnlQYXRoID0gZGlyZWN0b3J5UGF0aDsgfVxuXG5mdW5jdGlvbiBnZXRMb2dGaWxlQ29udGVudCgpIHtcbiAgY29uc3QgbG9nRmlsZVBhdGggPSBnZXRMb2dGaWxlUGF0aCgpLFxuICAgICAgICBsb2dGaWxlQ29udGVudCA9IHJlYWRGaWxlKGxvZ0ZpbGVQYXRoKTtcblxuICByZXR1cm4gbG9nRmlsZUNvbnRlbnQ7XG59XG5cbk9iamVjdC5hc3NpZ24obG9nLCB7XG4gIFRSQUNFLFxuICBERUJVRyxcbiAgSU5GTyxcbiAgV0FSTklORyxcbiAgRVJST1IsXG4gIEZBVEFMLFxuICB0cmFjZSxcbiAgZGVidWcsXG4gIGluZm8sXG4gIHdhcm5pbmcsXG4gIGVycm9yLFxuICBmYXRhbCxcbiAgc2V0TG9nTGV2ZWwsXG4gIHNldExvZ0ZpbGVCYXNlTmFtZSxcbiAgc2V0TG9nRGlyZWN0b3J5UGF0aCxcbiAgZ2V0TG9nRmlsZUNvbnRlbnRcbn0pO1xuXG5tb2R1bGUuZXhwb3J0cyA9IGxvZztcblxuZnVuY3Rpb24gZ2V0TG9nRmlsZVBhdGgoKSB7XG4gIGNvbnN0IGxvZ0ZpbGVOYW1lID0gYCR7bG9nRmlsZUJhc2VOYW1lfS5sb2dgLFxuICAgICAgICBsb2dGaWxlUGF0aCA9IGNvbmNhdGVuYXRlUGF0aHMobG9nRGlyZWN0b3J5UGF0aCwgbG9nRmlsZU5hbWUpO1xuXG4gIHJldHVybiBsb2dGaWxlUGF0aDtcbn1cblxuZnVuY3Rpb24gZ2V0Um9sbGVkT3ZlckxvZ0ZpbGVQYXRoKCkge1xuICBjb25zdCBjdXJyZW50RGF0ZVN0cmluZyA9IGdldEN1cnJlbnREYXRlU3RyaW5nKCksXG4gICAgICAgIHJvbGxlZE92ZXJMb2dGaWxlTmFtZSA9IGAke2xvZ0ZpbGVCYXNlTmFtZX0uJHtjdXJyZW50RGF0ZVN0cmluZ30ubG9nYCxcbiAgICAgICAgcm9sbGVkT3ZlckxvZ0ZpbGVQYXRoID0gY29uY2F0ZW5hdGVQYXRocyhsb2dEaXJlY3RvcnlQYXRoLCByb2xsZWRPdmVyTG9nRmlsZU5hbWUpO1xuXG4gIHJldHVybiByb2xsZWRPdmVyTG9nRmlsZVBhdGg7XG59XG5cbmZ1bmN0aW9uIGdldExvZ0ZpbGVMYXN0TW9kaWZpZWREYXRlKCkge1xuICBjb25zdCBsb2dGaWxlUGF0aCA9IGdldExvZ0ZpbGVQYXRoKCksXG4gICAgICAgIGxvZ0ZpbGVTdGF0cyA9IGdldFN0YXRzKGxvZ0ZpbGVQYXRoKSxcbiAgICAgICAgeyBtdGltZSB9ID0gbG9nRmlsZVN0YXRzLFxuICAgICAgICBsb2dGaWxlTGFzdE1vZGlmaWVkRGF0ZSA9IG5ldyBEYXRlKG10aW1lKTsgIC8vL1xuXG4gIHJldHVybiBsb2dGaWxlTGFzdE1vZGlmaWVkRGF0ZTtcbn1cblxuZnVuY3Rpb24gcm9sbE92ZXJMb2dGaWxlKCkge1xuICBjb25zdCBsb2dGaWxlUGF0aCA9IGdldExvZ0ZpbGVQYXRoKCksXG4gICAgICAgIGxvZ0ZpbGVFeGlzdHMgPSBjaGVja0ZpbGVFeGlzdHMobG9nRmlsZVBhdGgpO1xuXG4gIGlmICghbG9nRmlsZUV4aXN0cykge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGNvbnN0IGxvZ0ZpbGVMYXN0TW9kaWZpZWREYXRlID0gZ2V0TG9nRmlsZUxhc3RNb2RpZmllZERhdGUoKSxcbiAgICAgICAgbG9nRmlsZUxhc3RNb2RpZmllZERhdGVDdXJyZW50RGF0ZSA9IGlzRGF0ZUN1cnJlbnREYXRlKGxvZ0ZpbGVMYXN0TW9kaWZpZWREYXRlKTtcblxuICBpZiAoIWxvZ0ZpbGVMYXN0TW9kaWZpZWREYXRlQ3VycmVudERhdGUpIHtcbiAgICBjb25zdCByb2xsZWRPdmVyTG9nRmlsZVBhdGggPSBnZXRSb2xsZWRPdmVyTG9nRmlsZVBhdGgoKTtcblxuICAgIHJlbmFtZUZpbGUobG9nRmlsZVBhdGgsIHJvbGxlZE92ZXJMb2dGaWxlUGF0aCk7XG4gIH1cbn1cblxuZnVuY3Rpb24gaXNEYXRlQ3VycmVudERhdGUoZGF0ZSkge1xuICBjb25zdCBjdXJyZW50RGF0ZSA9IG5ldyBEYXRlKCksXG4gICAgICAgIGRhdGVTdHJpbmcgPSBkYXRlLnRvRGF0ZVN0cmluZygpLFxuICAgICAgICBjdXJyZW50RGF0ZVN0cmluZyA9IGN1cnJlbnREYXRlLnRvRGF0ZVN0cmluZygpLFxuICAgICAgICBkYXRlQ3VycmVudERhdGUgPSAoZGF0ZVN0cmluZyA9PT0gY3VycmVudERhdGVTdHJpbmcpO1xuXG4gIHJldHVybiBkYXRlQ3VycmVudERhdGU7XG59XG5cbmZ1bmN0aW9uIGdldEN1cnJlbnREYXRlU3RyaW5nKCkge1xuICBjb25zdCBkYXRlID0gbmV3IERhdGUoKSxcbiAgICAgICAgZGF5ID0gcGFkU3RhcnRXaXRoWmVyb2VzKGRhdGUuZ2V0RGF0ZSgpLCAyKSwgIC8vL1xuICAgICAgICBtb250aCA9IHBhZFN0YXJ0V2l0aFplcm9lcyhkYXRlLmdldE1vbnRoKCkgKyAxLCAyKSwgLy8vXG4gICAgICAgIHllYXIgPSBkYXRlLmdldEZ1bGxZZWFyKCksXG4gICAgICAgIGN1cnJlbnREYXRlQW5kVGltZVN0cmluZyA9IGAke2RheX0tJHttb250aH0tJHt5ZWFyfWA7XG5cbiAgcmV0dXJuIGN1cnJlbnREYXRlQW5kVGltZVN0cmluZztcbn1cblxuZnVuY3Rpb24gZ2V0Q3VycmVudERhdGVBbmRUaW1lU3RyaW5nKCkge1xuICBjb25zdCBkYXRlID0gbmV3IERhdGUoKSxcbiAgICAgICAgZGF5ID0gcGFkU3RhcnRXaXRoWmVyb2VzKGRhdGUuZ2V0RGF0ZSgpLCAyKSwgIC8vL1xuICAgICAgICBtb250aCA9IHBhZFN0YXJ0V2l0aFplcm9lcyhkYXRlLmdldE1vbnRoKCkgKyAxLCAyKSwgLy8vXG4gICAgICAgIHllYXIgPSBkYXRlLmdldEZ1bGxZZWFyKCksXG4gICAgICAgIGhvdXJzID0gcGFkU3RhcnRXaXRoWmVyb2VzKGRhdGUuZ2V0SG91cnMoKSwgMiksXG4gICAgICAgIG1pbnV0ZXMgPSBwYWRTdGFydFdpdGhaZXJvZXMoZGF0ZS5nZXRNaW51dGVzKCksIDIpLFxuICAgICAgICBzZWNvbmRzID0gcGFkU3RhcnRXaXRoWmVyb2VzKGRhdGUuZ2V0U2Vjb25kcygpLCAyKSxcbiAgICAgICAgbWlsbGlzZWNvbmRzID0gcGFkU3RhcnRXaXRoWmVyb2VzKGRhdGUuZ2V0TWlsbGlzZWNvbmRzKCksIDMpLFxuICAgICAgICBjdXJyZW50RGF0ZUFuZFRpbWVTdHJpbmcgPSBgJHtkYXl9LSR7bW9udGh9LSR7eWVhcn0gJHtob3Vyc306JHttaW51dGVzfToke3NlY29uZHN9LiR7bWlsbGlzZWNvbmRzfWA7XG5cbiAgcmV0dXJuIGN1cnJlbnREYXRlQW5kVGltZVN0cmluZztcbn1cblxuZnVuY3Rpb24gZmlsZVBhdGhGcm9tU3RhY2tNZXNzYWdlKHN0YWNrTWVzc2FnZSkge1xuICBjb25zdCBtYXRjaGVzID0gc3RhY2tNZXNzYWdlLm1hdGNoKC8oXFwvLispXFw6XFxkK1xcOlxcZCsvKSxcbiAgICAgICAgc2Vjb25kTWF0Y2ggPSBzZWNvbmQobWF0Y2hlcyksXG4gICAgICAgIGFic29sdXRlRmlsZVBhdGggPSBzZWNvbmRNYXRjaCwgIC8vL1xuICAgICAgICBjdXJyZW50V29ya2luZ0RpcmVjdG9yeVBhdGggPSBwYXRoLnJlc29sdmUoJy4nKSwgIC8vL1xuICAgICAgICBjdXJyZW50V29ya2luZ0RpcmVjdG9yeVBhdGhMZW5ndGggPSBjdXJyZW50V29ya2luZ0RpcmVjdG9yeVBhdGgubGVuZ3RoLFxuICAgICAgICBzdGFydCA9IGN1cnJlbnRXb3JraW5nRGlyZWN0b3J5UGF0aExlbmd0aCArIDEsICAvLy9cbiAgICAgICAgZmlsZVBhdGggPSBhYnNvbHV0ZUZpbGVQYXRoLnN1YnN0cihzdGFydCk7XG5cbiAgcmV0dXJuIGZpbGVQYXRoO1xufVxuXG5mdW5jdGlvbiBsaW5lTnVtYmVyRnJvbVN0YWNrTWVzc2FnZShzdGFja01lc3NhZ2UpIHtcbiAgY29uc3QgbWF0Y2hlcyA9IHN0YWNrTWVzc2FnZS5tYXRjaCgvXFw6KFxcZCspLyksXG4gICAgICAgIHNlY29uZE1hdGNoID0gc2Vjb25kKG1hdGNoZXMpLFxuICAgICAgICBsaW5lTnVtYmVyID0gc2Vjb25kTWF0Y2g7IC8vL1xuXG4gIHJldHVybiBsaW5lTnVtYmVyO1xufVxuXG5mdW5jdGlvbiBwYWRTdGFydFdpdGhaZXJvZXMoc3RyaW5nLCB0YXJnZXRMZW5ndGgpIHtcbiAgY29uc3QgcGFkU3RyaW5nID0gJzAnLFxuICAgICAgICBwYWRkZWRTdHJpbmcgPSBwYWRTdGFydChzdHJpbmcsIHRhcmdldExlbmd0aCwgcGFkU3RyaW5nKTtcblxuICByZXR1cm4gcGFkZGVkU3RyaW5nO1xufVxuXG5mdW5jdGlvbiBwYWRTdGFydChzdHJpbmcsIHRhcmdldExlbmd0aCwgcGFkU3RyaW5nKSB7XG4gIGxldCBwYWRkaW5nID0gJyc7XG5cbiAgZm9yIChsZXQgaW5kZXggPSAwOyBpbmRleCA8IHRhcmdldExlbmd0aDsgaW5kZXgrKykge1xuICAgIHBhZGRpbmcgKz0gcGFkU3RyaW5nO1xuICB9XG5cbiAgY29uc3QgcGFkZGVkU3RyaW5nID0gYCR7cGFkZGluZ30ke3N0cmluZ31gLnN1YnN0cigtdGFyZ2V0TGVuZ3RoKTtcblxuICByZXR1cm4gcGFkZGVkU3RyaW5nO1xufVxuXG4iXX0=