'use strict';

var path = require('path');

var pathUtilities = require('../../utilities/path'),
    arrayUtilities = require('../../utilities/array'),
    fileSystemUtilities = require('../../utilities/fileSystem');

var second = arrayUtilities.second,
    concatenatePaths = pathUtilities.concatenatePaths,
    doesFileExist = fileSystemUtilities.doesFileExist,
    readFile = fileSystemUtilities.readFile,
    appendToFile = fileSystemUtilities.appendToFile,
    renameFile = fileSystemUtilities.renameFile,
    getStats = fileSystemUtilities.getStats;


var TRACE = 'TRACE',
    DEBUG = 'DEBUG',
    INFO = 'INFO',
    WARNING = 'WARNING',
    ERROR = 'ERROR',
    FATAL = 'FATAL';

var logLevel = WARNING,
    logFileBaseName = 'default',
    logDirectoryPath = null;

function log(message) {
  var level = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : '';

  var pertinentStackMessageIndex = 2;

  var levels = [TRACE, DEBUG, INFO, WARNING, ERROR, FATAL];

  if (level) {
    ///
    var levelIndex = levels.indexOf(level),
        logLevelIndex = levels.indexOf(logLevel);

    if (levelIndex < logLevelIndex) {
      return;
    }

    pertinentStackMessageIndex += 1;

    level = level + ' '; ///
  }

  var error = new Error(),
      stack = error.stack,
      stackMessages = stack.split(/\r\n|\n/),
      pertinentStackMessage = stackMessages[pertinentStackMessageIndex],
      currentDateAndTimeString = getCurrentDateAndTimeString(),
      filePath = filePathFromStackMessage(pertinentStackMessage),
      lineNumber = lineNumberFromStackMessage(pertinentStackMessage),
      logMessage = '' + level + currentDateAndTimeString + ' ' + filePath + '(' + lineNumber + ') ' + message;


  console.log(logMessage);

  if (logDirectoryPath !== null) {
    rollOverLogFile();

    var logFilePath = getLogFilePath(),
        logFileContent = logMessage + '\n';

    appendToFile(logFilePath, logFileContent);
  }
}

function trace(message) {
  log(message, TRACE);
}

function debug(message) {
  log(message, DEBUG);
}

function info(message) {
  log(message, INFO);
}

function warning(message) {
  log(message, WARNING);
}

function error(message) {
  log(message, ERROR);
}

function fatal(message) {
  log(message, FATAL);
}

function setLogLevel(level) {
  logLevel = level;
}

function setLogFileBaseName(fileBaseName) {
  logFileBaseName = fileBaseName;
}

function setLogDirectoryPath(directoryPath) {
  logDirectoryPath = directoryPath;
}

function getLogFileContent() {
  var logFilePath = getLogFilePath(),
      logFileContent = readFile(logFilePath);

  return logFileContent;
}

Object.assign(log, {
  TRACE: TRACE,
  DEBUG: DEBUG,
  INFO: INFO,
  WARNING: WARNING,
  ERROR: ERROR,
  FATAL: FATAL,
  trace: trace,
  debug: debug,
  info: info,
  warning: warning,
  error: error,
  fatal: fatal,
  setLogLevel: setLogLevel,
  setLogFileBaseName: setLogFileBaseName,
  setLogDirectoryPath: setLogDirectoryPath,
  getLogFileContent: getLogFileContent
});

module.exports = log;

function getLogFilePath() {
  var logFileName = logFileBaseName + '.log',
      logFilePath = concatenatePaths(logDirectoryPath, logFileName);

  return logFilePath;
}

function getRolledOverLogFilePath() {
  var currentDateString = getCurrentDateString(),
      rolledOverLogFileName = logFileBaseName + '.' + currentDateString + '.log',
      rolledOverLogFilePath = concatenatePaths(logDirectoryPath, rolledOverLogFileName);

  return rolledOverLogFilePath;
}

function getLogFileLastModifiedDate() {
  var logFilePath = getLogFilePath(),
      logFileStats = getStats(logFilePath),
      mtime = logFileStats.mtime,
      logFileLastModifiedDate = new Date(mtime); ///

  return logFileLastModifiedDate;
}

function rollOverLogFile() {
  var logFilePath = getLogFilePath(),
      logFileExists = doesFileExist(logFilePath);

  if (!logFileExists) {
    return;
  }

  var logFileLastModifiedDate = getLogFileLastModifiedDate(),
      logFileLastModifiedDateCurrentDate = isDateCurrentDate(logFileLastModifiedDate);

  if (!logFileLastModifiedDateCurrentDate) {
    var rolledOverLogFilePath = getRolledOverLogFilePath();

    renameFile(logFilePath, rolledOverLogFilePath);
  }
}

function isDateCurrentDate(date) {
  var currentDate = new Date(),
      dateString = date.toDateString(),
      currentDateString = currentDate.toDateString(),
      dateCurrentDate = dateString === currentDateString;

  return dateCurrentDate;
}

function getCurrentDateString() {
  var date = new Date(),
      day = padStartWithZeroes(date.getDate(), 2),
      ///
  month = padStartWithZeroes(date.getMonth() + 1, 2),
      ///
  year = date.getFullYear(),
      currentDateAndTimeString = day + '-' + month + '-' + year;

  return currentDateAndTimeString;
}

function getCurrentDateAndTimeString() {
  var date = new Date(),
      day = padStartWithZeroes(date.getDate(), 2),
      ///
  month = padStartWithZeroes(date.getMonth() + 1, 2),
      ///
  year = date.getFullYear(),
      hours = padStartWithZeroes(date.getHours(), 2),
      minutes = padStartWithZeroes(date.getMinutes(), 2),
      seconds = padStartWithZeroes(date.getSeconds(), 2),
      milliseconds = padStartWithZeroes(date.getMilliseconds(), 3),
      currentDateAndTimeString = day + '-' + month + '-' + year + ' ' + hours + ':' + minutes + ':' + seconds + '.' + milliseconds;

  return currentDateAndTimeString;
}

function filePathFromStackMessage(stackMessage) {
  var matches = stackMessage.match(/(\/.+)\:\d+\:\d+/),
      secondMatch = second(matches),
      absoluteFilePath = secondMatch,
      ///
  currentWorkingDirectoryPath = path.resolve('.'),
      ///
  currentWorkingDirectoryPathLength = currentWorkingDirectoryPath.length,
      start = currentWorkingDirectoryPathLength + 1,
      ///
  filePath = absoluteFilePath.substr(start);

  return filePath;
}

function lineNumberFromStackMessage(stackMessage) {
  var matches = stackMessage.match(/\:(\d+)/),
      secondMatch = second(matches),
      lineNumber = secondMatch; ///

  return lineNumber;
}

function padStartWithZeroes(string, targetLength) {
  var padString = '0',
      paddedString = padStart(string, targetLength, padString);

  return paddedString;
}

function padStart(string, targetLength, padString) {
  var padding = '';

  for (var index = 0; index < targetLength; index++) {
    padding += padString;
  }

  var paddedString = ('' + padding + string).substr(-targetLength);

  return paddedString;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL2VzNi91dGlsaXRpZXMvbWlzY2VsbGFuZW91cy9sb2cuanMiXSwibmFtZXMiOlsicGF0aCIsInJlcXVpcmUiLCJwYXRoVXRpbGl0aWVzIiwiYXJyYXlVdGlsaXRpZXMiLCJmaWxlU3lzdGVtVXRpbGl0aWVzIiwic2Vjb25kIiwiY29uY2F0ZW5hdGVQYXRocyIsImRvZXNGaWxlRXhpc3QiLCJyZWFkRmlsZSIsImFwcGVuZFRvRmlsZSIsInJlbmFtZUZpbGUiLCJnZXRTdGF0cyIsIlRSQUNFIiwiREVCVUciLCJJTkZPIiwiV0FSTklORyIsIkVSUk9SIiwiRkFUQUwiLCJsb2dMZXZlbCIsImxvZ0ZpbGVCYXNlTmFtZSIsImxvZ0RpcmVjdG9yeVBhdGgiLCJsb2ciLCJtZXNzYWdlIiwibGV2ZWwiLCJwZXJ0aW5lbnRTdGFja01lc3NhZ2VJbmRleCIsImxldmVscyIsImxldmVsSW5kZXgiLCJpbmRleE9mIiwibG9nTGV2ZWxJbmRleCIsIkVycm9yIiwic3RhY2siLCJlcnJvciIsInN0YWNrTWVzc2FnZXMiLCJzcGxpdCIsInBlcnRpbmVudFN0YWNrTWVzc2FnZSIsImN1cnJlbnREYXRlQW5kVGltZVN0cmluZyIsImdldEN1cnJlbnREYXRlQW5kVGltZVN0cmluZyIsImZpbGVQYXRoIiwiZmlsZVBhdGhGcm9tU3RhY2tNZXNzYWdlIiwibGluZU51bWJlciIsImxpbmVOdW1iZXJGcm9tU3RhY2tNZXNzYWdlIiwibG9nTWVzc2FnZSIsImNvbnNvbGUiLCJyb2xsT3ZlckxvZ0ZpbGUiLCJsb2dGaWxlUGF0aCIsImdldExvZ0ZpbGVQYXRoIiwibG9nRmlsZUNvbnRlbnQiLCJ0cmFjZSIsImRlYnVnIiwiaW5mbyIsIndhcm5pbmciLCJmYXRhbCIsInNldExvZ0xldmVsIiwic2V0TG9nRmlsZUJhc2VOYW1lIiwiZmlsZUJhc2VOYW1lIiwic2V0TG9nRGlyZWN0b3J5UGF0aCIsImRpcmVjdG9yeVBhdGgiLCJnZXRMb2dGaWxlQ29udGVudCIsIk9iamVjdCIsImFzc2lnbiIsIm1vZHVsZSIsImV4cG9ydHMiLCJsb2dGaWxlTmFtZSIsImdldFJvbGxlZE92ZXJMb2dGaWxlUGF0aCIsImN1cnJlbnREYXRlU3RyaW5nIiwiZ2V0Q3VycmVudERhdGVTdHJpbmciLCJyb2xsZWRPdmVyTG9nRmlsZU5hbWUiLCJyb2xsZWRPdmVyTG9nRmlsZVBhdGgiLCJnZXRMb2dGaWxlTGFzdE1vZGlmaWVkRGF0ZSIsImxvZ0ZpbGVTdGF0cyIsIm10aW1lIiwibG9nRmlsZUxhc3RNb2RpZmllZERhdGUiLCJEYXRlIiwibG9nRmlsZUV4aXN0cyIsImxvZ0ZpbGVMYXN0TW9kaWZpZWREYXRlQ3VycmVudERhdGUiLCJpc0RhdGVDdXJyZW50RGF0ZSIsImRhdGUiLCJjdXJyZW50RGF0ZSIsImRhdGVTdHJpbmciLCJ0b0RhdGVTdHJpbmciLCJkYXRlQ3VycmVudERhdGUiLCJkYXkiLCJwYWRTdGFydFdpdGhaZXJvZXMiLCJnZXREYXRlIiwibW9udGgiLCJnZXRNb250aCIsInllYXIiLCJnZXRGdWxsWWVhciIsImhvdXJzIiwiZ2V0SG91cnMiLCJtaW51dGVzIiwiZ2V0TWludXRlcyIsInNlY29uZHMiLCJnZXRTZWNvbmRzIiwibWlsbGlzZWNvbmRzIiwiZ2V0TWlsbGlzZWNvbmRzIiwic3RhY2tNZXNzYWdlIiwibWF0Y2hlcyIsIm1hdGNoIiwic2Vjb25kTWF0Y2giLCJhYnNvbHV0ZUZpbGVQYXRoIiwiY3VycmVudFdvcmtpbmdEaXJlY3RvcnlQYXRoIiwicmVzb2x2ZSIsImN1cnJlbnRXb3JraW5nRGlyZWN0b3J5UGF0aExlbmd0aCIsImxlbmd0aCIsInN0YXJ0Iiwic3Vic3RyIiwic3RyaW5nIiwidGFyZ2V0TGVuZ3RoIiwicGFkU3RyaW5nIiwicGFkZGVkU3RyaW5nIiwicGFkU3RhcnQiLCJwYWRkaW5nIiwiaW5kZXgiXSwibWFwcGluZ3MiOiJBQUFBOztBQUVBLElBQU1BLE9BQU9DLFFBQVEsTUFBUixDQUFiOztBQUVBLElBQU1DLGdCQUFnQkQsUUFBUSxzQkFBUixDQUF0QjtBQUFB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QUgsR0FBYUwsTUFBYixFQUFzQkQsTUFBdEIsQ0FBNkIsQ0FBQ0UsWUFBOUIsQ0FBckI7O0FBRUEsU0FBT0UsWUFBUDtBQUNEIiwiZmlsZSI6ImxvZy5qcyIsInNvdXJjZXNDb250ZW50IjpbIid1c2Ugc3RyaWN0JztcblxuY29uc3QgcGF0aCA9IHJlcXVpcmUoJ3BhdGgnKTtcblxuY29uc3QgcGF0aFV0aWxpdGllcyA9IHJlcXVpcmUoJy4uLy4uL3V0aWxpdGllcy9wYXRoJyksXG4gICAgICBhcnJheVV0aWxpdGllcyA9IHJlcXVpcmUoJy4uLy4uL3V0aWxpdGllcy9hcnJheScpLFxuICAgICAgZmlsZVN5c3RlbVV0aWxpdGllcyA9IHJlcXVpcmUoJy4uLy4uL3V0aWxpdGllcy9maWxlU3lzdGVtJyk7XG5cbmNvbnN0IHsgc2Vjb25kIH0gPSBhcnJheVV0aWxpdGllcyxcbiAgICAgIHsgY29uY2F0ZW5hdGVQYXRocyB9ID0gcGF0aFV0aWxpdGllcyxcbiAgICAgIHsgZG9lc0ZpbGVFeGlzdCwgcmVhZEZpbGUsIGFwcGVuZFRvRmlsZSwgcmVuYW1lRmlsZSwgZ2V0U3RhdHMgfSA9IGZpbGVTeXN0ZW1VdGlsaXRpZXM7XG5cbmNvbnN0IFRSQUNFID0gJ1RSQUNFJyxcbiAgICAgIERFQlVHID0gJ0RFQlVHJyxcbiAgICAgIElORk8gPSAnSU5GTycsXG4gICAgICBXQVJOSU5HID0gJ1dBUk5JTkcnLFxuICAgICAgRVJST1IgPSAnRVJST1InLFxuICAgICAgRkFUQUwgPSAnRkFUQUwnO1xuXG5sZXQgbG9nTGV2ZWwgPSBXQVJOSU5HLFxuICAgIGxvZ0ZpbGVCYXNlTmFtZSA9ICdkZWZhdWx0JyxcbiAgICBsb2dEaXJlY3RvcnlQYXRoID0gbnVsbDtcblxuZnVuY3Rpb24gbG9nKG1lc3NhZ2UsIGxldmVsID0gJycpIHtcbiAgbGV0IHBlcnRpbmVudFN0YWNrTWVzc2FnZUluZGV4ID0gMjtcblxuICBjb25zdCBsZXZlbHMgPSBbXG4gICAgVFJBQ0UsXG4gICAgREVCVUcsXG4gICAgSU5GTyxcbiAgICBXQVJOSU5HLFxuICAgIEVSUk9SLFxuICAgIEZBVEFMXG4gIF07XG5cbiAgaWYgKGxldmVsKSB7IC8vL1xuICAgIGNvbnN0IGxldmVsSW5kZXggPSBsZXZlbHMuaW5kZXhPZihsZXZlbCksXG4gICAgICAgICAgbG9nTGV2ZWxJbmRleCA9IGxldmVscy5pbmRleE9mKGxvZ0xldmVsKTtcblxuICAgIGlmIChsZXZlbEluZGV4IDwgbG9nTGV2ZWxJbmRleCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHBlcnRpbmVudFN0YWNrTWVzc2FnZUluZGV4ICs9IDE7XG5cbiAgICBsZXZlbCA9IGAke2xldmVsfSBgOyAgLy8vXG4gIH1cblxuICBjb25zdCBlcnJvciA9IG5ldyBFcnJvcigpLFxuICAgICAgICB7IHN0YWNrIH0gPSBlcnJvcixcbiAgICAgICAgc3RhY2tNZXNzYWdlcyA9IHN0YWNrLnNwbGl0KC9cXHJcXG58XFxuLyksXG4gICAgICAgIHBlcnRpbmVudFN0YWNrTWVzc2FnZSA9IHN0YWNrTWVzc2FnZXNbcGVydGluZW50U3RhY2tNZXNzYWdlSW5kZXhdLFxuICAgICAgICBjdXJyZW50RGF0ZUFuZFRpbWVTdHJpbmcgPSBnZXRDdXJyZW50RGF0ZUFuZFRpbWVTdHJpbmcoKSxcbiAgICAgICAgZmlsZVBhdGggPSBmaWxlUGF0aEZyb21TdGFja01lc3NhZ2UocGVydGluZW50U3RhY2tNZXNzYWdlKSxcbiAgICAgICAgbGluZU51bWJlciA9IGxpbmVOdW1iZXJGcm9tU3RhY2tNZXNzYWdlKHBlcnRpbmVudFN0YWNrTWVzc2FnZSksXG4gICAgICAgIGxvZ01lc3NhZ2UgPSBgJHtsZXZlbH0ke2N1cnJlbnREYXRlQW5kVGltZVN0cmluZ30gJHtmaWxlUGF0aH0oJHtsaW5lTnVtYmVyfSkgJHttZXNzYWdlfWA7XG5cbiAgY29uc29sZS5sb2cobG9nTWVzc2FnZSk7XG5cbiAgaWYgKGxvZ0RpcmVjdG9yeVBhdGggIT09IG51bGwpIHtcbiAgICByb2xsT3ZlckxvZ0ZpbGUoKTtcblxuICAgIGNvbnN0IGxvZ0ZpbGVQYXRoID0gZ2V0TG9nRmlsZVBhdGgoKSxcbiAgICAgICAgICBsb2dGaWxlQ29udGVudCA9IGAke2xvZ01lc3NhZ2V9XFxuYDtcblxuICAgIGFwcGVuZFRvRmlsZShsb2dGaWxlUGF0aCwgbG9nRmlsZUNvbnRlbnQpO1xuICB9XG59XG5cbmZ1bmN0aW9uIHRyYWNlKG1lc3NhZ2UpIHsgbG9nKG1lc3NhZ2UsIFRSQUNFKTsgfVxuXG5mdW5jdGlvbiBkZWJ1ZyhtZXNzYWdlKSB7IGxvZyhtZXNzYWdlLCBERUJVRyk7IH1cblxuZnVuY3Rpb24gaW5mbyhtZXNzYWdlKSB7IGxvZyhtZXNzYWdlLCBJTkZPKTsgfVxuXG5mdW5jdGlvbiB3YXJuaW5nKG1lc3NhZ2UpIHsgbG9nKG1lc3NhZ2UsIFdBUk5JTkcpOyB9XG5cbmZ1bmN0aW9uIGVycm9yKG1lc3NhZ2UpIHsgbG9nKG1lc3NhZ2UsIEVSUk9SKTsgfVxuXG5mdW5jdGlvbiBmYXRhbChtZXNzYWdlKSB7IGxvZyhtZXNzYWdlLCBGQVRBTCk7IH1cblxuZnVuY3Rpb24gc2V0TG9nTGV2ZWwobGV2ZWwpIHsgbG9nTGV2ZWwgPSBsZXZlbDsgfVxuXG5mdW5jdGlvbiBzZXRMb2dGaWxlQmFzZU5hbWUoZmlsZUJhc2VOYW1lKSB7IGxvZ0ZpbGVCYXNlTmFtZSA9IGZpbGVCYXNlTmFtZTsgfVxuXG5mdW5jdGlvbiBzZXRMb2dEaXJlY3RvcnlQYXRoKGRpcmVjdG9yeVBhdGgpIHsgbG9nRGlyZWN0b3J5UGF0aCA9IGRpcmVjdG9yeVBhdGg7IH1cblxuZnVuY3Rpb24gZ2V0TG9nRmlsZUNvbnRlbnQoKSB7XG4gIGNvbnN0IGxvZ0ZpbGVQYXRoID0gZ2V0TG9nRmlsZVBhdGgoKSxcbiAgICAgICAgbG9nRmlsZUNvbnRlbnQgPSByZWFkRmlsZShsb2dGaWxlUGF0aCk7XG5cbiAgcmV0dXJuIGxvZ0ZpbGVDb250ZW50O1xufVxuXG5PYmplY3QuYXNzaWduKGxvZywge1xuICBUUkFDRTogVFJBQ0UsXG4gIERFQlVHOiBERUJVRyxcbiAgSU5GTzogSU5GTyxcbiAgV0FSTklORzogV0FSTklORyxcbiAgRVJST1I6IEVSUk9SLFxuICBGQVRBTDogRkFUQUwsXG4gIHRyYWNlOiB0cmFjZSxcbiAgZGVidWc6IGRlYnVnLFxuICBpbmZvOiBpbmZvLFxuICB3YXJuaW5nOiB3YXJuaW5nLFxuICBlcnJvcjogZXJyb3IsXG4gIGZhdGFsOiBmYXRhbCxcbiAgc2V0TG9nTGV2ZWw6IHNldExvZ0xldmVsLFxuICBzZXRMb2dGaWxlQmFzZU5hbWU6IHNldExvZ0ZpbGVCYXNlTmFtZSxcbiAgc2V0TG9nRGlyZWN0b3J5UGF0aDogc2V0TG9nRGlyZWN0b3J5UGF0aCxcbiAgZ2V0TG9nRmlsZUNvbnRlbnQ6IGdldExvZ0ZpbGVDb250ZW50XG59KTtcblxubW9kdWxlLmV4cG9ydHMgPSBsb2c7XG5cbmZ1bmN0aW9uIGdldExvZ0ZpbGVQYXRoKCkge1xuICBjb25zdCBsb2dGaWxlTmFtZSA9IGAke2xvZ0ZpbGVCYXNlTmFtZX0ubG9nYCxcbiAgICAgICAgbG9nRmlsZVBhdGggPSBjb25jYXRlbmF0ZVBhdGhzKGxvZ0RpcmVjdG9yeVBhdGgsIGxvZ0ZpbGVOYW1lKTtcblxuICByZXR1cm4gbG9nRmlsZVBhdGg7XG59XG5cbmZ1bmN0aW9uIGdldFJvbGxlZE92ZXJMb2dGaWxlUGF0aCgpIHtcbiAgY29uc3QgY3VycmVudERhdGVTdHJpbmcgPSBnZXRDdXJyZW50RGF0ZVN0cmluZygpLFxuICAgICAgICByb2xsZWRPdmVyTG9nRmlsZU5hbWUgPSBgJHtsb2dGaWxlQmFzZU5hbWV9LiR7Y3VycmVudERhdGVTdHJpbmd9LmxvZ2AsXG4gICAgICAgIHJvbGxlZE92ZXJMb2dGaWxlUGF0aCA9IGNvbmNhdGVuYXRlUGF0aHMobG9nRGlyZWN0b3J5UGF0aCwgcm9sbGVkT3ZlckxvZ0ZpbGVOYW1lKTtcblxuICByZXR1cm4gcm9sbGVkT3ZlckxvZ0ZpbGVQYXRoO1xufVxuXG5mdW5jdGlvbiBnZXRMb2dGaWxlTGFzdE1vZGlmaWVkRGF0ZSgpIHtcbiAgY29uc3QgbG9nRmlsZVBhdGggPSBnZXRMb2dGaWxlUGF0aCgpLFxuICAgICAgICBsb2dGaWxlU3RhdHMgPSBnZXRTdGF0cyhsb2dGaWxlUGF0aCksXG4gICAgICAgIHsgbXRpbWUgfSA9IGxvZ0ZpbGVTdGF0cyxcbiAgICAgICAgbG9nRmlsZUxhc3RNb2RpZmllZERhdGUgPSBuZXcgRGF0ZShtdGltZSk7ICAvLy9cblxuICByZXR1cm4gbG9nRmlsZUxhc3RNb2RpZmllZERhdGU7XG59XG5cbmZ1bmN0aW9uIHJvbGxPdmVyTG9nRmlsZSgpIHtcbiAgY29uc3QgbG9nRmlsZVBhdGggPSBnZXRMb2dGaWxlUGF0aCgpLFxuICAgICAgICBsb2dGaWxlRXhpc3RzID0gZG9lc0ZpbGVFeGlzdChsb2dGaWxlUGF0aCk7XG5cbiAgaWYgKCFsb2dGaWxlRXhpc3RzKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgY29uc3QgbG9nRmlsZUxhc3RNb2RpZmllZERhdGUgPSBnZXRMb2dGaWxlTGFzdE1vZGlmaWVkRGF0ZSgpLFxuICAgICAgICBsb2dGaWxlTGFzdE1vZGlmaWVkRGF0ZUN1cnJlbnREYXRlID0gaXNEYXRlQ3VycmVudERhdGUobG9nRmlsZUxhc3RNb2RpZmllZERhdGUpO1xuXG4gIGlmICghbG9nRmlsZUxhc3RNb2RpZmllZERhdGVDdXJyZW50RGF0ZSkge1xuICAgIGNvbnN0IHJvbGxlZE92ZXJMb2dGaWxlUGF0aCA9IGdldFJvbGxlZE92ZXJMb2dGaWxlUGF0aCgpO1xuXG4gICAgcmVuYW1lRmlsZShsb2dGaWxlUGF0aCwgcm9sbGVkT3ZlckxvZ0ZpbGVQYXRoKTtcbiAgfVxufVxuXG5mdW5jdGlvbiBpc0RhdGVDdXJyZW50RGF0ZShkYXRlKSB7XG4gIGNvbnN0IGN1cnJlbnREYXRlID0gbmV3IERhdGUoKSxcbiAgICAgICAgZGF0ZVN0cmluZyA9IGRhdGUudG9EYXRlU3RyaW5nKCksXG4gICAgICAgIGN1cnJlbnREYXRlU3RyaW5nID0gY3VycmVudERhdGUudG9EYXRlU3RyaW5nKCksXG4gICAgICAgIGRhdGVDdXJyZW50RGF0ZSA9IChkYXRlU3RyaW5nID09PSBjdXJyZW50RGF0ZVN0cmluZyk7XG5cbiAgcmV0dXJuIGRhdGVDdXJyZW50RGF0ZTtcbn1cblxuZnVuY3Rpb24gZ2V0Q3VycmVudERhdGVTdHJpbmcoKSB7XG4gIGNvbnN0IGRhdGUgPSBuZXcgRGF0ZSgpLFxuICAgICAgICBkYXkgPSBwYWRTdGFydFdpdGhaZXJvZXMoZGF0ZS5nZXREYXRlKCksIDIpLCAgLy8vXG4gICAgICAgIG1vbnRoID0gcGFkU3RhcnRXaXRoWmVyb2VzKGRhdGUuZ2V0TW9udGgoKSArIDEsIDIpLCAvLy9cbiAgICAgICAgeWVhciA9IGRhdGUuZ2V0RnVsbFllYXIoKSxcbiAgICAgICAgY3VycmVudERhdGVBbmRUaW1lU3RyaW5nID0gYCR7ZGF5fS0ke21vbnRofS0ke3llYXJ9YDtcblxuICByZXR1cm4gY3VycmVudERhdGVBbmRUaW1lU3RyaW5nO1xufVxuXG5mdW5jdGlvbiBnZXRDdXJyZW50RGF0ZUFuZFRpbWVTdHJpbmcoKSB7XG4gIGNvbnN0IGRhdGUgPSBuZXcgRGF0ZSgpLFxuICAgICAgICBkYXkgPSBwYWRTdGFydFdpdGhaZXJvZXMoZGF0ZS5nZXREYXRlKCksIDIpLCAgLy8vXG4gICAgICAgIG1vbnRoID0gcGFkU3RhcnRXaXRoWmVyb2VzKGRhdGUuZ2V0TW9udGgoKSArIDEsIDIpLCAvLy9cbiAgICAgICAgeWVhciA9IGRhdGUuZ2V0RnVsbFllYXIoKSxcbiAgICAgICAgaG91cnMgPSBwYWRTdGFydFdpdGhaZXJvZXMoZGF0ZS5nZXRIb3VycygpLCAyKSxcbiAgICAgICAgbWludXRlcyA9IHBhZFN0YXJ0V2l0aFplcm9lcyhkYXRlLmdldE1pbnV0ZXMoKSwgMiksXG4gICAgICAgIHNlY29uZHMgPSBwYWRTdGFydFdpdGhaZXJvZXMoZGF0ZS5nZXRTZWNvbmRzKCksIDIpLFxuICAgICAgICBtaWxsaXNlY29uZHMgPSBwYWRTdGFydFdpdGhaZXJvZXMoZGF0ZS5nZXRNaWxsaXNlY29uZHMoKSwgMyksXG4gICAgICAgIGN1cnJlbnREYXRlQW5kVGltZVN0cmluZyA9IGAke2RheX0tJHttb250aH0tJHt5ZWFyfSAke2hvdXJzfToke21pbnV0ZXN9OiR7c2Vjb25kc30uJHttaWxsaXNlY29uZHN9YDtcblxuICByZXR1cm4gY3VycmVudERhdGVBbmRUaW1lU3RyaW5nO1xufVxuXG5mdW5jdGlvbiBmaWxlUGF0aEZyb21TdGFja01lc3NhZ2Uoc3RhY2tNZXNzYWdlKSB7XG4gIGNvbnN0IG1hdGNoZXMgPSBzdGFja01lc3NhZ2UubWF0Y2goLyhcXC8uKylcXDpcXGQrXFw6XFxkKy8pLFxuICAgICAgICBzZWNvbmRNYXRjaCA9IHNlY29uZChtYXRjaGVzKSxcbiAgICAgICAgYWJzb2x1dGVGaWxlUGF0aCA9IHNlY29uZE1hdGNoLCAgLy8vXG4gICAgICAgIGN1cnJlbnRXb3JraW5nRGlyZWN0b3J5UGF0aCA9IHBhdGgucmVzb2x2ZSgnLicpLCAgLy8vXG4gICAgICAgIGN1cnJlbnRXb3JraW5nRGlyZWN0b3J5UGF0aExlbmd0aCA9IGN1cnJlbnRXb3JraW5nRGlyZWN0b3J5UGF0aC5sZW5ndGgsXG4gICAgICAgIHN0YXJ0ID0gY3VycmVudFdvcmtpbmdEaXJlY3RvcnlQYXRoTGVuZ3RoICsgMSwgIC8vL1xuICAgICAgICBmaWxlUGF0aCA9IGFic29sdXRlRmlsZVBhdGguc3Vic3RyKHN0YXJ0KTtcblxuICByZXR1cm4gZmlsZVBhdGg7XG59XG5cbmZ1bmN0aW9uIGxpbmVOdW1iZXJGcm9tU3RhY2tNZXNzYWdlKHN0YWNrTWVzc2FnZSkge1xuICBjb25zdCBtYXRjaGVzID0gc3RhY2tNZXNzYWdlLm1hdGNoKC9cXDooXFxkKykvKSxcbiAgICAgICAgc2Vjb25kTWF0Y2ggPSBzZWNvbmQobWF0Y2hlcyksXG4gICAgICAgIGxpbmVOdW1iZXIgPSBzZWNvbmRNYXRjaDsgLy8vXG5cbiAgcmV0dXJuIGxpbmVOdW1iZXI7XG59XG5cbmZ1bmN0aW9uIHBhZFN0YXJ0V2l0aFplcm9lcyhzdHJpbmcsIHRhcmdldExlbmd0aCkge1xuICBjb25zdCBwYWRTdHJpbmcgPSAnMCcsXG4gICAgICAgIHBhZGRlZFN0cmluZyA9IHBhZFN0YXJ0KHN0cmluZywgdGFyZ2V0TGVuZ3RoLCBwYWRTdHJpbmcpO1xuXG4gIHJldHVybiBwYWRkZWRTdHJpbmc7XG59XG5cbmZ1bmN0aW9uIHBhZFN0YXJ0KHN0cmluZywgdGFyZ2V0TGVuZ3RoLCBwYWRTdHJpbmcpIHtcbiAgbGV0IHBhZGRpbmcgPSAnJztcblxuICBmb3IgKGxldCBpbmRleCA9IDA7IGluZGV4IDwgdGFyZ2V0TGVuZ3RoOyBpbmRleCsrKSB7XG4gICAgcGFkZGluZyArPSBwYWRTdHJpbmc7XG4gIH1cblxuICBjb25zdCBwYWRkZWRTdHJpbmcgPSBgJHtwYWRkaW5nfSR7c3RyaW5nfWAuc3Vic3RyKC10YXJnZXRMZW5ndGgpO1xuXG4gIHJldHVybiBwYWRkZWRTdHJpbmc7XG59XG5cbiJdfQ==