'use strict';

var path = require('path');

var arrayUtilities = require('../../utilities/array'),
    fileSystemUtilities = require('../../utilities/fileSystem');

var first = arrayUtilities.first,
    second = arrayUtilities.second,
    readFile = fileSystemUtilities.readFile,
    writeFile = fileSystemUtilities.writeFile,
    checkFileExists = fileSystemUtilities.checkFileExists;


var pathResolver = path.resolve,
    baseExtension = '';

function rc() {
  var environmentNameOrArgv = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : null;

  var environment = void 0,
      environmentName = void 0,
      environmentNameOrArgvArgv = environmentNameOrArgv instanceof Array;

  if (environmentNameOrArgvArgv) {
    var argv = environmentNameOrArgv; ///

    environmentName = environmentNameFromArgv(argv);
  } else {
    environmentName = environmentNameOrArgv; ///
  }

  var json = readRCFile(),
      environments = json.environments;


  if (environmentName === null) {
    var firstEnvironment = first(environments);

    environment = firstEnvironment; ///
  } else {
    environment = environments.find(function (environment) {
      var name = environment.name,
          found = name === environmentName;


      return found;
    });
  }

  delete environment.name;

  Object.assign(rc, environment);

  return environment;
}

function readRCFile() {
  var absoluteRCFilePath = absoluteRCFilePathFromNothing(),
      fileContent = readFile(absoluteRCFilePath),
      json = JSON.parse(fileContent);

  return json;
}

function writeRCFile(json) {
  var absoluteRCFilePath = absoluteRCFilePathFromNothing(),
      fileContent = JSON.stringify(json, null, '\t');

  writeFile(absoluteRCFilePath, fileContent);
}

function updateRCFile(addedProperties) {
  var json = readRCFile();

  if (addedProperties) {
    Object.assign(json, addedProperties);
  }

  for (var _len = arguments.length, deletedPropertyNames = Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {
    deletedPropertyNames[_key - 1] = arguments[_key];
  }

  deletedPropertyNames.forEach(function (deletedPropertyName) {
    delete json[deletedPropertyName];
  });

  writeRCFile(json);
}

function checkRCFileExists() {
  var absoluteRCFilePath = absoluteRCFilePathFromNothing(),
      rcFileExists = checkFileExists(absoluteRCFilePath);

  return rcFileExists;
}

function createVacuousRCFile() {
  var json = {
    "environments": [{}]
  };

  writeRCFile(json);
}

function setRCBaseExtension(rcBaseExtension) {
  baseExtension = rcBaseExtension;
}

function setRCPathResolver(rcPathResolver) {
  pathResolver = rcPathResolver;
}

Object.assign(rc, {
  readRCFile: readRCFile,
  writeRCFile: writeRCFile,
  updateRCFile: updateRCFile,
  checkRCFileExists: checkRCFileExists,
  createVacuousRCFile: createVacuousRCFile,
  setRCBaseExtension: setRCBaseExtension,
  setRCPathResolver: setRCPathResolver
});

module.exports = rc;

function environmentNameFromArgv(argv) {
  var environmentName = null;

  argv.find(function (argument) {
    ///
    var matches = argument.match(/\-\-environment=(.+)/),
        found = matches !== null;

    if (found) {
      var secondMatch = second(matches);

      environmentName = secondMatch;
    }

    return found;
  });

  return environmentName;
}

function absoluteRCFilePathFromNothing() {
  var filePath = './.' + baseExtension + 'rc',
      absoluteRCFilePath = pathResolver(filePath);

  return absoluteRCFilePath;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL2VzNi91dGlsaXRpZXMvbWlzY2VsbGFuZW91cy9yYy5qcyJdLCJuYW1lcyI6WyJwYXRoIiwicmVxdWlyZSIsImFycmF5VXRpbGl0aWVzIiwiZmlsZVN5c3RlbVV0aWxpdGllcyIsImZpcnN0Iiwic2Vjb25kIiwicmVhZEZpbGUiLCJ3cml0ZUZpbGUiLCJjaGVja0ZpbGVFeGlzdHMiLCJwYXRoUmVzb2x2ZXIiLCJyZXNvbHZlIiwiYmFzZUV4dGVuc2lvbiIsInJjIiwiZW52aXJvbm1lbnROYW1lT3JBcmd2IiwiZW52aXJvbm1lbnQiLCJlbnZpcm9ubWVudE5hbWUiLCJlbnZpcm9ubWVudE5hbWVPckFyZ3ZBcmd2IiwiQXJyYXkiLCJhcmd2IiwiZW52aXJvbm1lbnROYW1lRnJvbUFyZ3YiLCJyZWFkUkNGaWxlIiwiZW52aXJvbm1lbnRzIiwianNvbiIsImZpcnN0RW52aXJvbm1lbnQiLCJmaW5kIiwibmFtZSIsImZvdW5kIiwiT2JqZWN0IiwiYXNzaWduIiwiYWJzb2x1dGVSQ0ZpbGVQYXRoIiwiYWJzb2x1dGVSQ0ZpbGVQYXRoRnJvbU5vdGhpbmciLCJmaWxlQ29udGVudCIsIkpTT04iLCJwYXJzZSIsIndyaXRlUkNGaWxlIiwic3RyaW5naWZ5IiwidXBkYXRlUkNGaWxlIiwiYWRkZWRQcm9wZXJ0aWVzIiwiZGVsZXRlZFByb3BlcnR5TmFtZXMiLCJmb3JFYWNoIiwiZGVsZXRlZFByb3BlcnR5TmFtZSIsImNoZWNrUkNGaWxlRXhpc3RzIiwicmNGaWxlRXhpc3RzIiwiY3JlYXRlVmFjdW91c1JDRmlsZSIsInNldFJDQmFzZUV4dGVuc2lvbiIsInJjQmFzZUV4dGVuc2lvbiIsInNldFJDUGF0aFJlc29sdmVyIiwicmNQYXRoUmVzb2x2ZXIiLCJtb2R1bGUiLCJleHBvcnRzIiwiYXJndW1lbnQiLCJtYXRjaGVzIiwibWF0Y2giLCJzZWNvbmRNYXRjaCIsImZpbGVQYXRoIl0sIm1hcHBpbmdzIjoiQUFBQTs7QUFFQSxJQUFNQSxPQUFPQyxRQUFR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QUE2QztBQUFFbEMsa0JBQWdCa0MsZUFBaEI7QUFBa0M7O0FBRWpGLFNBQVNDLGlCQUFULENBQTJCQyxjQUEzQixFQUEyQztBQUFFdEMsaUJBQWVzQyxjQUFmO0FBQWdDOztBQUU3RXBCLE9BQU9DLE1BQVAsQ0FBY2hCLEVBQWQsRUFBa0I7QUFDaEJRLHdCQURnQjtBQUVoQmMsMEJBRmdCO0FBR2hCRSw0QkFIZ0I7QUFJaEJLLHNDQUpnQjtBQUtoQkUsMENBTGdCO0FBTWhCQyx3Q0FOZ0I7QUFPakJFO0FBUGlCLENBQWxCOztBQVVBRSxPQUFPQyxPQUFQLEdBQWlCckMsRUFBakI7O0FBRUEsU0FBU08sdUJBQVQsQ0FBaUNELElBQWpDLEVBQXVDO0FBQ3JDLE1BQUlILGtCQUFrQixJQUF0Qjs7QUFFQUcsT0FBS00sSUFBTCxDQUFVLFVBQVMwQixRQUFULEVBQW1CO0FBQUc7QUFDOUIsUUFBTUMsVUFBVUQsU0FBU0UsS0FBVCxDQUFlLHNCQUFmLENBQWhCO0FBQUEsUUFDTTFCLFFBQVN5QixZQUFZLElBRDNCOztBQUdBLFFBQUl6QixLQUFKLEVBQVc7QUFDVCxVQUFNMkIsY0FBY2hELE9BQU84QyxPQUFQLENBQXBCOztBQUVBcEMsd0JBQWtCc0MsV0FBbEI7QUFDRDs7QUFFRCxXQUFPM0IsS0FBUDtBQUNELEdBWEQ7O0FBYUEsU0FBT1gsZUFBUDtBQUNEOztBQUVELFNBQVNlLDZCQUFULEdBQXlDO0FBQ3ZDLE1BQU13QixtQkFBaUIzQyxhQUFqQixPQUFOO0FBQUEsTUFDTWtCLHFCQUFxQnBCLGFBQWE2QyxRQUFiLENBRDNCOztBQUdBLFNBQU96QixrQkFBUDtBQUNEIiwiZmlsZSI6InJjLmpzIiwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xuXG5jb25zdCBwYXRoID0gcmVxdWlyZSgncGF0aCcpO1xuXG5jb25zdCBhcnJheVV0aWxpdGllcyA9IHJlcXVpcmUoJy4uLy4uL3V0aWxpdGllcy9hcnJheScpLFxuICAgICAgZmlsZVN5c3RlbVV0aWxpdGllcyA9IHJlcXVpcmUoJy4uLy4uL3V0aWxpdGllcy9maWxlU3lzdGVtJyk7XG5cbmNvbnN0IHsgZmlyc3QsIHNlY29uZCB9ID0gYXJyYXlVdGlsaXRpZXMsXG4gICAgICB7IHJlYWRGaWxlLCB3cml0ZUZpbGUsIGNoZWNrRmlsZUV4aXN0cyB9ID0gZmlsZVN5c3RlbVV0aWxpdGllcztcblxubGV0IHBhdGhSZXNvbHZlciA9IHBhdGgucmVzb2x2ZSxcblx0XHRiYXNlRXh0ZW5zaW9uID0gJyc7XG5cbmZ1bmN0aW9uIHJjKGVudmlyb25tZW50TmFtZU9yQXJndiA9IG51bGwpIHtcbiAgbGV0IGVudmlyb25tZW50LFxuICAgICAgZW52aXJvbm1lbnROYW1lLFxuICAgICAgZW52aXJvbm1lbnROYW1lT3JBcmd2QXJndiA9IChlbnZpcm9ubWVudE5hbWVPckFyZ3YgaW5zdGFuY2VvZiBBcnJheSk7XG5cbiAgaWYgKGVudmlyb25tZW50TmFtZU9yQXJndkFyZ3YpIHtcbiAgICBjb25zdCBhcmd2ID0gZW52aXJvbm1lbnROYW1lT3JBcmd2OyAvLy9cblxuICAgIGVudmlyb25tZW50TmFtZSA9IGVudmlyb25tZW50TmFtZUZyb21Bcmd2KGFyZ3YpO1xuICB9IGVsc2Uge1xuICAgIGVudmlyb25tZW50TmFtZSA9IGVudmlyb25tZW50TmFtZU9yQXJndjsgIC8vL1xuICB9XG5cbiAgY29uc3QganNvbiA9IHJlYWRSQ0ZpbGUoKSxcbiAgICAgICAgeyBlbnZpcm9ubWVudHMgfSA9IGpzb247XG5cbiAgaWYgKGVudmlyb25tZW50TmFtZSA9PT0gbnVsbCkge1xuICAgIGNvbnN0IGZpcnN0RW52aXJvbm1lbnQgPSBmaXJzdChlbnZpcm9ubWVudHMpO1xuXG4gICAgZW52aXJvbm1lbnQgPSBmaXJzdEVudmlyb25tZW50OyAvLy9cbiAgfSBlbHNlIHtcbiAgICBlbnZpcm9ubWVudCA9IGVudmlyb25tZW50cy5maW5kKGZ1bmN0aW9uKGVudmlyb25tZW50KSB7XG4gICAgICBjb25zdCB7IG5hbWUgfSA9IGVudmlyb25tZW50LFxuICAgICAgICAgICAgZm91bmQgPSAobmFtZSA9PT0gZW52aXJvbm1lbnROYW1lKTtcblxuICAgICAgcmV0dXJuIGZvdW5kO1xuICAgIH0pO1xuICB9XG5cbiAgZGVsZXRlIGVudmlyb25tZW50Lm5hbWU7XG5cbiAgT2JqZWN0LmFzc2lnbihyYywgZW52aXJvbm1lbnQpO1xuXG4gIHJldHVybiBlbnZpcm9ubWVudDtcbn1cblxuZnVuY3Rpb24gcmVhZFJDRmlsZSgpIHtcbiAgY29uc3QgYWJzb2x1dGVSQ0ZpbGVQYXRoID0gYWJzb2x1dGVSQ0ZpbGVQYXRoRnJvbU5vdGhpbmcoKSxcbiAgICAgICAgZmlsZUNvbnRlbnQgPSByZWFkRmlsZShhYnNvbHV0ZVJDRmlsZVBhdGgpLFxuICAgICAgICBqc29uID0gSlNPTi5wYXJzZShmaWxlQ29udGVudCk7XG5cbiAgcmV0dXJuIGpzb247ICAgICAgXG59XG5cbmZ1bmN0aW9uIHdyaXRlUkNGaWxlKGpzb24pIHtcbiAgY29uc3QgYWJzb2x1dGVSQ0ZpbGVQYXRoID0gYWJzb2x1dGVSQ0ZpbGVQYXRoRnJvbU5vdGhpbmcoKSxcbiAgICAgICAgZmlsZUNvbnRlbnQgPSBKU09OLnN0cmluZ2lmeShqc29uLCBudWxsLCBgXFx0YCk7XG5cbiAgd3JpdGVGaWxlKGFic29sdXRlUkNGaWxlUGF0aCwgZmlsZUNvbnRlbnQpO1xufVxuXG5mdW5jdGlvbiB1cGRhdGVSQ0ZpbGUoYWRkZWRQcm9wZXJ0aWVzLCAuLi5kZWxldGVkUHJvcGVydHlOYW1lcykge1xuICBsZXQganNvbiA9IHJlYWRSQ0ZpbGUoKTtcblxuICBpZiAoYWRkZWRQcm9wZXJ0aWVzKSB7XG4gICAgT2JqZWN0LmFzc2lnbihqc29uLCBhZGRlZFByb3BlcnRpZXMpO1xuICB9XG5cbiAgZGVsZXRlZFByb3BlcnR5TmFtZXMuZm9yRWFjaChmdW5jdGlvbihkZWxldGVkUHJvcGVydHlOYW1lKSB7XG4gICAgZGVsZXRlIGpzb25bZGVsZXRlZFByb3BlcnR5TmFtZV07XG4gIH0pO1xuXG4gIHdyaXRlUkNGaWxlKGpzb24pOyAgICAgIFxufVxuXG5mdW5jdGlvbiBjaGVja1JDRmlsZUV4aXN0cygpIHtcbiAgY29uc3QgYWJzb2x1dGVSQ0ZpbGVQYXRoID0gYWJzb2x1dGVSQ0ZpbGVQYXRoRnJvbU5vdGhpbmcoKSxcbiAgICAgICAgcmNGaWxlRXhpc3RzID0gY2hlY2tGaWxlRXhpc3RzKGFic29sdXRlUkNGaWxlUGF0aCk7XG5cbiAgcmV0dXJuIHJjRmlsZUV4aXN0cztcbn1cblxuZnVuY3Rpb24gY3JlYXRlVmFjdW91c1JDRmlsZSgpIHtcbiAgY29uc3QganNvbiA9IHtcbiAgICBcImVudmlyb25tZW50c1wiOiBbXG4gICAgICB7fVxuICAgIF1cbiAgfTtcblxuICB3cml0ZVJDRmlsZShqc29uKTtcbn1cblxuZnVuY3Rpb24gc2V0UkNCYXNlRXh0ZW5zaW9uKHJjQmFzZUV4dGVuc2lvbikgeyBiYXNlRXh0ZW5zaW9uID0gcmNCYXNlRXh0ZW5zaW9uOyB9XG5cbmZ1bmN0aW9uIHNldFJDUGF0aFJlc29sdmVyKHJjUGF0aFJlc29sdmVyKSB7IHBhdGhSZXNvbHZlciA9IHJjUGF0aFJlc29sdmVyOyB9XG5cbk9iamVjdC5hc3NpZ24ocmMsIHtcbiAgcmVhZFJDRmlsZSxcbiAgd3JpdGVSQ0ZpbGUsXG4gIHVwZGF0ZVJDRmlsZSxcbiAgY2hlY2tSQ0ZpbGVFeGlzdHMsXG4gIGNyZWF0ZVZhY3VvdXNSQ0ZpbGUsXG4gIHNldFJDQmFzZUV4dGVuc2lvbixcblx0c2V0UkNQYXRoUmVzb2x2ZXJcbn0pO1xuXG5tb2R1bGUuZXhwb3J0cyA9IHJjO1xuXG5mdW5jdGlvbiBlbnZpcm9ubWVudE5hbWVGcm9tQXJndihhcmd2KSB7XG4gIGxldCBlbnZpcm9ubWVudE5hbWUgPSBudWxsO1xuXG4gIGFyZ3YuZmluZChmdW5jdGlvbihhcmd1bWVudCkgeyAgLy8vXG4gICAgY29uc3QgbWF0Y2hlcyA9IGFyZ3VtZW50Lm1hdGNoKC9cXC1cXC1lbnZpcm9ubWVudD0oLispLyksXG4gICAgICAgICAgZm91bmQgPSAobWF0Y2hlcyAhPT0gbnVsbCk7XG5cbiAgICBpZiAoZm91bmQpIHtcbiAgICAgIGNvbnN0IHNlY29uZE1hdGNoID0gc2Vjb25kKG1hdGNoZXMpO1xuXG4gICAgICBlbnZpcm9ubWVudE5hbWUgPSBzZWNvbmRNYXRjaDtcbiAgICB9XG5cbiAgICByZXR1cm4gZm91bmQ7XG4gIH0pO1xuXG4gIHJldHVybiBlbnZpcm9ubWVudE5hbWU7XG59XG5cbmZ1bmN0aW9uIGFic29sdXRlUkNGaWxlUGF0aEZyb21Ob3RoaW5nKCkge1xuICBjb25zdCBmaWxlUGF0aCA9IGAuLy4ke2Jhc2VFeHRlbnNpb259cmNgLFxuICAgICAgICBhYnNvbHV0ZVJDRmlsZVBhdGggPSBwYXRoUmVzb2x2ZXIoZmlsZVBhdGgpO1xuXG4gIHJldHVybiBhYnNvbHV0ZVJDRmlsZVBhdGg7XG59XG4iXX0=