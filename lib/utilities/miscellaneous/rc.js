'use strict';

var path = require('path');

var arrayUtilities = require('../../utilities/array'),
    fileSystemUtilities = require('../../utilities/fileSystem');

var first = arrayUtilities.first,
    second = arrayUtilities.second,
    readFile = fileSystemUtilities.readFile,
    writeFile = fileSystemUtilities.writeFile,
    checkFileExists = fileSystemUtilities.checkFileExists;


var rcBaseExtension = '';

function rc() {
  var environmentNameOrArgv = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : null;

  var environment = void 0,
      environmentName = void 0,
      environmentNameOrArgvArgv = environmentNameOrArgv instanceof Array;

  if (environmentNameOrArgvArgv) {
    var argv = environmentNameOrArgv; ///

    environmentName = environmentNameFromArgv(argv);
  } else {
    environmentName = environmentNameOrArgv; ///
  }

  var json = readRCFile(),
      environments = json.environments;


  if (environmentName === null) {
    var firstEnvironment = first(environments);

    environment = firstEnvironment; ///
  } else {
    environment = environments.find(function (environment) {
      var name = environment.name,
          found = name === environmentName;


      return found;
    });
  }

  delete environment.name;

  Object.assign(rc, environment);

  return environment;
}

function readRCFile() {
  var absoluteRCFilePath = absoluteRCFilePathFromNothing(),
      fileContent = readFile(absoluteRCFilePath),
      json = JSON.parse(fileContent);

  return json;
}

function writeRCFile(json) {
  var absoluteRCFilePath = absoluteRCFilePathFromNothing(),
      fileContent = JSON.stringify(json, null, '\t');

  writeFile(absoluteRCFilePath, fileContent);
}

function updateRCFile(addedProperties) {
  var json = readRCFile();

  if (addedProperties) {
    Object.assign(json, addedProperties);
  }

  for (var _len = arguments.length, deletedPropertyNames = Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {
    deletedPropertyNames[_key - 1] = arguments[_key];
  }

  deletedPropertyNames.forEach(function (deletedPropertyName) {
    delete json[deletedPropertyName];
  });

  writeRCFile(json);
}

function checkRCFileExists() {
  var absoluteRCFilePath = absoluteRCFilePathFromNothing(),
      rcFileExists = checkFileExists(absoluteRCFilePath);

  return rcFileExists;
}

function createVacuousRCFile() {
  var json = {
    "environments": [{}]
  };

  writeRCFile(json);
}

function setRCBaseExtension(baseExtension) {
  rcBaseExtension = baseExtension;
}

Object.assign(rc, {
  readRCFile: readRCFile,
  writeRCFile: writeRCFile,
  updateRCFile: updateRCFile,
  checkRCFileExists: checkRCFileExists,
  createVacuousRCFile: createVacuousRCFile,
  setRCBaseExtension: setRCBaseExtension
});

module.exports = rc;

function environmentNameFromArgv(argv) {
  var environmentName = null;

  argv.find(function (argument) {
    ///
    var matches = argument.match(/\-\-environment=(.+)/),
        found = matches !== null;

    if (found) {
      var secondMatch = second(matches);

      environmentName = secondMatch;
    }

    return found;
  });

  return environmentName;
}

function absoluteRCFilePathFromNothing() {
  var filePath = './.' + rcBaseExtension + 'rc',
      absoluteRCFilePath = path.resolve(filePath);

  return absoluteRCFilePath;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL2VzNi91dGlsaXRpZXMvbWlzY2VsbGFuZW91cy9yYy5qcyJdLCJuYW1lcyI6WyJwYXRoIiwicmVxdWlyZSIsImFycmF5VXRpbGl0aWVzIiwiZmlsZVN5c3RlbVV0aWxpdGllcyIsImZpcnN0Iiwic2Vjb25kIiwicmVhZEZpbGUiLCJ3cml0ZUZpbGUiLCJjaGVja0ZpbGVFeGlzdHMiLCJyY0Jhc2VFeHRlbnNpb24iLCJyYyIsImVudmlyb25tZW50TmFtZU9yQXJndiIsImVudmlyb25tZW50IiwiZW52aXJvbm1lbnROYW1lIiwiZW52aXJvbm1lbnROYW1lT3JBcmd2QXJndiIsIkFycmF5IiwiYXJndiIsImVudmlyb25tZW50TmFtZUZyb21Bcmd2IiwicmVhZFJDRmlsZSIsImVudmlyb25tZW50cyIsImpzb24iLCJmaXJzdEVudmlyb25tZW50IiwiZmluZCIsIm5hbWUiLCJmb3VuZCIsIk9iamVjdCIsImFzc2lnbiIsImFic29sdXRlUkNGaWxlUGF0aCIsImFic29sdXRlUkNGaWxlUGF0aEZyb21Ob3RoaW5nIiwiZmlsZUNvbnRlbnQiLCJKU09OIiwicGFyc2UiLCJ3cml0ZVJDRmlsZSIsInN0cmluZ2lmeSIsInVwZGF0ZVJDRmlsZSIsImFkZGVkUHJvcGVydGllcyIsImRlbGV0ZWRQcm9wZXJ0eU5hbWVzIiwiZm9yRWFjaCIsImRlbGV0ZWRQcm9wZXJ0eU5hbWUiLCJjaGVja1JDRmlsZUV4aXN0cyIsInJjRmlsZUV4aXN0cyIsImNyZWF0ZVZhY3VvdXNSQ0ZpbGUiLCJzZXRSQ0Jhc2VFeHRlbnNpb24iLCJiYXNlRXh0ZW5zaW9uIiwibW9kdWxlIiwiZXhwb3J0cyIsImFyZ3VtZW50IiwibWF0Y2hlcyIsIm1hdGNoIiwic2Vjb25kTWF0Y2giLCJmaWxlUGF0aCIsInJlc29sdmUiXSwibWFwcGluZ3MiOiJBQUFBOztBQUVBLElBQU1BLE9BQU9DLFFBQVEsTUFBUixDQUFiOztBQUVBLElBQU1DLGlCQUFpQkQsUUFBUSx1QkFBUixDQUF2QjtBQUFB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QSxVQURJO0FBRWhCYyxlQUFhQSxXQUZHO0FBR2hCRSxnQkFBY0EsWUFIRTtBQUloQksscUJBQW1CQSxpQkFKSDtBQUtoQkUsdUJBQXFCQSxtQkFMTDtBQU1oQkMsc0JBQW9CQTtBQU5KLENBQWxCOztBQVNBRSxPQUFPQyxPQUFQLEdBQWlCbkMsRUFBakI7O0FBRUEsU0FBU08sdUJBQVQsQ0FBaUNELElBQWpDLEVBQXVDO0FBQ3JDLE1BQUlILGtCQUFrQixJQUF0Qjs7QUFFQUcsT0FBS00sSUFBTCxDQUFVLFVBQVN3QixRQUFULEVBQW1CO0FBQUc7QUFDOUIsUUFBTUMsVUFBVUQsU0FBU0UsS0FBVCxDQUFlLHNCQUFmLENBQWhCO0FBQUEsUUFDTXhCLFFBQVN1QixZQUFZLElBRDNCOztBQUdBLFFBQUl2QixLQUFKLEVBQVc7QUFDVCxVQUFNeUIsY0FBYzVDLE9BQU8wQyxPQUFQLENBQXBCOztBQUVBbEMsd0JBQWtCb0MsV0FBbEI7QUFDRDs7QUFFRCxXQUFPekIsS0FBUDtBQUNELEdBWEQ7O0FBYUEsU0FBT1gsZUFBUDtBQUNEOztBQUVELFNBQVNlLDZCQUFULEdBQXlDO0FBQ3ZDLE1BQU1zQixtQkFBaUJ6QyxlQUFqQixPQUFOO0FBQUEsTUFDTWtCLHFCQUFxQjNCLEtBQUttRCxPQUFMLENBQWFELFFBQWIsQ0FEM0I7O0FBR0EsU0FBT3ZCLGtCQUFQO0FBQ0QiLCJmaWxlIjoicmMuanMiLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIHN0cmljdCc7XG5cbmNvbnN0IHBhdGggPSByZXF1aXJlKCdwYXRoJyk7XG5cbmNvbnN0IGFycmF5VXRpbGl0aWVzID0gcmVxdWlyZSgnLi4vLi4vdXRpbGl0aWVzL2FycmF5JyksXG4gICAgICBmaWxlU3lzdGVtVXRpbGl0aWVzID0gcmVxdWlyZSgnLi4vLi4vdXRpbGl0aWVzL2ZpbGVTeXN0ZW0nKTtcblxuY29uc3QgeyBmaXJzdCwgc2Vjb25kIH0gPSBhcnJheVV0aWxpdGllcyxcbiAgICAgIHsgcmVhZEZpbGUsIHdyaXRlRmlsZSwgY2hlY2tGaWxlRXhpc3RzIH0gPSBmaWxlU3lzdGVtVXRpbGl0aWVzO1xuXG5sZXQgcmNCYXNlRXh0ZW5zaW9uID0gJyc7XG5cbmZ1bmN0aW9uIHJjKGVudmlyb25tZW50TmFtZU9yQXJndiA9IG51bGwpIHtcbiAgbGV0IGVudmlyb25tZW50LFxuICAgICAgZW52aXJvbm1lbnROYW1lLFxuICAgICAgZW52aXJvbm1lbnROYW1lT3JBcmd2QXJndiA9IChlbnZpcm9ubWVudE5hbWVPckFyZ3YgaW5zdGFuY2VvZiBBcnJheSk7XG5cbiAgaWYgKGVudmlyb25tZW50TmFtZU9yQXJndkFyZ3YpIHtcbiAgICBjb25zdCBhcmd2ID0gZW52aXJvbm1lbnROYW1lT3JBcmd2OyAvLy9cblxuICAgIGVudmlyb25tZW50TmFtZSA9IGVudmlyb25tZW50TmFtZUZyb21Bcmd2KGFyZ3YpO1xuICB9IGVsc2Uge1xuICAgIGVudmlyb25tZW50TmFtZSA9IGVudmlyb25tZW50TmFtZU9yQXJndjsgIC8vL1xuICB9XG5cbiAgY29uc3QganNvbiA9IHJlYWRSQ0ZpbGUoKSxcbiAgICAgICAgeyBlbnZpcm9ubWVudHMgfSA9IGpzb247XG5cbiAgaWYgKGVudmlyb25tZW50TmFtZSA9PT0gbnVsbCkge1xuICAgIGNvbnN0IGZpcnN0RW52aXJvbm1lbnQgPSBmaXJzdChlbnZpcm9ubWVudHMpO1xuXG4gICAgZW52aXJvbm1lbnQgPSBmaXJzdEVudmlyb25tZW50OyAvLy9cbiAgfSBlbHNlIHtcbiAgICBlbnZpcm9ubWVudCA9IGVudmlyb25tZW50cy5maW5kKGZ1bmN0aW9uKGVudmlyb25tZW50KSB7XG4gICAgICBjb25zdCB7IG5hbWUgfSA9IGVudmlyb25tZW50LFxuICAgICAgICAgICAgZm91bmQgPSAobmFtZSA9PT0gZW52aXJvbm1lbnROYW1lKTtcblxuICAgICAgcmV0dXJuIGZvdW5kO1xuICAgIH0pO1xuICB9XG5cbiAgZGVsZXRlIGVudmlyb25tZW50Lm5hbWU7XG5cbiAgT2JqZWN0LmFzc2lnbihyYywgZW52aXJvbm1lbnQpO1xuXG4gIHJldHVybiBlbnZpcm9ubWVudDtcbn1cblxuZnVuY3Rpb24gcmVhZFJDRmlsZSgpIHtcbiAgY29uc3QgYWJzb2x1dGVSQ0ZpbGVQYXRoID0gYWJzb2x1dGVSQ0ZpbGVQYXRoRnJvbU5vdGhpbmcoKSxcbiAgICAgICAgZmlsZUNvbnRlbnQgPSByZWFkRmlsZShhYnNvbHV0ZVJDRmlsZVBhdGgpLFxuICAgICAgICBqc29uID0gSlNPTi5wYXJzZShmaWxlQ29udGVudCk7XG5cbiAgcmV0dXJuIGpzb247ICAgICAgXG59XG5cbmZ1bmN0aW9uIHdyaXRlUkNGaWxlKGpzb24pIHtcbiAgY29uc3QgYWJzb2x1dGVSQ0ZpbGVQYXRoID0gYWJzb2x1dGVSQ0ZpbGVQYXRoRnJvbU5vdGhpbmcoKSxcbiAgICAgICAgZmlsZUNvbnRlbnQgPSBKU09OLnN0cmluZ2lmeShqc29uLCBudWxsLCBgXFx0YCk7XG5cbiAgd3JpdGVGaWxlKGFic29sdXRlUkNGaWxlUGF0aCwgZmlsZUNvbnRlbnQpO1xufVxuXG5mdW5jdGlvbiB1cGRhdGVSQ0ZpbGUoYWRkZWRQcm9wZXJ0aWVzLCAuLi5kZWxldGVkUHJvcGVydHlOYW1lcykge1xuICBsZXQganNvbiA9IHJlYWRSQ0ZpbGUoKTtcblxuICBpZiAoYWRkZWRQcm9wZXJ0aWVzKSB7XG4gICAgT2JqZWN0LmFzc2lnbihqc29uLCBhZGRlZFByb3BlcnRpZXMpO1xuICB9XG5cbiAgZGVsZXRlZFByb3BlcnR5TmFtZXMuZm9yRWFjaChmdW5jdGlvbihkZWxldGVkUHJvcGVydHlOYW1lKSB7XG4gICAgZGVsZXRlIGpzb25bZGVsZXRlZFByb3BlcnR5TmFtZV07XG4gIH0pO1xuXG4gIHdyaXRlUkNGaWxlKGpzb24pOyAgICAgIFxufVxuXG5mdW5jdGlvbiBjaGVja1JDRmlsZUV4aXN0cygpIHtcbiAgY29uc3QgYWJzb2x1dGVSQ0ZpbGVQYXRoID0gYWJzb2x1dGVSQ0ZpbGVQYXRoRnJvbU5vdGhpbmcoKSxcbiAgICAgICAgcmNGaWxlRXhpc3RzID0gY2hlY2tGaWxlRXhpc3RzKGFic29sdXRlUkNGaWxlUGF0aCk7XG5cbiAgcmV0dXJuIHJjRmlsZUV4aXN0cztcbn1cblxuZnVuY3Rpb24gY3JlYXRlVmFjdW91c1JDRmlsZSgpIHtcbiAgY29uc3QganNvbiA9IHtcbiAgICBcImVudmlyb25tZW50c1wiOiBbXG4gICAgICB7fVxuICAgIF1cbiAgfTtcblxuICB3cml0ZVJDRmlsZShqc29uKTtcbn1cblxuZnVuY3Rpb24gc2V0UkNCYXNlRXh0ZW5zaW9uKGJhc2VFeHRlbnNpb24pIHsgcmNCYXNlRXh0ZW5zaW9uID0gYmFzZUV4dGVuc2lvbjsgfVxuXG5PYmplY3QuYXNzaWduKHJjLCB7XG4gIHJlYWRSQ0ZpbGU6IHJlYWRSQ0ZpbGUsXG4gIHdyaXRlUkNGaWxlOiB3cml0ZVJDRmlsZSxcbiAgdXBkYXRlUkNGaWxlOiB1cGRhdGVSQ0ZpbGUsXG4gIGNoZWNrUkNGaWxlRXhpc3RzOiBjaGVja1JDRmlsZUV4aXN0cyxcbiAgY3JlYXRlVmFjdW91c1JDRmlsZTogY3JlYXRlVmFjdW91c1JDRmlsZSxcbiAgc2V0UkNCYXNlRXh0ZW5zaW9uOiBzZXRSQ0Jhc2VFeHRlbnNpb25cbn0pO1xuXG5tb2R1bGUuZXhwb3J0cyA9IHJjO1xuXG5mdW5jdGlvbiBlbnZpcm9ubWVudE5hbWVGcm9tQXJndihhcmd2KSB7XG4gIGxldCBlbnZpcm9ubWVudE5hbWUgPSBudWxsO1xuXG4gIGFyZ3YuZmluZChmdW5jdGlvbihhcmd1bWVudCkgeyAgLy8vXG4gICAgY29uc3QgbWF0Y2hlcyA9IGFyZ3VtZW50Lm1hdGNoKC9cXC1cXC1lbnZpcm9ubWVudD0oLispLyksXG4gICAgICAgICAgZm91bmQgPSAobWF0Y2hlcyAhPT0gbnVsbCk7XG5cbiAgICBpZiAoZm91bmQpIHtcbiAgICAgIGNvbnN0IHNlY29uZE1hdGNoID0gc2Vjb25kKG1hdGNoZXMpO1xuXG4gICAgICBlbnZpcm9ubWVudE5hbWUgPSBzZWNvbmRNYXRjaDtcbiAgICB9XG5cbiAgICByZXR1cm4gZm91bmQ7XG4gIH0pO1xuXG4gIHJldHVybiBlbnZpcm9ubWVudE5hbWU7XG59XG5cbmZ1bmN0aW9uIGFic29sdXRlUkNGaWxlUGF0aEZyb21Ob3RoaW5nKCkge1xuICBjb25zdCBmaWxlUGF0aCA9IGAuLy4ke3JjQmFzZUV4dGVuc2lvbn1yY2AsXG4gICAgICAgIGFic29sdXRlUkNGaWxlUGF0aCA9IHBhdGgucmVzb2x2ZShmaWxlUGF0aCk7XG5cbiAgcmV0dXJuIGFic29sdXRlUkNGaWxlUGF0aDtcbn0iXX0=