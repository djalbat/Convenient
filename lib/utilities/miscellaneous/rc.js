'use strict';

var path = require('path');

var arrayUtilities = require('../../utilities/array'),
    fileSystemUtilities = require('../../utilities/fileSystem');

var first = arrayUtilities.first,
    second = arrayUtilities.second,
    readFile = fileSystemUtilities.readFile,
    writeFile = fileSystemUtilities.writeFile,
    checkFileExists = fileSystemUtilities.checkFileExists;


var rcBaseExtension = '';

function rc() {
  var environmentNameOrArgv = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : null;

  var environment = void 0,
      environmentName = void 0,
      environmentNameOrArgvArgv = environmentNameOrArgv instanceof Array;

  if (environmentNameOrArgvArgv) {
    var argv = environmentNameOrArgv; ///

    environmentName = environmentNameFromArgv(argv);
  } else {
    environmentName = environmentNameOrArgv; ///
  }

  var json = readRCFile(),
      environments = json.environments;


  if (environmentName === null) {
    var firstEnvironment = first(environments);

    environment = firstEnvironment; ///
  } else {
    environment = environments.find(function (environment) {
      var name = environment.name,
          found = name === environmentName;


      return found;
    });
  }

  delete environment.name;

  Object.assign(rc, environment);

  return environment;
}

function readRCFile() {
  var absoluteRCFilePath = absoluteRCFilePathFromNothing(),
      fileContent = readFile(absoluteRCFilePath),
      json = JSON.parse(fileContent);

  return json;
}

function writeRCFile(json) {
  var absoluteRCFilePath = absoluteRCFilePathFromNothing(),
      fileContent = JSON.stringify(json, null, '\t');

  writeFile(absoluteRCFilePath, fileContent);
}

function updateRCFile(addedProperties) {
  var json = readRCFile();

  if (addedProperties) {
    Object.assign(json, addedProperties);
  }

  for (var _len = arguments.length, deletedPropertyNames = Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {
    deletedPropertyNames[_key - 1] = arguments[_key];
  }

  deletedPropertyNames.forEach(function (deletedPropertyName) {
    delete json[deletedPropertyName];
  });

  writeRCFile(json);
}

function checkRCFileExists() {
  var absoluteRCFilePath = absoluteRCFilePathFromNothing(),
      rcFileExists = checkFileExists(absoluteRCFilePath);

  return rcFileExists;
}

function createVacuousRCFile() {
  var json = {
    "environments": [{}]
  };

  writeRCFile(json);
}

function setRCBaseExtension(baseExtension) {
  rcBaseExtension = baseExtension;
}

Object.assign(rc, {
  readRCFile: readRCFile,
  writeRCFile: writeRCFile,
  updateRCFile: updateRCFile,
  checkRCFileExists: checkRCFileExists,
  createVacuousRCFile: createVacuousRCFile,
  setRCBaseExtension: setRCBaseExtension
});

module.exports = rc;

function environmentNameFromArgv(argv) {
  var environmentName = null;

  argv.find(function (argument) {
    ///
    var matches = argument.match(/\-\-environment=(.+)/),
        found = matches !== null;

    if (found) {
      var secondMatch = second(matches);

      environmentName = secondMatch;
    }

    return found;
  });

  return environmentName;
}

function absoluteRCFilePathFromNothing() {
  var filePath = './.' + rcBaseExtension + 'rc',
      absoluteRCFilePath = path.resolve(filePath);

  return absoluteRCFilePath;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL2VzNi91dGlsaXRpZXMvbWlzY2VsbGFuZW91cy9yYy5qcyJdLCJuYW1lcyI6WyJwYXRoIiwicmVxdWlyZSIsImFycmF5VXRpbGl0aWVzIiwiZmlsZVN5c3RlbVV0aWxpdGllcyIsImZpcnN0Iiwic2Vjb25kIiwicmVhZEZpbGUiLCJ3cml0ZUZpbGUiLCJjaGVja0ZpbGVFeGlzdHMiLCJyY0Jhc2VFeHRlbnNpb24iLCJyYyIsImVudmlyb25tZW50TmFtZU9yQXJndiIsImVudmlyb25tZW50IiwiZW52aXJvbm1lbnROYW1lIiwiZW52aXJvbm1lbnROYW1lT3JBcmd2QXJndiIsIkFycmF5IiwiYXJndiIsImVudmlyb25tZW50TmFtZUZyb21Bcmd2IiwicmVhZFJDRmlsZSIsImVudmlyb25tZW50cyIsImpzb24iLCJmaXJzdEVudmlyb25tZW50IiwiZmluZCIsIm5hbWUiLCJmb3VuZCIsIk9iamVjdCIsImFzc2lnbiIsImFic29sdXRlUkNGaWxlUGF0aCIsImFic29sdXRlUkNGaWxlUGF0aEZyb21Ob3RoaW5nIiwiZmlsZUNvbnRlbnQiLCJKU09OIiwicGFyc2UiLCJ3cml0ZVJDRmlsZSIsInN0cmluZ2lmeSIsInVwZGF0ZVJDRmlsZSIsImFkZGVkUHJvcGVydGllcyIsImRlbGV0ZWRQcm9wZXJ0eU5hbWVzIiwiZm9yRWFjaCIsImRlbGV0ZWRQcm9wZXJ0eU5hbWUiLCJjaGVja1JDRmlsZUV4aXN0cyIsInJjRmlsZUV4aXN0cyIsImNyZWF0ZVZhY3VvdXNSQ0ZpbGUiLCJzZXRSQ0Jhc2VFeHRlbnNpb24iLCJiYXNlRXh0ZW5zaW9uIiwibW9kdWxlIiwiZXhwb3J0cyIsImFyZ3VtZW50IiwibWF0Y2hlcyIsIm1hdGNoIiwic2Vjb25kTWF0Y2giLCJmaWxlUGF0aCIsInJlc29sdmUiXSwibWFwcGluZ3MiOiJBQUFBOztBQUVBLElBQU1BLE9BQU9DLFFBQVEsTUFBUixDQUFiOztBQUVBLElBQU1DLGlCQUFpQkQsUUFBUSx1QkFBUixDQUF2QjtBQUFBLElBQ01FLHNCQUFzQkYsUUFBUSw0QkFBUixDQUQ1Qjs7SUFHUUcsSyxHQUFrQkYsYyxDQUFsQkUsSztJQUFPQyxNLEdBQVdILGMsQ0FBWEcsTTtJQUNQQyxRLEdBQXlDSCxtQixDQUF6Q0csUTtJQUFVQyxTLEdBQStCSixtQixDQUEvQkksUztJQUFXQyxlLEdBQW9CTCxtQixDQUFwQkssZTs7O0FBRTdCLElBQUlDLGtCQUFrQixFQUF0Qjs7QUFFQSxTQUFTQyxFQUFULEdBQTBDO0FBQUEsTUFBOUJDLHFCQUE4Qix1RUFBTixJQUFNOztBQUN4QyxNQUFJQyxvQkFBSjtBQUFBLE1BQ0lDLHdCQURKO0FBQUEsTUFFSUMsNEJBQTZCSCxpQ0FBaUNJLEtBRmxFOztBQUlBLE1BQUlELHlCQUFKLEVBQStCO0FBQzdCLFFBQU1FLE9BQU9MLHFCQUFiLENBRDZCLENBQ087O0FBRXBDRSxzQkFBa0JJLHdCQUF3QkQsSUFBeEIsQ0FBbEI7QUFDRCxHQUpELE1BSU87QUFDTEgsc0JBQWtCRixxQkFBbEIsQ0FESyxDQUNxQztBQUMzQzs7QUFFSyxhQUFPTyxZQUFQO0FBQUEsTUFDRUMsWUFERixHQUNtQkMsSUFEbkIsQ0FDRUQsWUFERjs7O0FBR04sTUFBSU4sb0JBQW9CLElBQXhCLEVBQThCO0FBQzVCLFFBQU1RLG1CQUFtQmpCLE1BQU1lLFlBQU4sQ0FBekI7O0FBRUFQLGtCQUFjUyxnQkFBZCxDQUg0QixDQUdJO0FBQ2pDLEdBSkQsTUFJTztBQUNMVCxrQkFBY08sYUFBYUcsSUFBYixDQUFrQixVQUFTVixXQUFULEVBQXNCO0FBQzlDLFVBQUVXLElBQUYsR0FBV1gsV0FBWCxDQUFFVyxJQUFGO0FBQUEsVUFDQUMsS0FEQSxHQUNTRCxTQUFTVixlQURsQjs7O0FBR04sYUFBT1csS0FBUDtBQUNELEtBTGEsQ0FBZDtBQU1EOztBQUVELFNBQU9aLFlBQVlXLElBQW5COztBQUVBRSxTQUFPQyxNQUFQLENBQWNoQixFQUFkLEVBQWtCRSxXQUFsQjs7QUFFQSxTQUFPQSxXQUFQO0FBQ0Q7O0FBRUQsU0FBU00sVUFBVCxHQUFzQjtBQUNwQixNQUFNUyxxQkFBcUJDLCtCQUEzQjtBQUFBLE1BQ01DLGNBQWN2QixTQUFTcUIsa0JBQVQsQ0FEcEI7QUFBQSxNQUVNUCxPQUFPVSxLQUFLQyxLQUFMLENBQVdGLFdBQVgsQ0FGYjs7QUFJQSxTQUFPVCxJQUFQO0FBQ0Q7O0FBRUQsU0FBU1ksV0FBVCxDQUFxQlosSUFBckIsRUFBMkI7QUFDekIsTUFBTU8scUJBQXFCQywrQkFBM0I7QUFBQSxNQUNNQyxjQUFjQyxLQUFLRyxTQUFMLENBQWViLElBQWYsRUFBcUIsSUFBckIsT0FEcEI7O0FBR0FiLFlBQVVvQixrQkFBVixFQUE4QkUsV0FBOUI7QUFDRDs7QUFFRCxTQUFTSyxZQUFULENBQXNCQyxlQUF0QixFQUFnRTtBQUM5RCxNQUFJZixPQUFPRixZQUFYOztBQUVBLE1BQUlpQixlQUFKLEVBQXFCO0FBQ25CVixXQUFPQyxNQUFQLENBQWNOLElBQWQsRUFBb0JlLGVBQXBCO0FBQ0Q7O0FBTDZELG9DQUF0QkMsb0JBQXNCO0FBQXRCQSx3QkFBc0I7QUFBQTs7QUFPOURBLHVCQUFxQkMsT0FBckIsQ0FBNkIsVUFBU0MsbUJBQVQsRUFBOEI7QUFDekQsV0FBT2xCLEtBQUtrQixtQkFBTCxDQUFQO0FBQ0QsR0FGRDs7QUFJQU4sY0FBWVosSUFBWjtBQUNEOztBQUVELFNBQVNtQixpQkFBVCxHQUE2QjtBQUMzQixNQUFNWixxQkFBcUJDLCtCQUEzQjtBQUFBLE1BQ01ZLGVBQWVoQyxnQkFBZ0JtQixrQkFBaEIsQ0FEckI7O0FBR0EsU0FBT2EsWUFBUDtBQUNEOztBQUVELFNBQVNDLG1CQUFULEdBQStCO0FBQzdCLE1BQU1yQixPQUFPO0FBQ1gsb0JBQWdCLENBQ2QsRUFEYztBQURMLEdBQWI7O0FBTUFZLGNBQVlaLElBQVo7QUFDRDs7QUFFRCxTQUFTc0Isa0JBQVQsQ0FBNEJDLGFBQTVCLEVBQTJDO0FBQUVsQyxvQkFBa0JrQyxhQUFsQjtBQUFrQzs7QUFFL0VsQixPQUFPQyxNQUFQLENBQWNoQixFQUFkLEVBQWtCO0FBQ2hCUSx3QkFEZ0I7QUFFaEJjLDBCQUZnQjtBQUdoQkUsNEJBSGdCO0FBSWhCSyxzQ0FKZ0I7QUFLaEJFLDBDQUxnQjtBQU1oQkM7QUFOZ0IsQ0FBbEI7O0FBU0FFLE9BQU9DLE9BQVAsR0FBaUJuQyxFQUFqQjs7QUFFQSxTQUFTTyx1QkFBVCxDQUFpQ0QsSUFBakMsRUFBdUM7QUFDckMsTUFBSUgsa0JBQWtCLElBQXRCOztBQUVBRyxPQUFLTSxJQUFMLENBQVUsVUFBU3dCLFFBQVQsRUFBbUI7QUFBRztBQUM5QixRQUFNQyxVQUFVRCxTQUFTRSxLQUFULENBQWUsc0JBQWYsQ0FBaEI7QUFBQSxRQUNNeEIsUUFBU3VCLFlBQVksSUFEM0I7O0FBR0EsUUFBSXZCLEtBQUosRUFBVztBQUNULFVBQU15QixjQUFjNUMsT0FBTzBDLE9BQVAsQ0FBcEI7O0FBRUFsQyx3QkFBa0JvQyxXQUFsQjtBQUNEOztBQUVELFdBQU96QixLQUFQO0FBQ0QsR0FYRDs7QUFhQSxTQUFPWCxlQUFQO0FBQ0Q7O0FBRUQsU0FBU2UsNkJBQVQsR0FBeUM7QUFDdkMsTUFBTXNCLG1CQUFpQnpDLGVBQWpCLE9BQU47QUFBQSxNQUNNa0IscUJBQXFCM0IsS0FBS21ELE9BQUwsQ0FBYUQsUUFBYixDQUQzQjs7QUFHQSxTQUFPdkIsa0JBQVA7QUFDRCIsImZpbGUiOiJyYy5qcyIsInNvdXJjZXNDb250ZW50IjpbIid1c2Ugc3RyaWN0JztcblxuY29uc3QgcGF0aCA9IHJlcXVpcmUoJ3BhdGgnKTtcblxuY29uc3QgYXJyYXlVdGlsaXRpZXMgPSByZXF1aXJlKCcuLi8uLi91dGlsaXRpZXMvYXJyYXknKSxcbiAgICAgIGZpbGVTeXN0ZW1VdGlsaXRpZXMgPSByZXF1aXJlKCcuLi8uLi91dGlsaXRpZXMvZmlsZVN5c3RlbScpO1xuXG5jb25zdCB7IGZpcnN0LCBzZWNvbmQgfSA9IGFycmF5VXRpbGl0aWVzLFxuICAgICAgeyByZWFkRmlsZSwgd3JpdGVGaWxlLCBjaGVja0ZpbGVFeGlzdHMgfSA9IGZpbGVTeXN0ZW1VdGlsaXRpZXM7XG5cbmxldCByY0Jhc2VFeHRlbnNpb24gPSAnJztcblxuZnVuY3Rpb24gcmMoZW52aXJvbm1lbnROYW1lT3JBcmd2ID0gbnVsbCkge1xuICBsZXQgZW52aXJvbm1lbnQsXG4gICAgICBlbnZpcm9ubWVudE5hbWUsXG4gICAgICBlbnZpcm9ubWVudE5hbWVPckFyZ3ZBcmd2ID0gKGVudmlyb25tZW50TmFtZU9yQXJndiBpbnN0YW5jZW9mIEFycmF5KTtcblxuICBpZiAoZW52aXJvbm1lbnROYW1lT3JBcmd2QXJndikge1xuICAgIGNvbnN0IGFyZ3YgPSBlbnZpcm9ubWVudE5hbWVPckFyZ3Y7IC8vL1xuXG4gICAgZW52aXJvbm1lbnROYW1lID0gZW52aXJvbm1lbnROYW1lRnJvbUFyZ3YoYXJndik7XG4gIH0gZWxzZSB7XG4gICAgZW52aXJvbm1lbnROYW1lID0gZW52aXJvbm1lbnROYW1lT3JBcmd2OyAgLy8vXG4gIH1cblxuICBjb25zdCBqc29uID0gcmVhZFJDRmlsZSgpLFxuICAgICAgICB7IGVudmlyb25tZW50cyB9ID0ganNvbjtcblxuICBpZiAoZW52aXJvbm1lbnROYW1lID09PSBudWxsKSB7XG4gICAgY29uc3QgZmlyc3RFbnZpcm9ubWVudCA9IGZpcnN0KGVudmlyb25tZW50cyk7XG5cbiAgICBlbnZpcm9ubWVudCA9IGZpcnN0RW52aXJvbm1lbnQ7IC8vL1xuICB9IGVsc2Uge1xuICAgIGVudmlyb25tZW50ID0gZW52aXJvbm1lbnRzLmZpbmQoZnVuY3Rpb24oZW52aXJvbm1lbnQpIHtcbiAgICAgIGNvbnN0IHsgbmFtZSB9ID0gZW52aXJvbm1lbnQsXG4gICAgICAgICAgICBmb3VuZCA9IChuYW1lID09PSBlbnZpcm9ubWVudE5hbWUpO1xuXG4gICAgICByZXR1cm4gZm91bmQ7XG4gICAgfSk7XG4gIH1cblxuICBkZWxldGUgZW52aXJvbm1lbnQubmFtZTtcblxuICBPYmplY3QuYXNzaWduKHJjLCBlbnZpcm9ubWVudCk7XG5cbiAgcmV0dXJuIGVudmlyb25tZW50O1xufVxuXG5mdW5jdGlvbiByZWFkUkNGaWxlKCkge1xuICBjb25zdCBhYnNvbHV0ZVJDRmlsZVBhdGggPSBhYnNvbHV0ZVJDRmlsZVBhdGhGcm9tTm90aGluZygpLFxuICAgICAgICBmaWxlQ29udGVudCA9IHJlYWRGaWxlKGFic29sdXRlUkNGaWxlUGF0aCksXG4gICAgICAgIGpzb24gPSBKU09OLnBhcnNlKGZpbGVDb250ZW50KTtcblxuICByZXR1cm4ganNvbjsgICAgICBcbn1cblxuZnVuY3Rpb24gd3JpdGVSQ0ZpbGUoanNvbikge1xuICBjb25zdCBhYnNvbHV0ZVJDRmlsZVBhdGggPSBhYnNvbHV0ZVJDRmlsZVBhdGhGcm9tTm90aGluZygpLFxuICAgICAgICBmaWxlQ29udGVudCA9IEpTT04uc3RyaW5naWZ5KGpzb24sIG51bGwsIGBcXHRgKTtcblxuICB3cml0ZUZpbGUoYWJzb2x1dGVSQ0ZpbGVQYXRoLCBmaWxlQ29udGVudCk7XG59XG5cbmZ1bmN0aW9uIHVwZGF0ZVJDRmlsZShhZGRlZFByb3BlcnRpZXMsIC4uLmRlbGV0ZWRQcm9wZXJ0eU5hbWVzKSB7XG4gIGxldCBqc29uID0gcmVhZFJDRmlsZSgpO1xuXG4gIGlmIChhZGRlZFByb3BlcnRpZXMpIHtcbiAgICBPYmplY3QuYXNzaWduKGpzb24sIGFkZGVkUHJvcGVydGllcyk7XG4gIH1cblxuICBkZWxldGVkUHJvcGVydHlOYW1lcy5mb3JFYWNoKGZ1bmN0aW9uKGRlbGV0ZWRQcm9wZXJ0eU5hbWUpIHtcbiAgICBkZWxldGUganNvbltkZWxldGVkUHJvcGVydHlOYW1lXTtcbiAgfSk7XG5cbiAgd3JpdGVSQ0ZpbGUoanNvbik7ICAgICAgXG59XG5cbmZ1bmN0aW9uIGNoZWNrUkNGaWxlRXhpc3RzKCkge1xuICBjb25zdCBhYnNvbHV0ZVJDRmlsZVBhdGggPSBhYnNvbHV0ZVJDRmlsZVBhdGhGcm9tTm90aGluZygpLFxuICAgICAgICByY0ZpbGVFeGlzdHMgPSBjaGVja0ZpbGVFeGlzdHMoYWJzb2x1dGVSQ0ZpbGVQYXRoKTtcblxuICByZXR1cm4gcmNGaWxlRXhpc3RzO1xufVxuXG5mdW5jdGlvbiBjcmVhdGVWYWN1b3VzUkNGaWxlKCkge1xuICBjb25zdCBqc29uID0ge1xuICAgIFwiZW52aXJvbm1lbnRzXCI6IFtcbiAgICAgIHt9XG4gICAgXVxuICB9O1xuXG4gIHdyaXRlUkNGaWxlKGpzb24pO1xufVxuXG5mdW5jdGlvbiBzZXRSQ0Jhc2VFeHRlbnNpb24oYmFzZUV4dGVuc2lvbikgeyByY0Jhc2VFeHRlbnNpb24gPSBiYXNlRXh0ZW5zaW9uOyB9XG5cbk9iamVjdC5hc3NpZ24ocmMsIHtcbiAgcmVhZFJDRmlsZSxcbiAgd3JpdGVSQ0ZpbGUsXG4gIHVwZGF0ZVJDRmlsZSxcbiAgY2hlY2tSQ0ZpbGVFeGlzdHMsXG4gIGNyZWF0ZVZhY3VvdXNSQ0ZpbGUsXG4gIHNldFJDQmFzZUV4dGVuc2lvblxufSk7XG5cbm1vZHVsZS5leHBvcnRzID0gcmM7XG5cbmZ1bmN0aW9uIGVudmlyb25tZW50TmFtZUZyb21Bcmd2KGFyZ3YpIHtcbiAgbGV0IGVudmlyb25tZW50TmFtZSA9IG51bGw7XG5cbiAgYXJndi5maW5kKGZ1bmN0aW9uKGFyZ3VtZW50KSB7ICAvLy9cbiAgICBjb25zdCBtYXRjaGVzID0gYXJndW1lbnQubWF0Y2goL1xcLVxcLWVudmlyb25tZW50PSguKykvKSxcbiAgICAgICAgICBmb3VuZCA9IChtYXRjaGVzICE9PSBudWxsKTtcblxuICAgIGlmIChmb3VuZCkge1xuICAgICAgY29uc3Qgc2Vjb25kTWF0Y2ggPSBzZWNvbmQobWF0Y2hlcyk7XG5cbiAgICAgIGVudmlyb25tZW50TmFtZSA9IHNlY29uZE1hdGNoO1xuICAgIH1cblxuICAgIHJldHVybiBmb3VuZDtcbiAgfSk7XG5cbiAgcmV0dXJuIGVudmlyb25tZW50TmFtZTtcbn1cblxuZnVuY3Rpb24gYWJzb2x1dGVSQ0ZpbGVQYXRoRnJvbU5vdGhpbmcoKSB7XG4gIGNvbnN0IGZpbGVQYXRoID0gYC4vLiR7cmNCYXNlRXh0ZW5zaW9ufXJjYCxcbiAgICAgICAgYWJzb2x1dGVSQ0ZpbGVQYXRoID0gcGF0aC5yZXNvbHZlKGZpbGVQYXRoKTtcblxuICByZXR1cm4gYWJzb2x1dGVSQ0ZpbGVQYXRoO1xufSJdfQ==