'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports["default"] = rc;

var _path = _interopRequireDefault(require("path"));

var _array = require("../../utilities/array");

var _fileSystem = require("../../utilities/fileSystem");

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { "default": obj }; }

var pathResolver = _path["default"].resolve,
    baseExtension = '';

function rc() {
  var environmentNameOrArgv = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : null;
  var environment,
      environmentName,
      environmentNameOrArgvArgv = environmentNameOrArgv instanceof Array;

  if (environmentNameOrArgvArgv) {
    var argv = environmentNameOrArgv; ///

    environmentName = environmentNameFromArgv(argv);
  } else {
    environmentName = environmentNameOrArgv; ///
  }

  var json = readRCFile(),
      environments = json.environments;

  if (environmentName === null) {
    var firstEnvironment = (0, _array.first)(environments);
    environment = firstEnvironment; ///
  } else {
    environment = environments.find(function (environment) {
      var name = environment.name,
          found = name === environmentName;
      return found;
    });
  }

  delete environment.name;
  Object.assign(rc, environment);
  return environment;
}

function readRCFile() {
  var absoluteRCFilePath = absoluteRCFilePathFromNothing(),
      fileContent = (0, _fileSystem.readFile)(absoluteRCFilePath),
      json = JSON.parse(fileContent);
  return json;
}

function writeRCFile(json) {
  var absoluteRCFilePath = absoluteRCFilePathFromNothing(),
      fileContent = JSON.stringify(json, null, "\t");
  (0, _fileSystem.writeFile)(absoluteRCFilePath, fileContent);
}

function updateRCFile(addedProperties) {
  var json = readRCFile();

  if (addedProperties) {
    Object.assign(json, addedProperties);
  }

  for (var _len = arguments.length, deletedPropertyNames = new Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {
    deletedPropertyNames[_key - 1] = arguments[_key];
  }

  deletedPropertyNames.forEach(function (deletedPropertyName) {
    delete json[deletedPropertyName];
  });
  writeRCFile(json);
}

function checkRCFileExists() {
  var absoluteRCFilePath = absoluteRCFilePathFromNothing(),
      rcFileExists = (0, _fileSystem.checkFileExists)(absoluteRCFilePath);
  return rcFileExists;
}

function createVacuousRCFile() {
  var json = {
    "environments": [{}]
  };
  writeRCFile(json);
}

function setRCBaseExtension(rcBaseExtension) {
  baseExtension = rcBaseExtension;
}

function setRCPathResolver(rcPathResolver) {
  pathResolver = rcPathResolver;
}

Object.assign(rc, {
  readRCFile: readRCFile,
  writeRCFile: writeRCFile,
  updateRCFile: updateRCFile,
  checkRCFileExists: checkRCFileExists,
  createVacuousRCFile: createVacuousRCFile,
  setRCBaseExtension: setRCBaseExtension,
  setRCPathResolver: setRCPathResolver
});

function environmentNameFromArgv(argv) {
  var environmentName = null;
  argv.find(function (argument) {
    ///
    var matches = argument.match(/--environment=(.+)/),
        found = matches !== null;

    if (found) {
      var secondMatch = (0, _array.second)(matches);
      environmentName = secondMatch;
    }

    return found;
  });
  return environmentName;
}

function absoluteRCFilePathFromNothing() {
  var filePath = "./.".concat(baseExtension, "rc"),
      absoluteRCFilePath = pathResolver(filePath);
  return absoluteRCFilePath;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInJjLmpzIl0sIm5hbWVzIjpbInBhdGhSZXNvbHZlciIsInBhdGgiLCJyZXNvbHZlIiwiYmFzZUV4dGVuc2lvbiIsInJjIiwiZW52aXJvbm1lbnROYW1lT3JBcmd2IiwiZW52aXJvbm1lbnQiLCJlbnZpcm9ubWVudE5hbWUiLCJlbnZpcm9ubWVudE5hbWVPckFyZ3ZBcmd2IiwiQXJyYXkiLCJhcmd2IiwiZW52aXJvbm1lbnROYW1lRnJvbUFyZ3YiLCJqc29uIiwicmVhZFJDRmlsZSIsImVudmlyb25tZW50cyIsImZpcnN0RW52aXJvbm1lbnQiLCJmaW5kIiwibmFtZSIsImZvdW5kIiwiT2JqZWN0IiwiYXNzaWduIiwiYWJzb2x1dGVSQ0ZpbGVQYXRoIiwiYWJzb2x1dGVSQ0ZpbGVQYXRoRnJvbU5vdGhpbmciLCJmaWxlQ29udGVudCIsIkpTT04iLCJwYXJzZSIsIndyaXRlUkNGaWxlIiwic3RyaW5naWZ5IiwidXBkYXRlUkNGaWxlIiwiYWRkZWRQcm9wZXJ0aWVzIiwiZGVsZXRlZFByb3BlcnR5TmFtZXMiLCJmb3JFYWNoIiwiZGVsZXRlZFByb3BlcnR5TmFtZSIsImNoZWNrUkNGaWxlRXhpc3RzIiwicmNGaWxlRXhpc3RzIiwiY3JlYXRlVmFjdW91c1JDRmlsZSIsInNldFJDQmFzZUV4dGVuc2lvbiIsInJjQmFzZUV4dGVuc2lvbiIsInNldFJDUGF0aFJlc29sdmVyIiwicmNQYXRoUmVzb2x2ZXIiLCJhcmd1bWVudCIsIm1hdGNoZXMiLCJtYXRjaCIsInNlY29uZE1hdGNoIiwiZmlsZVBhdGgiXSwibWFwcGluZ3MiOiJBQUFBOzs7Ozs7O0FBRUE7O0FBRUE7O0FBQ0E7Ozs7QUFFQSxJQUFJQSxZQUFZLEdBQUdDLGlCQUFLQyxPQUF4QjtBQUFBLElBQ0lDLGFBQWEsR0FBRyxFQURwQjs7QUFHZSxTQUFTQyxFQUFULEdBQTBDO0FBQUEsTUFBOUJDLHFCQUE4Qix1RUFBTixJQUFNO0FBQ3ZELE1BQUlDLFdBQUo7QUFBQSxNQUNJQyxlQURKO0FBQUEsTUFFSUMs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QUFQLENBQWNoQixFQUFkLEVBQWtCO0FBQ2hCUyxFQUFBQSxVQUFVLEVBQVZBLFVBRGdCO0FBRWhCYSxFQUFBQSxXQUFXLEVBQVhBLFdBRmdCO0FBR2hCRSxFQUFBQSxZQUFZLEVBQVpBLFlBSGdCO0FBSWhCSyxFQUFBQSxpQkFBaUIsRUFBakJBLGlCQUpnQjtBQUtoQkUsRUFBQUEsbUJBQW1CLEVBQW5CQSxtQkFMZ0I7QUFNaEJDLEVBQUFBLGtCQUFrQixFQUFsQkEsa0JBTmdCO0FBT2hCRSxFQUFBQSxpQkFBaUIsRUFBakJBO0FBUGdCLENBQWxCOztBQVVBLFNBQVMzQix1QkFBVCxDQUFpQ0QsSUFBakMsRUFBdUM7QUFDckMsTUFBSUgsZUFBZSxHQUFHLElBQXRCO0FBRUFHLEVBQUFBLElBQUksQ0FBQ00sSUFBTCxDQUFVLFVBQVN3QixRQUFULEVBQW1CO0FBQUc7QUFDOUIsUUFBTUMsT0FBTyxHQUFHRCxRQUFRLENBQUNFLEtBQVQsQ0FBZSxvQkFBZixDQUFoQjtBQUFBLFFBQ014QixLQUFLLEdBQUl1QixPQUFPLEtBQUssSUFEM0I7O0FBR0EsUUFBSXZCLEtBQUosRUFBVztBQUNULFVBQU15QixXQUFXLEdBQUcsbUJBQU9GLE9BQVAsQ0FBcEI7QUFFQWxDLE1BQUFBLGVBQWUsR0FBR29DLFdBQWxCO0FBQ0Q7O0FBRUQsV0FBT3pCLEtBQVA7QUFDRCxHQVhEO0FBYUEsU0FBT1gsZUFBUDtBQUNEOztBQUVELFNBQVNlLDZCQUFULEdBQXlDO0FBQ3ZDLE1BQU1zQixRQUFRLGdCQUFTekMsYUFBVCxPQUFkO0FBQUEsTUFDTWtCLGtCQUFrQixHQUFHckIsWUFBWSxDQUFDNEMsUUFBRCxDQUR2QztBQUdBLFNBQU92QixrQkFBUDtBQUNEIiwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xuXG5pbXBvcnQgcGF0aCBmcm9tICdwYXRoJztcblxuaW1wb3J0IHsgZmlyc3QsIHNlY29uZCB9IGZyb20gJy4uLy4uL3V0aWxpdGllcy9hcnJheSc7XG5pbXBvcnQgeyByZWFkRmlsZSwgd3JpdGVGaWxlLCBjaGVja0ZpbGVFeGlzdHMgfSBmcm9tICcuLi8uLi91dGlsaXRpZXMvZmlsZVN5c3RlbSc7XG5cbmxldCBwYXRoUmVzb2x2ZXIgPSBwYXRoLnJlc29sdmUsXG4gICAgYmFzZUV4dGVuc2lvbiA9ICcnO1xuXG5leHBvcnQgZGVmYXVsdCBmdW5jdGlvbiByYyhlbnZpcm9ubWVudE5hbWVPckFyZ3YgPSBudWxsKSB7XG4gIGxldCBlbnZpcm9ubWVudCxcbiAgICAgIGVudmlyb25tZW50TmFtZSxcbiAgICAgIGVudmlyb25tZW50TmFtZU9yQXJndkFyZ3YgPSAoZW52aXJvbm1lbnROYW1lT3JBcmd2IGluc3RhbmNlb2YgQXJyYXkpO1xuXG4gIGlmIChlbnZpcm9ubWVudE5hbWVPckFyZ3ZBcmd2KSB7XG4gICAgY29uc3QgYXJndiA9IGVudmlyb25tZW50TmFtZU9yQXJndjsgLy8vXG5cbiAgICBlbnZpcm9ubWVudE5hbWUgPSBlbnZpcm9ubWVudE5hbWVGcm9tQXJndihhcmd2KTtcbiAgfSBlbHNlIHtcbiAgICBlbnZpcm9ubWVudE5hbWUgPSBlbnZpcm9ubWVudE5hbWVPckFyZ3Y7ICAvLy9cbiAgfVxuXG4gIGNvbnN0IGpzb24gPSByZWFkUkNGaWxlKCksXG4gICAgICAgIHsgZW52aXJvbm1lbnRzIH0gPSBqc29uO1xuXG4gIGlmIChlbnZpcm9ubWVudE5hbWUgPT09IG51bGwpIHtcbiAgICBjb25zdCBmaXJzdEVudmlyb25tZW50ID0gZmlyc3QoZW52aXJvbm1lbnRzKTtcblxuICAgIGVudmlyb25tZW50ID0gZmlyc3RFbnZpcm9ubWVudDsgLy8vXG4gIH0gZWxzZSB7XG4gICAgZW52aXJvbm1lbnQgPSBlbnZpcm9ubWVudHMuZmluZChmdW5jdGlvbihlbnZpcm9ubWVudCkge1xuICAgICAgY29uc3QgeyBuYW1lIH0gPSBlbnZpcm9ubWVudCxcbiAgICAgICAgICAgIGZvdW5kID0gKG5hbWUgPT09IGVudmlyb25tZW50TmFtZSk7XG5cbiAgICAgIHJldHVybiBmb3VuZDtcbiAgICB9KTtcbiAgfVxuXG4gIGRlbGV0ZSBlbnZpcm9ubWVudC5uYW1lO1xuXG4gIE9iamVjdC5hc3NpZ24ocmMsIGVudmlyb25tZW50KTtcblxuICByZXR1cm4gZW52aXJvbm1lbnQ7XG59XG5cbmZ1bmN0aW9uIHJlYWRSQ0ZpbGUoKSB7XG4gIGNvbnN0IGFic29sdXRlUkNGaWxlUGF0aCA9IGFic29sdXRlUkNGaWxlUGF0aEZyb21Ob3RoaW5nKCksXG4gICAgICAgIGZpbGVDb250ZW50ID0gcmVhZEZpbGUoYWJzb2x1dGVSQ0ZpbGVQYXRoKSxcbiAgICAgICAganNvbiA9IEpTT04ucGFyc2UoZmlsZUNvbnRlbnQpO1xuXG4gIHJldHVybiBqc29uOyAgICAgIFxufVxuXG5mdW5jdGlvbiB3cml0ZVJDRmlsZShqc29uKSB7XG4gIGNvbnN0IGFic29sdXRlUkNGaWxlUGF0aCA9IGFic29sdXRlUkNGaWxlUGF0aEZyb21Ob3RoaW5nKCksXG4gICAgICAgIGZpbGVDb250ZW50ID0gSlNPTi5zdHJpbmdpZnkoanNvbiwgbnVsbCwgYFxcdGApO1xuXG4gIHdyaXRlRmlsZShhYnNvbHV0ZVJDRmlsZVBhdGgsIGZpbGVDb250ZW50KTtcbn1cblxuZnVuY3Rpb24gdXBkYXRlUkNGaWxlKGFkZGVkUHJvcGVydGllcywgLi4uZGVsZXRlZFByb3BlcnR5TmFtZXMpIHtcbiAgbGV0IGpzb24gPSByZWFkUkNGaWxlKCk7XG5cbiAgaWYgKGFkZGVkUHJvcGVydGllcykge1xuICAgIE9iamVjdC5hc3NpZ24oanNvbiwgYWRkZWRQcm9wZXJ0aWVzKTtcbiAgfVxuXG4gIGRlbGV0ZWRQcm9wZXJ0eU5hbWVzLmZvckVhY2goZnVuY3Rpb24oZGVsZXRlZFByb3BlcnR5TmFtZSkge1xuICAgIGRlbGV0ZSBqc29uW2RlbGV0ZWRQcm9wZXJ0eU5hbWVdO1xuICB9KTtcblxuICB3cml0ZVJDRmlsZShqc29uKTsgICAgICBcbn1cblxuZnVuY3Rpb24gY2hlY2tSQ0ZpbGVFeGlzdHMoKSB7XG4gIGNvbnN0IGFic29sdXRlUkNGaWxlUGF0aCA9IGFic29sdXRlUkNGaWxlUGF0aEZyb21Ob3RoaW5nKCksXG4gICAgICAgIHJjRmlsZUV4aXN0cyA9IGNoZWNrRmlsZUV4aXN0cyhhYnNvbHV0ZVJDRmlsZVBhdGgpO1xuXG4gIHJldHVybiByY0ZpbGVFeGlzdHM7XG59XG5cbmZ1bmN0aW9uIGNyZWF0ZVZhY3VvdXNSQ0ZpbGUoKSB7XG4gIGNvbnN0IGpzb24gPSB7XG4gICAgXCJlbnZpcm9ubWVudHNcIjogW1xuICAgICAge31cbiAgICBdXG4gIH07XG5cbiAgd3JpdGVSQ0ZpbGUoanNvbik7XG59XG5cbmZ1bmN0aW9uIHNldFJDQmFzZUV4dGVuc2lvbihyY0Jhc2VFeHRlbnNpb24pIHsgYmFzZUV4dGVuc2lvbiA9IHJjQmFzZUV4dGVuc2lvbjsgfVxuXG5mdW5jdGlvbiBzZXRSQ1BhdGhSZXNvbHZlcihyY1BhdGhSZXNvbHZlcikgeyBwYXRoUmVzb2x2ZXIgPSByY1BhdGhSZXNvbHZlcjsgfVxuXG5PYmplY3QuYXNzaWduKHJjLCB7XG4gIHJlYWRSQ0ZpbGUsXG4gIHdyaXRlUkNGaWxlLFxuICB1cGRhdGVSQ0ZpbGUsXG4gIGNoZWNrUkNGaWxlRXhpc3RzLFxuICBjcmVhdGVWYWN1b3VzUkNGaWxlLFxuICBzZXRSQ0Jhc2VFeHRlbnNpb24sXG4gIHNldFJDUGF0aFJlc29sdmVyXG59KTtcblxuZnVuY3Rpb24gZW52aXJvbm1lbnROYW1lRnJvbUFyZ3YoYXJndikge1xuICBsZXQgZW52aXJvbm1lbnROYW1lID0gbnVsbDtcblxuICBhcmd2LmZpbmQoZnVuY3Rpb24oYXJndW1lbnQpIHsgIC8vL1xuICAgIGNvbnN0IG1hdGNoZXMgPSBhcmd1bWVudC5tYXRjaCgvLS1lbnZpcm9ubWVudD0oLispLyksXG4gICAgICAgICAgZm91bmQgPSAobWF0Y2hlcyAhPT0gbnVsbCk7XG5cbiAgICBpZiAoZm91bmQpIHtcbiAgICAgIGNvbnN0IHNlY29uZE1hdGNoID0gc2Vjb25kKG1hdGNoZXMpO1xuXG4gICAgICBlbnZpcm9ubWVudE5hbWUgPSBzZWNvbmRNYXRjaDtcbiAgICB9XG5cbiAgICByZXR1cm4gZm91bmQ7XG4gIH0pO1xuXG4gIHJldHVybiBlbnZpcm9ubWVudE5hbWU7XG59XG5cbmZ1bmN0aW9uIGFic29sdXRlUkNGaWxlUGF0aEZyb21Ob3RoaW5nKCkge1xuICBjb25zdCBmaWxlUGF0aCA9IGAuLy4ke2Jhc2VFeHRlbnNpb259cmNgLFxuICAgICAgICBhYnNvbHV0ZVJDRmlsZVBhdGggPSBwYXRoUmVzb2x2ZXIoZmlsZVBhdGgpO1xuXG4gIHJldHVybiBhYnNvbHV0ZVJDRmlsZVBhdGg7XG59XG4iXX0=