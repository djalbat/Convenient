"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.get = get;
exports.post = post;
exports.request = request;
exports["default"] = void 0;

var _constants = require("../constants");

function get(host, path, parameters, callback) {
  if (callback === undefined) {
    callback = parameters; ///

    parameters = {};
  }

  var method = _constants.GET_METHOD,
      body = undefined;
  request(host, path, parameters, method, body, callback);
}

function post(host, path, json, parameters, callback) {
  if (callback === undefined) {
    callback = parameters; ///

    parameters = {};
  }

  var method = _constants.POST_METHOD,
      body = JSON.stringify(json);
  request(host, path, parameters, method, body, callback);
}

function request(host, path, parameters, method, body, callback) {
  var url = urlFromHostPathAndParameters(host, path, parameters),
      accept = _constants.APPLICATION_JSON_ACCEPT,
      xmlHttpRequest = new XMLHttpRequest();

  xmlHttpRequest.onreadystatechange = function () {
    var readyState = xmlHttpRequest.readyState,
        status = xmlHttpRequest.status,
        responseText = xmlHttpRequest.responseText;

    if (readyState == 4) {
      var json = null;

      if (status == 200) {
        var jsonString = responseText; ///

        try {
          json = JSON.parse(jsonString);
        } catch (error) {///
        }
      }

      callback(json, status);
    }
  };

  xmlHttpRequest.open(method, url);
  xmlHttpRequest.setRequestHeader("accept", accept);

  if (method === _constants.PUT_METHOD || method === _constants.POST_METHOD) {
    var contentType = _constants.APPLICATION_JSON_CONTENT_TYPE;
    xmlHttpRequest.setRequestHeader("content-type", contentType);
  }

  xmlHttpRequest.send(body);
}

var _default = {
  get: get,
  post: post,
  request: request
};
exports["default"] = _default;

function queryStringFromParameters(parameters) {
  var names = Object.keys(parameters),
      namesLength = names.length,
      lastIndex = namesLength - 1,
      queryString = names.reduce(function (queryString, name, index) {
    var value = parameters[name],
        encodedName = encodeURIComponent(name),
        encodedValue = encodeURIComponent(value),
        ampersandOrNothing = index !== lastIndex ? "&" : "";
    queryString += "".concat(encodedName, "=").concat(encodedValue).concat(ampersandOrNothing);
    return queryString;
  }, "");
  return queryString;
}

function urlFromHostPathAndParameters(host, path, parameters) {
  var queryString = queryStringFromParameters(parameters),
      url = queryString === "" ? "".concat(host).concat(path) : "".concat(host).concat(path, "?").concat(queryString);
  return url;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL2VzNi91dGlsaXRpZXMvYWpheC5qcyJdLCJuYW1lcyI6WyJnZXQiLCJob3N0IiwicGF0aCIsInBhcmFtZXRlcnMiLCJjYWxsYmFjayIsInVuZGVmaW5lZCIsIm1ldGhvZCIsIkdFVF9NRVRIT0QiLCJib2R5IiwicmVxdWVzdCIsInBvc3QiLCJqc29uIiwiUE9TVF9NRVRIT0QiLCJKU09OIiwic3RyaW5naWZ5IiwidXJsIiwidXJsRnJvbUhvc3RQYXRoQW5kUGFyYW1ldGVycyIsImFjY2VwdCIsIkFQUExJQ0FUSU9OX0pTT05fQUNDRVBUIiwieG1sSHR0cFJlcXVlc3QiLCJYTUxIdHRwUmVxdWVzdCIsIm9ucmVhZHlzdGF0ZWNoYW5nZSIsInJlYWR5U3RhdGUiLCJzdGF0dXMiLCJyZXNwb25zZVRleHQiLCJqc29uU3RyaW5nIiwicGFyc2UiLCJlcnJvciIsIm9wZW4iLCJzZXRSZXF1ZXN0SGVhZGVyIiwiUFVUX01FVEhPRCIsImNvbnRlbnRUeXBlIiwiQVBQTElDQVRJT05fSlNPTl9DT05URU5UX1RZUEUiLCJzZW5kIiwicXVlcnlTdHJpbmdGcm9tUGFyYW1ldGVycyIsIm5hbWVzIiwiT2JqZWN0Iiwia2V5cyIsIm5hbWVzTGVuZ3RoIiwibGVuZ3RoIiwibGFzdEluZGV4IiwicXVlcnlTdHJpbmciLCJyZWR1Y2UiLCJuYW1lIiwiaW5kZXgiLCJ2YWx1ZSIsImVuY29kZWROYW1lIiwiZW5jb2RlVVJJQ29tcG9uZW50IiwiZW5jb2RlZFZhbHVlIiwiYW1wZXJzYW5kT3JOb3RoaW5nIl0sIm1hcHBpbmdzIjoiQUFBQTs7Ozs7Ozs7OztBQUVBOztBQUVPLFNBQVNBLEdBQVQsQ0FBYUMsSUFBYixFQUFtQkMsSUFBbkIsRUFBeUJDLFVBQXpCLEVBQXFDQyxRQUFyQyxFQUErQztBQUNwRCxNQUFJQSxRQUFRLEtBQUtDLFNBQWpCLEVBQTRCO0FBQzFCRCxJQUFBQSxRQUFRLEdBQUdELFVBQVgsQ0FEMEIsQ0FDSDs7QUFDdkJBLElBQUFBLFVBQVUsR0FBRyxF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QyxTQUFTLEdBQUdGLFdBQVcsR0FBRyxDQUZoQztBQUFBLE1BR01HLFdBQVcsR0FBR04sS0FBSyxDQUFDTyxNQUFOLENBQWEsVUFBQ0QsV0FBRCxFQUFjRSxJQUFkLEVBQW9CQyxLQUFwQixFQUE4QjtBQUN2RCxRQUFNQyxLQUFLLEdBQUcxQyxVQUFVLENBQUN3QyxJQUFELENBQXhCO0FBQUEsUUFDTUcsV0FBVyxHQUFHQyxrQkFBa0IsQ0FBQ0osSUFBRCxDQUR0QztBQUFBLFFBRU1LLFlBQVksR0FBR0Qsa0JBQWtCLENBQUNGLEtBQUQsQ0FGdkM7QUFBQSxRQUdNSSxrQkFBa0IsR0FBSUwsS0FBSyxLQUFLSixTQUFYLEdBQXdCLEdBQXhCLEdBQThCLEVBSHpEO0FBS0FDLElBQUFBLFdBQVcsY0FBT0ssV0FBUCxjQUFzQkUsWUFBdEIsU0FBcUNDLGtCQUFyQyxDQUFYO0FBRUEsV0FBT1IsV0FBUDtBQUNELEdBVGEsRUFTWCxFQVRXLENBSHBCO0FBY0EsU0FBT0EsV0FBUDtBQUNEOztBQUVELFNBQVN6Qiw0QkFBVCxDQUFzQ2YsSUFBdEMsRUFBNENDLElBQTVDLEVBQWtEQyxVQUFsRCxFQUE4RDtBQUM1RCxNQUFNc0MsV0FBVyxHQUFHUCx5QkFBeUIsQ0FBQy9CLFVBQUQsQ0FBN0M7QUFBQSxNQUNNWSxHQUFHLEdBQUkwQixXQUFXLEtBQUssRUFBakIsYUFDR3hDLElBREgsU0FDVUMsSUFEVixjQUVLRCxJQUZMLFNBRVlDLElBRlosY0FFb0J1QyxXQUZwQixDQURaO0FBS0EsU0FBTzFCLEdBQVA7QUFDRCIsInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiO1xuXG5pbXBvcnQgeyBHRVRfTUVUSE9ELCBQVVRfTUVUSE9ELCBQT1NUX01FVEhPRCwgQVBQTElDQVRJT05fSlNPTl9BQ0NFUFQsIEFQUExJQ0FUSU9OX0pTT05fQ09OVEVOVF9UWVBFIH0gZnJvbSBcIi4uL2NvbnN0YW50c1wiO1xuXG5leHBvcnQgZnVuY3Rpb24gZ2V0KGhvc3QsIHBhdGgsIHBhcmFtZXRlcnMsIGNhbGxiYWNrKSB7XG4gIGlmIChjYWxsYmFjayA9PT0gdW5kZWZpbmVkKSB7XG4gICAgY2FsbGJhY2sgPSBwYXJhbWV0ZXJzOyAvLy9cbiAgICBwYXJhbWV0ZXJzID0ge307XG4gIH1cblxuICBjb25zdCBtZXRob2QgPSBHRVRfTUVUSE9ELFxuICAgICAgICBib2R5ID0gdW5kZWZpbmVkO1xuXG4gIHJlcXVlc3QoaG9zdCwgcGF0aCwgcGFyYW1ldGVycywgbWV0aG9kLCBib2R5LCBjYWxsYmFjayk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBwb3N0KGhvc3QsIHBhdGgsIGpzb24sIHBhcmFtZXRlcnMsIGNhbGxiYWNrKSB7XG4gIGlmIChjYWxsYmFjayA9PT0gdW5kZWZpbmVkKSB7XG4gICAgY2FsbGJhY2sgPSBwYXJhbWV0ZXJzOyAvLy9cbiAgICBwYXJhbWV0ZXJzID0ge307XG4gIH1cblxuICBjb25zdCBtZXRob2QgPSBQT1NUX01FVEhPRCxcbiAgICAgICAgYm9keSA9IEpTT04uc3RyaW5naWZ5KGpzb24pO1xuXG4gIHJlcXVlc3QoaG9zdCwgcGF0aCwgcGFyYW1ldGVycywgbWV0aG9kLCBib2R5LCBjYWxsYmFjayk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiByZXF1ZXN0KGhvc3QsIHBhdGgsIHBhcmFtZXRlcnMsIG1ldGhvZCwgYm9keSwgY2FsbGJhY2spIHtcbiAgY29uc3QgdXJsID0gdXJsRnJvbUhvc3RQYXRoQW5kUGFyYW1ldGVycyhob3N0LCBwYXRoLCBwYXJhbWV0ZXJzKSxcbiAgICAgICAgYWNjZXB0ID0gQVBQTElDQVRJT05fSlNPTl9BQ0NFUFQsXG4gICAgICAgIHhtbEh0dHBSZXF1ZXN0ID0gbmV3IFhNTEh0dHBSZXF1ZXN0KCk7XG5cbiAgeG1sSHR0cFJlcXVlc3Qub25yZWFkeXN0YXRlY2hhbmdlID0gKCkgPT4ge1xuICAgIGNvbnN0IHsgcmVhZHlTdGF0ZSwgc3RhdHVzLCByZXNwb25zZVRleHQgfSA9IHhtbEh0dHBSZXF1ZXN0O1xuXG4gICAgaWYgKHJlYWR5U3RhdGUgPT0gNCkge1xuICAgICAgbGV0IGpzb24gPSBudWxsO1xuXG4gICAgICBpZiAoc3RhdHVzID09IDIwMCkge1xuICAgICAgICBjb25zdCBqc29uU3RyaW5nID0gcmVzcG9uc2VUZXh0OyAvLy9cblxuICAgICAgICB0cnkge1xuICAgICAgICAgIGpzb24gPSBKU09OLnBhcnNlKGpzb25TdHJpbmcpO1xuICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgIC8vL1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIGNhbGxiYWNrKGpzb24sIHN0YXR1cyk7XG4gICAgfVxuICB9O1xuXG4gIHhtbEh0dHBSZXF1ZXN0Lm9wZW4obWV0aG9kLCB1cmwpO1xuXG4gIHhtbEh0dHBSZXF1ZXN0LnNldFJlcXVlc3RIZWFkZXIoXCJhY2NlcHRcIiwgYWNjZXB0KTtcblxuICBpZiAoKG1ldGhvZCA9PT0gUFVUX01FVEhPRCkgfHwgKG1ldGhvZCA9PT0gUE9TVF9NRVRIT0QpKSB7XG4gICAgY29uc3QgY29udGVudFR5cGUgPSBBUFBMSUNBVElPTl9KU09OX0NPTlRFTlRfVFlQRTtcblxuICAgIHhtbEh0dHBSZXF1ZXN0LnNldFJlcXVlc3RIZWFkZXIoXCJjb250ZW50LXR5cGVcIiwgY29udGVudFR5cGUpO1xuICB9XG5cbiAgeG1sSHR0cFJlcXVlc3Quc2VuZChib2R5KTtcbn1cblxuZXhwb3J0IGRlZmF1bHQge1xuICBnZXQsXG4gIHBvc3QsXG4gIHJlcXVlc3Rcbn1cblxuZnVuY3Rpb24gcXVlcnlTdHJpbmdGcm9tUGFyYW1ldGVycyhwYXJhbWV0ZXJzKSB7XG4gIGNvbnN0IG5hbWVzID0gT2JqZWN0LmtleXMocGFyYW1ldGVycyksXG4gICAgICAgIG5hbWVzTGVuZ3RoID0gbmFtZXMubGVuZ3RoLFxuICAgICAgICBsYXN0SW5kZXggPSBuYW1lc0xlbmd0aCAtIDEsXG4gICAgICAgIHF1ZXJ5U3RyaW5nID0gbmFtZXMucmVkdWNlKChxdWVyeVN0cmluZywgbmFtZSwgaW5kZXgpID0+IHtcbiAgICAgICAgICBjb25zdCB2YWx1ZSA9IHBhcmFtZXRlcnNbbmFtZV0sXG4gICAgICAgICAgICAgICAgZW5jb2RlZE5hbWUgPSBlbmNvZGVVUklDb21wb25lbnQobmFtZSksXG4gICAgICAgICAgICAgICAgZW5jb2RlZFZhbHVlID0gZW5jb2RlVVJJQ29tcG9uZW50KHZhbHVlKSxcbiAgICAgICAgICAgICAgICBhbXBlcnNhbmRPck5vdGhpbmcgPSAoaW5kZXggIT09IGxhc3RJbmRleCkgPyBcIiZcIiA6IFwiXCI7XG4gIFxuICAgICAgICAgIHF1ZXJ5U3RyaW5nICs9IGAke2VuY29kZWROYW1lfT0ke2VuY29kZWRWYWx1ZX0ke2FtcGVyc2FuZE9yTm90aGluZ31gO1xuICBcbiAgICAgICAgICByZXR1cm4gcXVlcnlTdHJpbmc7XG4gICAgICAgIH0sIFwiXCIpO1xuXG4gIHJldHVybiBxdWVyeVN0cmluZztcbn1cblxuZnVuY3Rpb24gdXJsRnJvbUhvc3RQYXRoQW5kUGFyYW1ldGVycyhob3N0LCBwYXRoLCBwYXJhbWV0ZXJzKSB7XG4gIGNvbnN0IHF1ZXJ5U3RyaW5nID0gcXVlcnlTdHJpbmdGcm9tUGFyYW1ldGVycyhwYXJhbWV0ZXJzKSxcbiAgICAgICAgdXJsID0gKHF1ZXJ5U3RyaW5nID09PSBcIlwiKSA/XG4gICAgICAgICAgICAgIGAke2hvc3R9JHtwYXRofWAgOlxuICAgICAgICAgICAgICAgIGAke2hvc3R9JHtwYXRofT8ke3F1ZXJ5U3RyaW5nfWA7XG5cbiAgcmV0dXJuIHVybDtcbn1cbiJdfQ==