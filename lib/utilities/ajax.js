"use strict";

import { GET, POST, ACCEPT, CONTENT_TYPE, APPLICATION_JSON } from "../constants";
export function get(host, uri, parameters, headers, callback) {
  if (callback === undefined) {
    callback = headers; ///

    headers = {};
  }

  const method = GET,
        body = null;
  underwriteAccept(headers);
  request(host, uri, parameters, method, body, headers, callback);
}
export function post(host, uri, parameters, body, headers, callback) {
  if (callback === undefined) {
    callback = headers; ///

    headers = {};
  }

  const method = POST;
  underwriteAccept(headers);
  underwriteContentType(headers);
  request(host, uri, parameters, method, body, headers, callback);
}
export function request(host, uri, parameters, method, body, headers, callback) {
  const url = urlFromHostURIAndParameters(host, uri, parameters),
        accept = headers[ACCEPT] || null,
        contentType = headers[CONTENT_TYPE] || null,
        xmlHttpRequest = new XMLHttpRequest();

  if (contentType === APPLICATION_JSON) {
    const json = body,
          ///
    jsonString = JSON.stringify(json);
    body = jsonString; ///
  }

  xmlHttpRequest.onreadystatechange = () => {
    const {
      readyState,
      status,
      responseText
    } = xmlHttpRequest;

    if (readyState == 4) {
      let body = responseText;

      if (accept === APPLICATION_JSON) {
        try {
          const jsonString = body,
                ///
          json = JSON.parse(jsonString);
          body = json; ///
        } catch (error) {
          body = null;
        }

        callback(body, status);
      }
    }
  };

  xmlHttpRequest.open(method, url);

  if (accept !== null) {
    xmlHttpRequest.setRequestHeader(ACCEPT, accept);
  }

  if (contentType !== null) {
    xmlHttpRequest.setRequestHeader(CONTENT_TYPE, contentType);
  }

  body !== null ? xmlHttpRequest.send(body) : xmlHttpRequest.send();
}
export default {
  get,
  post,
  request
};

function underwrite(headers, name, value) {
  const ownPropertyNames = Object.getOwnPropertyNames(headers),
        lowercaseName = name.toLowerCase(),
        lowerCaseOwnPropertyNames = ownPropertyNames.map(ownPropertyName => {
    const lowerCaseOwnPropertyName = ownPropertyName.toLowerCase();
    return lowerCaseOwnPropertyName;
  }),
        lowerCaseOwnPropertyNamesIncludesLowercaseName = lowerCaseOwnPropertyNames.includes(lowercaseName);

  if (!lowerCaseOwnPropertyNamesIncludesLowercaseName) {
    headers[name] = value;
  }
}

function underwriteAccept(headers) {
  const name = ACCEPT,
        ///
  value = APPLICATION_JSON; ///

  underwrite(headers, name, value);
}

function underwriteContentType(headers) {
  const name = CONTENT_TYPE,
        ///
  value = APPLICATION_JSON; ///

  underwrite(headers, name, value);
}

function queryStringFromParameters(parameters) {
  const names = Object.keys(parameters),
        namesLength = names.length,
        lastIndex = namesLength - 1,
        queryString = names.reduce((queryString, name, index) => {
    const value = parameters[name],
          encodedName = encodeURIComponent(name),
          encodedValue = encodeURIComponent(value),
          ampersandOrNothing = index !== lastIndex ? "&" : "";
    queryString += `${encodedName}=${encodedValue}${ampersandOrNothing}`;
    return queryString;
  }, "");
  return queryString;
}

function urlFromHostURIAndParameters(host, uri, parameters) {
  const queryString = queryStringFromParameters(parameters),
        url = queryString === "" ? `${host}${uri}` : `${host}${uri}?${queryString}`;
  return url;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFqYXguanMiXSwibmFtZXMiOlsiR0VUIiwiUE9TVCIsIkFDQ0VQVCIsIkNPTlRFTlRfVFlQRSIsIkFQUExJQ0FUSU9OX0pTT04iLCJnZXQiLCJob3N0IiwidXJpIiwicGFyYW1ldGVycyIsImhlYWRlcnMiLCJjYWxsYmFjayIsInVuZGVmaW5lZCIsIm1ldGhvZCIsImJvZHkiLCJ1bmRlcndyaXRlQWNjZXB0IiwicmVxdWVzdCIsInBvc3QiLCJ1bmRlcndyaXRlQ29udGVudFR5cGUiLCJ1cmwiLCJ1cmxGcm9tSG9zdFVSSUFuZFBhcmFtZXRlcnMiLCJhY2NlcHQiLCJjb250ZW50VHlwZSIsInhtbEh0dHBSZXF1ZXN0IiwiWE1MSHR0cFJlcXVlc3QiLCJqc29uIiwianNvblN0cmluZyIsIkpTT04iLCJzdHJpbmdpZnkiLCJvbnJlYWR5c3RhdGVjaGFuZ2UiLCJyZWFkeVN0YXRlIiwic3RhdHVzIiwicmVzcG9uc2VUZXh0IiwicGFyc2UiLCJlcnJvciIsIm9wZW4iLCJzZXRSZXF1ZXN0SGVhZGVyIiwic2VuZCIsInVuZGVyd3JpdGUiLCJuYW1lIiwidmFsdWUiLCJvd25Qcm9wZXJ0eU5hbWVzIiwiT2JqZWN0IiwiZ2V0T3duUHJvcGVydHlOYW1lcyIsImxvd2VyY2FzZU5hbWUiLCJ0b0xvd2VyQ2FzZSIsImxvd2VyQ2FzZU93blByb3BlcnR5TmFtZXMiLCJtYXAiLCJvd25Qcm9wZXJ0eU5hbWUiLCJsb3dlckNhc2VPd25Qcm9wZXJ0eU5hbWUiLCJsb3dlckNhc2VPd25Qcm9wZXJ0eU5hbWVzSW5jbHVkZXNMb3dlcmNhc2VOYW1lIiwiaW5jbHVkZXMiLCJxdWVyeVN0cmluZ0Zyb21QYXJhbWV0ZXJzIiwibmFtZXMiLCJrZXlzIiwibmFtZXNMZW5ndGgiLCJsZW5ndGgiLCJsYXN0SW5kZXgiLCJxdWVyeVN0cmluZyIsInJlZHVjZSIsImluZGV4IiwiZW5jb2RlZE5hbWUiLCJlbmNvZGVVUklDb21wb25lbnQiLCJlbmNvZGVkVmFsdWUiLCJhbXBlcnNhbmRPck5v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QUFBQSxVQUdNd0Isa0JBQWtCLEdBQUlKLEtBQUssS0FBS0gsU0FBWCxHQUF3QixHQUF4QixHQUE4QixFQUh6RDtBQUtBQyxJQUFBQSxXQUFXLElBQUssR0FBRUcsV0FBWSxJQUFHRSxZQUFhLEdBQUVDLGtCQUFtQixFQUFuRTtBQUVBLFdBQU9OLFdBQVA7QUFDRCxHQVRhLEVBU1gsRUFUVyxDQUhwQjtBQWNBLFNBQU9BLFdBQVA7QUFDRDs7QUFFRCxTQUFTdEMsMkJBQVQsQ0FBcUNiLElBQXJDLEVBQTJDQyxHQUEzQyxFQUFnREMsVUFBaEQsRUFBNEQ7QUFDMUQsUUFBTWlELFdBQVcsR0FBR04seUJBQXlCLENBQUMzQyxVQUFELENBQTdDO0FBQUEsUUFDTVUsR0FBRyxHQUFJdUMsV0FBVyxLQUFLLEVBQWpCLEdBQ0MsR0FBRW5ELElBQUssR0FBRUMsR0FBSSxFQURkLEdBRUcsR0FBRUQsSUFBSyxHQUFFQyxHQUFJLElBQUdrRCxXQUFZLEVBSDNDO0FBS0EsU0FBT3ZDLEdBQVA7QUFDRCIsInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiO1xuXG5pbXBvcnQgeyBHRVQsXG4gICAgICAgICBQT1NULFxuICAgICAgICAgQUNDRVBULFxuICAgICAgICAgQ09OVEVOVF9UWVBFLFxuICAgICAgICAgQVBQTElDQVRJT05fSlNPTiB9IGZyb20gXCIuLi9jb25zdGFudHNcIjtcblxuZXhwb3J0IGZ1bmN0aW9uIGdldChob3N0LCB1cmksIHBhcmFtZXRlcnMsIGhlYWRlcnMsIGNhbGxiYWNrKSB7XG4gIGlmIChjYWxsYmFjayA9PT0gdW5kZWZpbmVkKSB7XG4gICAgY2FsbGJhY2sgPSBoZWFkZXJzOyAvLy9cbiAgICBoZWFkZXJzID0ge307XG4gIH1cblxuICBjb25zdCBtZXRob2QgPSBHRVQsXG4gICAgICAgIGJvZHkgPSBudWxsO1xuXG4gIHVuZGVyd3JpdGVBY2NlcHQoaGVhZGVycyk7XG5cbiAgcmVxdWVzdChob3N0LCB1cmksIHBhcmFtZXRlcnMsIG1ldGhvZCwgYm9keSwgaGVhZGVycywgY2FsbGJhY2spO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gcG9zdChob3N0LCB1cmksIHBhcmFtZXRlcnMsIGJvZHksIGhlYWRlcnMsIGNhbGxiYWNrKSB7XG4gIGlmIChjYWxsYmFjayA9PT0gdW5kZWZpbmVkKSB7XG4gICAgY2FsbGJhY2sgPSBoZWFkZXJzOyAvLy9cbiAgICBoZWFkZXJzID0ge307XG4gIH1cblxuICBjb25zdCBtZXRob2QgPSBQT1NUO1xuXG4gIHVuZGVyd3JpdGVBY2NlcHQoaGVhZGVycyk7XG5cbiAgdW5kZXJ3cml0ZUNvbnRlbnRUeXBlKGhlYWRlcnMpO1xuXG4gIHJlcXVlc3QoaG9zdCwgdXJpLCBwYXJhbWV0ZXJzLCBtZXRob2QsIGJvZHksIGhlYWRlcnMsIGNhbGxiYWNrKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHJlcXVlc3QoaG9zdCwgdXJpLCBwYXJhbWV0ZXJzLCBtZXRob2QsIGJvZHksIGhlYWRlcnMsIGNhbGxiYWNrKSB7XG4gIGNvbnN0IHVybCA9IHVybEZyb21Ib3N0VVJJQW5kUGFyYW1ldGVycyhob3N0LCB1cmksIHBhcmFtZXRlcnMpLFxuICAgICAgICBhY2NlcHQgPSBoZWFkZXJzW0FDQ0VQVF0gfHwgbnVsbCxcbiAgICAgICAgY29udGVudFR5cGUgPSBoZWFkZXJzW0NPTlRFTlRfVFlQRV0gfHwgbnVsbCxcbiAgICAgICAgeG1sSHR0cFJlcXVlc3QgPSBuZXcgWE1MSHR0cFJlcXVlc3QoKTtcblxuICBpZiAoY29udGVudFR5cGUgPT09IEFQUExJQ0FUSU9OX0pTT04pIHtcbiAgICBjb25zdCBqc29uID0gYm9keSwgIC8vL1xuICAgICAgICAgIGpzb25TdHJpbmcgPSBKU09OLnN0cmluZ2lmeShqc29uKTtcblxuICAgIGJvZHkgPSBqc29uU3RyaW5nOyAgLy8vXG4gIH1cblxuICB4bWxIdHRwUmVxdWVzdC5vbnJlYWR5c3RhdGVjaGFuZ2UgPSAoKSA9PiB7XG4gICAgY29uc3QgeyByZWFkeVN0YXRlLCBzdGF0dXMsIHJlc3BvbnNlVGV4dCB9ID0geG1sSHR0cFJlcXVlc3Q7XG5cbiAgICBpZiAocmVhZHlTdGF0ZSA9PSA0KSB7XG4gICAgICBsZXQgYm9keSA9IHJlc3BvbnNlVGV4dDtcblxuICAgICAgaWYgKGFjY2VwdCA9PT0gQVBQTElDQVRJT05fSlNPTikge1xuICAgICAgICB0cnkge1xuICAgICAgICAgIGNvbnN0IGpzb25TdHJpbmcgPSBib2R5LCAgLy8vXG4gICAgICAgICAgICAgICAganNvbiA9IEpTT04ucGFyc2UoanNvblN0cmluZyk7XG5cbiAgICAgICAgICBib2R5ID0ganNvbjsgIC8vL1xuICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgIGJvZHkgPSBudWxsO1xuICAgICAgICB9XG5cbiAgICAgICAgY2FsbGJhY2soYm9keSwgc3RhdHVzKTtcbiAgICAgIH1cbiAgICB9XG4gIH07XG5cbiAgeG1sSHR0cFJlcXVlc3Qub3BlbihtZXRob2QsIHVybCk7XG5cbiAgaWYgKGFjY2VwdCAhPT0gbnVsbCkge1xuICAgIHhtbEh0dHBSZXF1ZXN0LnNldFJlcXVlc3RIZWFkZXIoQUNDRVBULCBhY2NlcHQpO1xuICB9XG5cbiAgaWYgKGNvbnRlbnRUeXBlICE9PSBudWxsKSB7XG4gICAgeG1sSHR0cFJlcXVlc3Quc2V0UmVxdWVzdEhlYWRlcihDT05URU5UX1RZUEUsIGNvbnRlbnRUeXBlKTtcbiAgfVxuXG4gIChib2R5ICE9PSBudWxsKSA/XG4gICAgeG1sSHR0cFJlcXVlc3Quc2VuZChib2R5KSA6XG4gICAgICB4bWxIdHRwUmVxdWVzdC5zZW5kKCk7XG59XG5cbmV4cG9ydCBkZWZhdWx0IHtcbiAgZ2V0LFxuICBwb3N0LFxuICByZXF1ZXN0XG59XG5cbmZ1bmN0aW9uIHVuZGVyd3JpdGUoaGVhZGVycywgbmFtZSwgdmFsdWUpIHtcbiAgY29uc3Qgb3duUHJvcGVydHlOYW1lcyA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eU5hbWVzKGhlYWRlcnMpLFxuICAgICAgICBsb3dlcmNhc2VOYW1lID0gbmFtZS50b0xvd2VyQ2FzZSgpLFxuICAgICAgICBsb3dlckNhc2VPd25Qcm9wZXJ0eU5hbWVzID0gb3duUHJvcGVydHlOYW1lcy5tYXAoKG93blByb3BlcnR5TmFtZSkgPT4ge1xuICAgICAgICAgIGNvbnN0IGxvd2VyQ2FzZU93blByb3BlcnR5TmFtZSA9IG93blByb3BlcnR5TmFtZS50b0xvd2VyQ2FzZSgpO1xuXG4gICAgICAgICAgcmV0dXJuIGxvd2VyQ2FzZU93blByb3BlcnR5TmFtZTtcbiAgICAgICAgfSksXG4gICAgICAgIGxvd2VyQ2FzZU93blByb3BlcnR5TmFtZXNJbmNsdWRlc0xvd2VyY2FzZU5hbWUgPSBsb3dlckNhc2VPd25Qcm9wZXJ0eU5hbWVzLmluY2x1ZGVzKGxvd2VyY2FzZU5hbWUpO1xuXG4gIGlmICghbG93ZXJDYXNlT3duUHJvcGVydHlOYW1lc0luY2x1ZGVzTG93ZXJjYXNlTmFtZSkge1xuICAgIGhlYWRlcnNbbmFtZV0gPSB2YWx1ZTtcbiAgfVxufVxuXG5mdW5jdGlvbiB1bmRlcndyaXRlQWNjZXB0KGhlYWRlcnMpIHtcbiAgY29uc3QgbmFtZSA9IEFDQ0VQVCwgIC8vL1xuICAgICAgICB2YWx1ZSA9IEFQUExJQ0FUSU9OX0pTT047IC8vL1xuXG4gIHVuZGVyd3JpdGUoaGVhZGVycywgbmFtZSwgdmFsdWUpO1xufVxuXG5mdW5jdGlvbiB1bmRlcndyaXRlQ29udGVudFR5cGUoaGVhZGVycykge1xuICBjb25zdCBuYW1lID0gQ09OVEVOVF9UWVBFLCAgLy8vXG4gICAgICAgIHZhbHVlID0gQVBQTElDQVRJT05fSlNPTjsgLy8vXG5cbiAgdW5kZXJ3cml0ZShoZWFkZXJzLCBuYW1lLCB2YWx1ZSk7XG59XG5cbmZ1bmN0aW9uIHF1ZXJ5U3RyaW5nRnJvbVBhcmFtZXRlcnMocGFyYW1ldGVycykge1xuICBjb25zdCBuYW1lcyA9IE9iamVjdC5rZXlzKHBhcmFtZXRlcnMpLFxuICAgICAgICBuYW1lc0xlbmd0aCA9IG5hbWVzLmxlbmd0aCxcbiAgICAgICAgbGFzdEluZGV4ID0gbmFtZXNMZW5ndGggLSAxLFxuICAgICAgICBxdWVyeVN0cmluZyA9IG5hbWVzLnJlZHVjZSgocXVlcnlTdHJpbmcsIG5hbWUsIGluZGV4KSA9PiB7XG4gICAgICAgICAgY29uc3QgdmFsdWUgPSBwYXJhbWV0ZXJzW25hbWVdLFxuICAgICAgICAgICAgICAgIGVuY29kZWROYW1lID0gZW5jb2RlVVJJQ29tcG9uZW50KG5hbWUpLFxuICAgICAgICAgICAgICAgIGVuY29kZWRWYWx1ZSA9IGVuY29kZVVSSUNvbXBvbmVudCh2YWx1ZSksXG4gICAgICAgICAgICAgICAgYW1wZXJzYW5kT3JOb3RoaW5nID0gKGluZGV4ICE9PSBsYXN0SW5kZXgpID8gXCImXCIgOiBcIlwiO1xuICBcbiAgICAgICAgICBxdWVyeVN0cmluZyArPSBgJHtlbmNvZGVkTmFtZX09JHtlbmNvZGVkVmFsdWV9JHthbXBlcnNhbmRPck5vdGhpbmd9YDtcbiAgXG4gICAgICAgICAgcmV0dXJuIHF1ZXJ5U3RyaW5nO1xuICAgICAgICB9LCBcIlwiKTtcblxuICByZXR1cm4gcXVlcnlTdHJpbmc7XG59XG5cbmZ1bmN0aW9uIHVybEZyb21Ib3N0VVJJQW5kUGFyYW1ldGVycyhob3N0LCB1cmksIHBhcmFtZXRlcnMpIHtcbiAgY29uc3QgcXVlcnlTdHJpbmcgPSBxdWVyeVN0cmluZ0Zyb21QYXJhbWV0ZXJzKHBhcmFtZXRlcnMpLFxuICAgICAgICB1cmwgPSAocXVlcnlTdHJpbmcgPT09IFwiXCIpID9cbiAgICAgICAgICAgICAgYCR7aG9zdH0ke3VyaX1gIDpcbiAgICAgICAgICAgICAgICBgJHtob3N0fSR7dXJpfT8ke3F1ZXJ5U3RyaW5nfWA7XG5cbiAgcmV0dXJuIHVybDtcbn1cbiJdfQ==