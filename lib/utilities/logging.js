"use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
exports.log = log;
exports.default = void 0;
var _path = _interopRequireDefault(require("path"));
var _array = require("../utilities/array");
var _path1 = require("../utilities/path");
var _fileSystem = require("../utilities/fileSystem");
var _constants = require("../constants");
function _instanceof(left, right) {
    if (right != null && typeof Symbol !== "undefined" && right[Symbol.hasInstance]) {
        return right[Symbol.hasInstance](left);
    } else {
        return left instanceof right;
    }
}
function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : {
        default: obj
    };
}
var levels = [
    _constants.TRACE,
    _constants.DEBUG,
    _constants.INFO,
    _constants.WARNING,
    _constants.ERROR,
    _constants.FATAL, 
];
var logLevel = _constants.DEFAULT_LOG_LEVEL, logFileBaseName = _constants.DEFAULT_LOG_FILE_BASE_NAME, logDirectoryPath = _constants.DEFAULT_LOG_DIRECTORY_PATH;
function log(messageOrError, param) {
    var level = param === void 0 ? "" : param;
    var salientStackMessageIndex = 1;
    if (level !== "") {
        var levelIndex = levels.indexOf(level), logLevelIndex = levels.indexOf(logLevel);
        if (levelIndex < logLevelIndex) {
            return;
        }
        salientStackMessageIndex += 1;
        level = "".concat(level, " "); ///
    }
    var error, message;
    if (_instanceof(messageOrError, Error)) {
        error = messageOrError; ///
        var ref;
        ref = error, message = ref.message, ref;
    } else {
        message = messageOrError; ///
        error = new Error(message);
    }
    var stack = error.stack, stackMessages = stackMessagesFromStack(stack), pertinentStackMessage = stackMessages[salientStackMessageIndex], stackMessage = pertinentStackMessage, currentDateAndTimeString = getCurrentDateAndTimeString(), filePath = filePathFromStackMessage(stackMessage), lineNumber = lineNumberFromStackMessage(stackMessage), logMessage = "".concat(level).concat(currentDateAndTimeString, " ").concat(filePath, "(").concat(lineNumber, ") ").concat(message);
    console.log(logMessage);
    if (logDirectoryPath !== null) {
        rollOverLogFile();
        var logFilePath = getLogFilePath(), logFileContent = "".concat(logMessage, "\n");
        _fileSystem.appendToFile(logFilePath, logFileContent);
    }
    return logMessage;
}
var _default = {
    log: log
};
exports.default = _default;
function trace(message) {
    return log(message, _constants.TRACE);
}
function debug(message) {
    return log(message, _constants.DEBUG);
}
function info(message) {
    return log(message, _constants.INFO);
}
function warning(message) {
    return log(message, _constants.WARNING);
}
function error(message) {
    return log(message, _constants.ERROR);
}
function fatal(message) {
    return log(message, _constants.FATAL);
}
function setLogLevel(level) {
    logLevel = level;
}
function setLogFileBaseName(fileBaseName) {
    logFileBaseName = fileBaseName;
}
function setLogDirectoryPath(directoryPath) {
    logDirectoryPath = directoryPath;
}
function setLogOptions(logOptions) {
    var level = logOptions.level, fileBaseName = logOptions.fileBaseName, directoryPath = logOptions.directoryPath;
    setLogLevel(level);
    setLogFileBaseName(fileBaseName);
    setLogDirectoryPath(directoryPath);
}
function getLogFileContent() {
    var logFilePath = getLogFilePath(), logFileContent = _fileSystem.readFile(logFilePath);
    return logFileContent;
}
Object.assign(log, {
    TRACE: _constants.TRACE,
    DEBUG: _constants.DEBUG,
    INFO: _constants.INFO,
    WARNING: _constants.WARNING,
    ERROR: _constants.ERROR,
    FATAL: _constants.FATAL,
    trace: trace,
    debug: debug,
    info: info,
    warning: warning,
    error: error,
    fatal: fatal,
    setLogLevel: setLogLevel,
    setLogFileBaseName: setLogFileBaseName,
    setLogDirectoryPath: setLogDirectoryPath,
    setLogOptions: setLogOptions,
    getLogFileContent: getLogFileContent
});
function getLogFilePath() {
    var logFileName = "".concat(logFileBaseName, ".log"), logFilePath = _path1.concatenatePaths(logDirectoryPath, logFileName);
    return logFilePath;
}
function getRolledOverLogFilePath() {
    var currentDateString = getCurrentDateString(), rolledOverLogFileName = "".concat(logFileBaseName, ".").concat(currentDateString, ".log"), rolledOverLogFilePath = _path1.concatenatePaths(logDirectoryPath, rolledOverLogFileName);
    return rolledOverLogFilePath;
}
function getLogFileLastModifiedDate() {
    var logFilePath = getLogFilePath(), logFileStats = _fileSystem.getStats(logFilePath), mtime = logFileStats.mtime, logFileLastModifiedDate = new Date(mtime); ///
    return logFileLastModifiedDate;
}
function rollOverLogFile() {
    var logFilePath = getLogFilePath(), logFileExists = _fileSystem.checkFileExists(logFilePath);
    if (!logFileExists) {
        return;
    }
    var logFileLastModifiedDate = getLogFileLastModifiedDate(), logFileLastModifiedDateCurrentDate = isDateCurrentDate(logFileLastModifiedDate);
    if (!logFileLastModifiedDateCurrentDate) {
        var rolledOverLogFilePath = getRolledOverLogFilePath();
        _fileSystem.renameFile(logFilePath, rolledOverLogFilePath);
    }
}
function isDateCurrentDate(date) {
    var currentDate = new Date(), dateString = date.toDateString(), currentDateString = currentDate.toDateString(), dateCurrentDate = dateString === currentDateString;
    return dateCurrentDate;
}
function getCurrentDateString() {
    var date = new Date(), day = padStartWithZeroes(date.getDate(), 2), month = padStartWithZeroes(date.getMonth() + 1, 2), year = date.getFullYear(), currentDateAndTimeString = "".concat(day, "-").concat(month, "-").concat(year);
    return currentDateAndTimeString;
}
function getCurrentDateAndTimeString() {
    var date = new Date(), day = padStartWithZeroes(date.getDate(), 2), month = padStartWithZeroes(date.getMonth() + 1, 2), year = date.getFullYear(), hours = padStartWithZeroes(date.getHours(), 2), minutes = padStartWithZeroes(date.getMinutes(), 2), seconds = padStartWithZeroes(date.getSeconds(), 2), milliseconds = padStartWithZeroes(date.getMilliseconds(), 3), currentDateAndTimeString = "".concat(day, "-").concat(month, "-").concat(year, " ").concat(hours, ":").concat(minutes, ":").concat(seconds, ".").concat(milliseconds);
    return currentDateAndTimeString;
}
function stackMessagesFromStack(stack) {
    var stackMessages = [], stackLines = stack.split(/\r\n|\n/);
    var stackMessage = "";
    stackLines.forEach(function(stackLine) {
        var matches = /^\s*at.*/.test(stackLine);
        stackMessage = stackMessage === "" ? stackLine : "".concat(stackMessage, "\n").concat(stackLine);
        if (matches) {
            stackMessages.push(stackMessage);
            stackMessage = "";
        }
    });
    return stackMessages;
}
function filePathFromStackMessage(stackMessage) {
    var matches = stackMessage.match(/(\/.+):\d+:\d+/m), secondMatch = _array.second(matches), absoluteFilePath = secondMatch, currentWorkingDirectoryPath = _path.default.resolve("."), currentWorkingDirectoryPathLength = currentWorkingDirectoryPath.length, start = currentWorkingDirectoryPathLength + 1, filePath = absoluteFilePath.substr(start);
    return filePath;
}
function lineNumberFromStackMessage(stackMessage) {
    var matches = stackMessage.match(/:(\d+)/m), secondMatch = _array.second(matches), lineNumber = secondMatch; ///
    return lineNumber;
}
function padStartWithZeroes(string, targetLength) {
    var padString = "0", paddedString = padStart(string, targetLength, padString);
    return paddedString;
}
function padStart(string, targetLength, padString) {
    var padding = "";
    for(var index = 0; index < targetLength; index++){
        padding += padString;
    }
    var paddedString = "".concat(padding).concat(string).substr(-targetLength);
    return paddedString;
}

//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL2VzNi91dGlsaXRpZXMvbG9nZ2luZy5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcblxuaW1wb3J0IHBhdGggZnJvbSBcInBhdGhcIjtcblxuaW1wb3J0IHsgc2Vjb25kIH0gZnJvbSBcIi4uL3V0aWxpdGllcy9hcnJheVwiO1xuaW1wb3J0IHsgY29uY2F0ZW5hdGVQYXRocyB9IGZyb20gXCIuLi91dGlsaXRpZXMvcGF0aFwiO1xuaW1wb3J0IHsgY2hlY2tGaWxlRXhpc3RzLCByZWFkRmlsZSwgYXBwZW5kVG9GaWxlLCByZW5hbWVGaWxlLCBnZXRTdGF0cyB9IGZyb20gXCIuLi91dGlsaXRpZXMvZmlsZVN5c3RlbVwiO1xuaW1wb3J0IHsgVFJBQ0UsIERFQlVHLCBJTkZPLCBXQVJOSU5HLCBFUlJPUiwgRkFUQUwsIERFRkFVTFRfTE9HX0xFVkVMLCBERUZBVUxUX0xPR19GSUxFX0JBU0VfTkFNRSwgREVGQVVMVF9MT0dfRElSRUNUT1JZX1BBVEggfSBmcm9tIFwiLi4vY29uc3RhbnRzXCI7XG5cbmNvbnN0IGxldmVscyA9IFtcbiAgVFJBQ0UsXG4gIERFQlVHLFxuICBJTkZPLFxuICBXQVJOSU5HLFxuICBFUlJPUixcbiAgRkFUQUwsXG5dO1xuXG5sZXQgbG9nTGV2ZWwgPSBERUZBVUxUX0xPR19MRVZFTCxcbiAgICBsb2dGaWxlQmFzZU5hbWUgPSBERUZBVUxUX0xPR19GSUxFX0JBU0VfTkFNRSxcbiAgICBsb2dEaXJlY3RvcnlQYXRoID0gREVGQVVMVF9MT0dfRElSRUNUT1JZX1BBVEg7XG5cbmV4cG9ydCBmdW5jdGlvbiBsb2cobWVzc2FnZU9yRXJyb3IsIGxldmVsID0gXCJcIikge1xuICBsZXQgc2FsaWVudFN0YWNrTWVzc2FnZUluZGV4ID0gMTtcblxuICBpZiAobGV2ZWwgIT09IFwiXCIpIHtcbiAgICBjb25zdCBsZXZlbEluZGV4ID0gbGV2ZWxzLmluZGV4T2YobGV2ZWwpLFxuICAgICAgICAgIGxvZ0xldmVsSW5kZXggPSBsZXZlbHMuaW5kZXhPZihsb2dMZXZlbCk7XG5cbiAgICBpZiAobGV2ZWxJbmRleCA8IGxvZ0xldmVsSW5kZXgpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBzYWxpZW50U3RhY2tNZXNzYWdlSW5kZXggKz0gMTtcblxuICAgIGxldmVsID0gYCR7bGV2ZWx9IGA7ICAvLy9cbiAgfVxuXG4gIGxldCBlcnJvcixcbiAgICAgIG1lc3NhZ2U7XG5cbiAgaWYgKG1lc3NhZ2VPckVycm9yIGluc3RhbmNlb2YgRXJyb3IpIHtcbiAgICBlcnJvciA9IG1lc3NhZ2VPckVycm9yOyAvLy9cblxuICAgICh7IG1lc3NhZ2UgfSA9IGVycm9yKTtcbiAgfSBlbHNlIHtcbiAgICBtZXNzYWdlID0gbWVzc2FnZU9yRXJyb3I7IC8vL1xuXG4gICAgZXJyb3IgPSBuZXcgRXJyb3IobWVzc2FnZSk7XG4gIH1cblxuICBjb25zdCB7IHN0YWNrIH0gPSBlcnJvcixcbiAgICAgICAgc3RhY2tNZXNzYWdlcyA9IHN0YWNrTWVzc2FnZXNGcm9tU3RhY2soc3RhY2spLFxuICAgICAgICBwZXJ0aW5lbnRTdGFja01lc3NhZ2UgPSBzdGFja01lc3NhZ2VzW3NhbGllbnRTdGFja01lc3NhZ2VJbmRleF0sXG4gICAgICAgIHN0YWNrTWVzc2FnZSA9IHBlcnRpbmVudFN0YWNrTWVzc2FnZSwgLy8vXG4gICAgICAgIGN1cnJlbnREYXRlQW5kVGltZVN0cmluZyA9IGdldEN1cnJlbnREYXRlQW5kVGltZVN0cmluZygpLFxuICAgICAgICBmaWxlUGF0aCA9IGZpbGVQYXRoRnJvbVN0YWNrTWVzc2FnZShzdGFja01lc3NhZ2UpLFxuICAgICAgICBsaW5lTnVtYmVyID0gbGluZU51bWJlckZyb21TdGFja01lc3NhZ2Uoc3RhY2tNZXNzYWdlKSxcbiAgICAgICAgbG9nTWVzc2FnZSA9IGAke2xldmVsfSR7Y3VycmVudERhdGVBbmRUaW1lU3RyaW5nfSAke2ZpbGVQYXRofSgke2xpbmVOdW1iZXJ9KSAke21lc3NhZ2V9YDtcblxuICBjb25zb2xlLmxvZyhsb2dNZXNzYWdlKTtcblxuICBpZiAobG9nRGlyZWN0b3J5UGF0aCAhPT0gbnVsbCkge1xuICAgIHJvbGxPdmVyTG9nRmlsZSgpO1xuXG4gICAgY29uc3QgbG9nRmlsZVBhdGggPSBnZXRMb2dGaWxlUGF0aCgpLFxuICAgICAgICAgIGxvZ0ZpbGVDb250ZW50ID0gYCR7bG9nTWVzc2FnZX1cXG5gO1xuXG4gICAgYXBwZW5kVG9GaWxlKGxvZ0ZpbGVQYXRoLCBsb2dGaWxlQ29udGVudCk7XG4gIH1cblxuICByZXR1cm4gbG9nTWVzc2FnZTtcbn1cblxuZXhwb3J0IGRlZmF1bHQge1xuICBsb2dcbn1cblxuZnVuY3Rpb24gdHJhY2UobWVzc2FnZSkgeyByZXR1cm4gbG9nKG1lc3NhZ2UsIFRSQUNFKTsgfVxuXG5mdW5jdGlvbiBkZWJ1ZyhtZXNzYWdlKSB7IHJldHVybiBsb2cobWVzc2FnZSwgREVCVUcpOyB9XG5cbmZ1bmN0aW9uIGluZm8obWVzc2FnZSkgeyByZXR1cm4gbG9nKG1lc3NhZ2UsIElORk8pOyB9XG5cbmZ1bmN0aW9uIHdhcm5pbmcobWVzc2FnZSkgeyByZXR1cm4gbG9nKG1lc3NhZ2UsIFdBUk5JTkcpOyB9XG5cbmZ1bmN0aW9uIGVycm9yKG1lc3NhZ2UpIHsgcmV0dXJuIGxvZyhtZXNzYWdlLCBFUlJPUik7IH1cblxuZnVuY3Rpb24gZmF0YWwobWVzc2FnZSkgeyByZXR1cm4gbG9nKG1lc3NhZ2UsIEZBVEFMKTsgfVxuXG5mdW5jdGlvbiBzZXRMb2dMZXZlbChsZXZlbCkgeyBsb2dMZXZlbCA9IGxldmVsOyB9XG5cbmZ1bmN0aW9uIHNldExvZ0ZpbGVCYXNlTmFtZShmaWxlQmFzZU5hbWUpIHsgbG9nRmlsZUJhc2VOYW1lID0gZmlsZUJhc2VOYW1lOyB9XG5cbmZ1bmN0aW9uIHNldExvZ0RpcmVjdG9yeVBhdGgoZGlyZWN0b3J5UGF0aCkgeyBsb2dEaXJlY3RvcnlQYXRoID0gZGlyZWN0b3J5UGF0aDsgfVxuXG5mdW5jdGlvbiBzZXRMb2dPcHRpb25zKGxvZ09wdGlvbnMpIHtcbiAgY29uc3QgeyBsZXZlbCwgZmlsZUJhc2VOYW1lLCBkaXJlY3RvcnlQYXRoIH0gPSBsb2dPcHRpb25zO1xuXG4gIHNldExvZ0xldmVsKGxldmVsKTtcblxuICBzZXRMb2dGaWxlQmFzZU5hbWUoZmlsZUJhc2VOYW1lKTtcblxuICBzZXRMb2dEaXJlY3RvcnlQYXRoKGRpcmVjdG9yeVBhdGgpO1xufVxuXG5mdW5jdGlvbiBnZXRMb2dGaWxlQ29udGVudCgpIHtcbiAgY29uc3QgbG9nRmlsZVBhdGggPSBnZXRMb2dGaWxlUGF0aCgpLFxuICAgICAgICBsb2dGaWxlQ29udGVudCA9IHJlYWRGaWxlKGxvZ0ZpbGVQYXRoKTtcblxuICByZXR1cm4gbG9nRmlsZUNvbnRlbnQ7XG59XG5cbk9iamVjdC5hc3NpZ24obG9nLCB7XG4gIFRSQUNFLFxuICBERUJVRyxcbiAgSU5GTyxcbiAgV0FSTklORyxcbiAgRVJST1IsXG4gIEZBVEFMLFxuICB0cmFjZSxcbiAgZGVidWcsXG4gIGluZm8sXG4gIHdhcm5pbmcsXG4gIGVycm9yLFxuICBmYXRhbCxcbiAgc2V0TG9nTGV2ZWwsXG4gIHNldExvZ0ZpbGVCYXNlTmFtZSxcbiAgc2V0TG9nRGlyZWN0b3J5UGF0aCxcbiAgc2V0TG9nT3B0aW9ucyxcbiAgZ2V0TG9nRmlsZUNvbnRlbnRcbn0pO1xuXG5mdW5jdGlvbiBnZXRMb2dGaWxlUGF0aCgpIHtcbiAgY29uc3QgbG9nRmlsZU5hbWUgPSBgJHtsb2dGaWxlQmFzZU5hbWV9LmxvZ2AsXG4gICAgICAgIGxvZ0ZpbGVQYXRoID0gY29uY2F0ZW5hdGVQYXRocyhsb2dEaXJlY3RvcnlQYXRoLCBsb2dGaWxlTmFtZSk7XG5cbiAgcmV0dXJuIGxvZ0ZpbGVQYXRoO1xufVxuXG5mdW5jdGlvbiBnZXRSb2xsZWRPdmVyTG9nRmlsZVBhdGgoKSB7XG4gIGNvbnN0IGN1cnJlbnREYXRlU3RyaW5nID0gZ2V0Q3VycmVudERhdGVTdHJpbmcoKSxcbiAgICAgICAgcm9sbGVkT3ZlckxvZ0ZpbGVOYW1lID0gYCR7bG9nRmlsZUJhc2VOYW1lfS4ke2N1cnJlbnREYXRlU3RyaW5nfS5sb2dgLFxuICAgICAgICByb2xsZWRPdmVyTG9nRmlsZVBhdGggPSBjb25jYXRlbmF0ZVBhdGhzKGxvZ0RpcmVjdG9yeVBhdGgsIHJvbGxlZE92ZXJMb2dGaWxlTmFtZSk7XG5cbiAgcmV0dXJuIHJvbGxlZE92ZXJMb2dGaWxlUGF0aDtcbn1cblxuZnVuY3Rpb24gZ2V0TG9nRmlsZUxhc3RNb2RpZmllZERhdGUoKSB7XG4gIGNvbnN0IGxvZ0ZpbGVQYXRoID0gZ2V0TG9nRmlsZVBhdGgoKSxcbiAgICAgICAgbG9nRmlsZVN0YXRzID0gZ2V0U3RhdHMobG9nRmlsZVBhdGgpLFxuICAgICAgICB7IG10aW1lIH0gPSBsb2dGaWxlU3RhdHMsXG4gICAgICAgIGxvZ0ZpbGVMYXN0TW9kaWZpZWREYXRlID0gbmV3IERhdGUobXRpbWUpOyAgLy8vXG5cbiAgcmV0dXJuIGxvZ0ZpbGVMYXN0TW9kaWZpZWREYXRlO1xufVxuXG5mdW5jdGlvbiByb2xsT3ZlckxvZ0ZpbGUoKSB7XG4gIGNvbnN0IGxvZ0ZpbGVQYXRoID0gZ2V0TG9nRmlsZVBhdGgoKSxcbiAgICAgICAgbG9nRmlsZUV4aXN0cyA9IGNoZWNrRmlsZUV4aXN0cyhsb2dGaWxlUGF0aCk7XG5cbiAgaWYgKCFsb2dGaWxlRXhpc3RzKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgY29uc3QgbG9nRmlsZUxhc3RNb2RpZmllZERhdGUgPSBnZXRMb2dGaWxlTGFzdE1vZGlmaWVkRGF0ZSgpLFxuICAgICAgICBsb2dGaWxlTGFzdE1vZGlmaWVkRGF0ZUN1cnJlbnREYXRlID0gaXNEYXRlQ3VycmVudERhdGUobG9nRmlsZUxhc3RNb2RpZmllZERhdGUpO1xuXG4gIGlmICghbG9nRmlsZUxhc3RNb2RpZmllZERhdGVDdXJyZW50RGF0ZSkge1xuICAgIGNvbnN0IHJvbGxlZE92ZXJMb2dGaWxlUGF0aCA9IGdldFJvbGxlZE92ZXJMb2dGaWxlUGF0aCgpO1xuXG4gICAgcmVuYW1lRmlsZShsb2dGaWxlUGF0aCwgcm9sbGVkT3ZlckxvZ0ZpbGVQYXRoKTtcbiAgfVxufVxuXG5mdW5jdGlvbiBpc0RhdGVDdXJyZW50RGF0ZShkYXRlKSB7XG4gIGNvbnN0IGN1cnJlbnREYXRlID0gbmV3IERhdGUoKSxcbiAgICAgICAgZGF0ZVN0cmluZyA9IGRhdGUudG9EYXRlU3RyaW5nKCksXG4gICAgICAgIGN1cnJlbnREYXRlU3RyaW5nID0gY3VycmVudERhdGUudG9EYXRlU3RyaW5nKCksXG4gICAgICAgIGRhdGVDdXJyZW50RGF0ZSA9IChkYXRlU3RyaW5nID09PSBjdXJyZW50RGF0ZVN0cmluZyk7XG5cbiAgcmV0dXJuIGRhdGVDdXJyZW50RGF0ZTtcbn1cblxuZnVuY3Rpb24gZ2V0Q3VycmVudERhdGVTdHJpbmcoKSB7XG4gIGNvbnN0IGRhdGUgPSBuZXcgRGF0ZSgpLFxuICAgICAgICBkYXkgPSBwYWRTdGFydFdpdGhaZXJvZXMoZGF0ZS5nZXREYXRlKCksIDIpLCAgLy8vXG4gICAgICAgIG1vbnRoID0gcGFkU3RhcnRXaXRoWmVyb2VzKGRhdGUuZ2V0TW9udGgoKSArIDEsIDIpLCAvLy9cbiAgICAgICAgeWVhciA9IGRhdGUuZ2V0RnVsbFllYXIoKSxcbiAgICAgICAgY3VycmVudERhdGVBbmRUaW1lU3RyaW5nID0gYCR7ZGF5fS0ke21vbnRofS0ke3llYXJ9YDtcblxuICByZXR1cm4gY3VycmVudERhdGVBbmRUaW1lU3RyaW5nO1xufVxuXG5mdW5jdGlvbiBnZXRDdXJyZW50RGF0ZUFuZFRpbWVTdHJpbmcoKSB7XG4gIGNvbnN0IGRhdGUgPSBuZXcgRGF0ZSgpLFxuICAgICAgICBkYXkgPSBwYWRTdGFydFdpdGhaZXJvZXMoZGF0ZS5nZXREYXRlKCksIDIpLCAgLy8vXG4gICAgICAgIG1vbnRoID0gcGFkU3RhcnRXaXRoWmVyb2VzKGRhdGUuZ2V0TW9udGgoKSArIDEsIDIpLCAvLy9cbiAgICAgICAgeWVhciA9IGRhdGUuZ2V0RnVsbFllYXIoKSxcbiAgICAgICAgaG91cnMgPSBwYWRTdGFydFdpdGhaZXJvZXMoZGF0ZS5nZXRIb3VycygpLCAyKSxcbiAgICAgICAgbWludXRlcyA9IHBhZFN0YXJ0V2l0aFplcm9lcyhkYXRlLmdldE1pbnV0ZXMoKSwgMiksXG4gICAgICAgIHNlY29uZHMgPSBwYWRTdGFydFdpdGhaZXJvZXMoZGF0ZS5nZXRTZWNvbmRzKCksIDIpLFxuICAgICAgICBtaWxsaXNlY29uZHMgPSBwYWRTdGFydFdpdGhaZXJvZXMoZGF0ZS5nZXRNaWxsaXNlY29uZHMoKSwgMyksXG4gICAgICAgIGN1cnJlbnREYXRlQW5kVGltZVN0cmluZyA9IGAke2RheX0tJHttb250aH0tJHt5ZWFyfSAke2hvdXJzfToke21pbnV0ZXN9OiR7c2Vjb25kc30uJHttaWxsaXNlY29uZHN9YDtcblxuICByZXR1cm4gY3VycmVudERhdGVBbmRUaW1lU3RyaW5nO1xufVxuXG5mdW5jdGlvbiBzdGFja01lc3NhZ2VzRnJvbVN0YWNrKHN0YWNrKSB7XG4gIGNvbnN0IHN0YWNrTWVzc2FnZXMgPSBbXSxcbiAgICAgICAgc3RhY2tMaW5lcyA9IHN0YWNrLnNwbGl0KC9cXHJcXG58XFxuLyk7XG5cbiAgbGV0IHN0YWNrTWVzc2FnZSA9IFwiXCI7XG5cbiAgc3RhY2tMaW5lcy5mb3JFYWNoKChzdGFja0xpbmUpID0+IHtcbiAgICBjb25zdCBtYXRjaGVzID0gL15cXHMqYXQuKi8udGVzdChzdGFja0xpbmUpO1xuXG4gICAgc3RhY2tNZXNzYWdlID0gKHN0YWNrTWVzc2FnZSA9PT0gXCJcIikgP1xuICAgICAgICAgICAgICAgICAgICAgIHN0YWNrTGluZSA6XG4gICAgICAgICAgICAgICAgICAgICAgICBgJHtzdGFja01lc3NhZ2V9XFxuJHtzdGFja0xpbmV9YDtcblxuICAgIGlmIChtYXRjaGVzKSB7XG4gICAgICBzdGFja01lc3NhZ2VzLnB1c2goc3RhY2tNZXNzYWdlKTtcblxuICAgICAgc3RhY2tNZXNzYWdlID0gXCJcIjtcbiAgICB9XG4gIH0pO1xuXG4gIHJldHVybiBzdGFja01lc3NhZ2VzO1xufVxuXG5mdW5jdGlvbiBmaWxlUGF0aEZyb21TdGFja01lc3NhZ2Uoc3RhY2tNZXNzYWdlKSB7XG4gIGNvbnN0IG1hdGNoZXMgPSBzdGFja01lc3NhZ2UubWF0Y2goLyhcXC8uKyk6XFxkKzpcXGQrL20pLFxuICAgICAgICBzZWNvbmRNYXRjaCA9IHNlY29uZChtYXRjaGVzKSxcbiAgICAgICAgYWJzb2x1dGVGaWxlUGF0aCA9IHNlY29uZE1hdGNoLCAgLy8vXG4gICAgICAgIGN1cnJlbnRXb3JraW5nRGlyZWN0b3J5UGF0aCA9IHBhdGgucmVzb2x2ZShcIi5cIiksICAvLy9cbiAgICAgICAgY3VycmVudFdvcmtpbmdEaXJlY3RvcnlQYXRoTGVuZ3RoID0gY3VycmVudFdvcmtpbmdEaXJlY3RvcnlQYXRoLmxlbmd0aCxcbiAgICAgICAgc3RhcnQgPSBjdXJyZW50V29ya2luZ0RpcmVjdG9yeVBhdGhMZW5ndGggKyAxLCAgLy8vXG4gICAgICAgIGZpbGVQYXRoID0gYWJzb2x1dGVGaWxlUGF0aC5zdWJzdHIoc3RhcnQpO1xuXG4gIHJldHVybiBmaWxlUGF0aDtcbn1cblxuZnVuY3Rpb24gbGluZU51bWJlckZyb21TdGFja01lc3NhZ2Uoc3RhY2tNZXNzYWdlKSB7XG4gIGNvbnN0IG1hdGNoZXMgPSBzdGFja01lc3NhZ2UubWF0Y2goLzooXFxkKykvbSksXG4gICAgICAgIHNlY29uZE1hdGNoID0gc2Vjb25kKG1hdGNoZXMpLFxuICAgICAgICBsaW5lTnVtYmVyID0gc2Vjb25kTWF0Y2g7IC8vL1xuXG4gIHJldHVybiBsaW5lTnVtYmVyO1xufVxuXG5mdW5jdGlvbiBwYWRTdGFydFdpdGhaZXJvZXMoc3RyaW5nLCB0YXJnZXRMZW5ndGgpIHtcbiAgY29uc3QgcGFkU3RyaW5nID0gXCIwXCIsXG4gICAgICAgIHBhZGRlZFN0cmluZyA9IHBhZFN0YXJ0KHN0cmluZywgdGFyZ2V0TGVuZ3RoLCBwYWRTdHJpbmcpO1xuXG4gIHJldHVybiBwYWRkZWRTdHJpbmc7XG59XG5cbmZ1bmN0aW9uIHBhZFN0YXJ0KHN0cmluZywgdGFyZ2V0TGVuZ3RoLCBwYWRTdHJpbmcpIHtcbiAgbGV0IHBhZGRpbmcgPSBcIlwiO1xuXG4gIGZvciAobGV0IGluZGV4ID0gMDsgaW5kZXggPCB0YXJnZXRMZW5ndGg7IGluZGV4KyspIHtcbiAgICBwYWRkaW5nICs9IHBhZFN0cmluZztcbiAgfVxuXG4gIGNvbnN0IHBhZGRlZFN0cmluZyA9IGAke3BhZGRpbmd9JHtzdHJpbmd9YC5zdWJzdHIoLXRhcmdldExlbmd0aCk7XG5cbiAgcmV0dXJuIHBhZGRlZFN0cmluZztcbn1cbiJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQ0FBQSxVQUFBOzs7O1FBc0JBLEdBQUEsR0FBQSxHQUFBOztJQXBCQSxLQUFBO0lBRUEsTUFBQTtJQUNBLE1BQUE7SUFDQSxXQUFBO0lBQ0EsVUFBQTs7Ozs7Ozs7Ozs7OztJQUVBLE1BQUE7QUFGQSxjQUFBO0FBQUEsY0FBQTtBQUFBLGNBQUE7QUFBQSxjQUFBO0FBQUEsY0FBQTtBQUFBLGNBQUE7O0lBV0EsUUFBQSxHQVhBLFVBQUEsb0JBWUEsZUFBQSxHQVpBLFVBQUEsNkJBYUEsZ0JBQUEsR0FiQSxVQUFBO1NBZUEsR0FBQSxDQUFBLGNBQUEsRUFBQSxLQUFBO1FBQUEsS0FBQSxHQUFBLEtBQUEsbUJBQUEsS0FBQTtRQUNBLHdCQUFBLEdBQUEsQ0FBQTtRQUVBLEtBQUE7WUFDQSxVQUFBLEdBQUEsTUFBQSxDQUFBLE9BQUEsQ0FBQSxLQUFBLEdBQ0EsYUFBQSxHQUFBLE1BQUEsQ0FBQSxPQUFBLENBQUEsUUFBQTtZQUVBLFVBQUEsR0FBQSxhQUFBOzs7QUFJQSxnQ0FBQSxJQUFBLENBQUE7QUFFQSxhQUFBLE1BQUEsTUFBQSxDQUFBLEtBQUEsR0FBQSxDQUFBLEdBQUEsQ0FBQSxFQUFBLENBQUE7O1FBR0EsS0FBQSxFQUNBLE9BQUE7UUFFQSxXQUFBLENBQUEsY0FBQSxFQUFBLEtBQUE7QUFDQSxhQUFBLEdBQUEsY0FBQSxDQUFBLENBQUEsRUFBQSxDQUFBOztjQUVBLEtBQUEsRUFBQSxPQUFBLE9BQUEsT0FBQTs7QUFFQSxl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