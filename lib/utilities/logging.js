"use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
exports.log = log;
exports.default = void 0;
var _path = _interopRequireDefault(require("path"));
var _array = require("../utilities/array");
var _path1 = require("../utilities/path");
var _fileSystem = require("../utilities/fileSystem");
var _constants = require("../constants");
function _instanceof(left, right) {
    if (right != null && typeof Symbol !== "undefined" && right[Symbol.hasInstance]) {
        return right[Symbol.hasInstance](left);
    } else {
        return left instanceof right;
    }
}
function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : {
        default: obj
    };
}
"use strict";
var levels = [
    _constants.TRACE,
    _constants.DEBUG,
    _constants.INFO,
    _constants.WARNING,
    _constants.ERROR,
    _constants.FATAL, 
];
var logLevel = _constants.DEFAULT_LOG_LEVEL, logFileBaseName = _constants.DEFAULT_LOG_FILE_BASE_NAME, logDirectoryPath = _constants.DEFAULT_LOG_DIRECTORY_PATH;
function log(messageOrError, param) {
    var level = param === void 0 ? "" : param;
    var salientStackMessageIndex = 1;
    if (level !== "") {
        var levelIndex = levels.indexOf(level), logLevelIndex = levels.indexOf(logLevel);
        if (levelIndex < logLevelIndex) {
            return;
        }
        salientStackMessageIndex += 1;
        level = "".concat(level, " "); ///
    }
    var error, message;
    if (_instanceof(messageOrError, Error)) {
        error = messageOrError; ///
        var ref;
        ref = error, message = ref.message, ref;
    } else {
        message = messageOrError; ///
        error = new Error(message);
    }
    var stack = error.stack, stackMessages = stackMessagesFromStack(stack), pertinentStackMessage = stackMessages[salientStackMessageIndex], stackMessage = pertinentStackMessage, currentDateAndTimeString = getCurrentDateAndTimeString(), filePath = filePathFromStackMessage(stackMessage), lineNumber = lineNumberFromStackMessage(stackMessage), logMessage = "".concat(level).concat(currentDateAndTimeString, " ").concat(filePath, "(").concat(lineNumber, ") ").concat(message);
    console.log(logMessage);
    if (logDirectoryPath !== null) {
        rollOverLogFile();
        var logFilePath = getLogFilePath(), logFileContent = "".concat(logMessage, "\n");
        _fileSystem.appendToFile(logFilePath, logFileContent);
    }
    return logMessage;
}
var _default = {
    log: log
};
exports.default = _default;
function trace(message) {
    return log(message, _constants.TRACE);
}
function debug(message) {
    return log(message, _constants.DEBUG);
}
function info(message) {
    return log(message, _constants.INFO);
}
function warning(message) {
    return log(message, _constants.WARNING);
}
function error(message) {
    return log(message, _constants.ERROR);
}
function fatal(message) {
    return log(message, _constants.FATAL);
}
function setLogLevel(level) {
    logLevel = level;
}
function setLogFileBaseName(fileBaseName) {
    logFileBaseName = fileBaseName;
}
function setLogDirectoryPath(directoryPath) {
    logDirectoryPath = directoryPath;
}
function setLogOptions(logOptions) {
    var level = logOptions.level, fileBaseName = logOptions.fileBaseName, directoryPath = logOptions.directoryPath;
    setLogLevel(level);
    setLogFileBaseName(fileBaseName);
    setLogDirectoryPath(directoryPath);
}
function getLogFileContent() {
    var logFilePath = getLogFilePath(), logFileContent = _fileSystem.readFile(logFilePath);
    return logFileContent;
}
Object.assign(log, {
    TRACE: _constants.TRACE,
    DEBUG: _constants.DEBUG,
    INFO: _constants.INFO,
    WARNING: _constants.WARNING,
    ERROR: _constants.ERROR,
    FATAL: _constants.FATAL,
    trace: trace,
    debug: debug,
    info: info,
    warning: warning,
    error: error,
    fatal: fatal,
    setLogLevel: setLogLevel,
    setLogFileBaseName: setLogFileBaseName,
    setLogDirectoryPath: setLogDirectoryPath,
    setLogOptions: setLogOptions,
    getLogFileContent: getLogFileContent
});
function getLogFilePath() {
    var logFileName = "".concat(logFileBaseName, ".log"), logFilePath = _path1.concatenatePaths(logDirectoryPath, logFileName);
    return logFilePath;
}
function getRolledOverLogFilePath() {
    var currentDateString = getCurrentDateString(), rolledOverLogFileName = "".concat(logFileBaseName, ".").concat(currentDateString, ".log"), rolledOverLogFilePath = _path1.concatenatePaths(logDirectoryPath, rolledOverLogFileName);
    return rolledOverLogFilePath;
}
function getLogFileLastModifiedDate() {
    var logFilePath = getLogFilePath(), logFileStats = _fileSystem.getStats(logFilePath), mtime = logFileStats.mtime, logFileLastModifiedDate = new Date(mtime); ///
    return logFileLastModifiedDate;
}
function rollOverLogFile() {
    var logFilePath = getLogFilePath(), logFileExists = _fileSystem.checkFileExists(logFilePath);
    if (!logFileExists) {
        return;
    }
    var logFileLastModifiedDate = getLogFileLastModifiedDate(), logFileLastModifiedDateCurrentDate = isDateCurrentDate(logFileLastModifiedDate);
    if (!logFileLastModifiedDateCurrentDate) {
        var rolledOverLogFilePath = getRolledOverLogFilePath();
        _fileSystem.renameFile(logFilePath, rolledOverLogFilePath);
    }
}
function isDateCurrentDate(date) {
    var currentDate = new Date(), dateString = date.toDateString(), currentDateString = currentDate.toDateString(), dateCurrentDate = dateString === currentDateString;
    return dateCurrentDate;
}
function getCurrentDateString() {
    var date = new Date(), day = padStartWithZeroes(date.getDate(), 2), month = padStartWithZeroes(date.getMonth() + 1, 2), year = date.getFullYear(), currentDateAndTimeString = "".concat(day, "-").concat(month, "-").concat(year);
    return currentDateAndTimeString;
}
function getCurrentDateAndTimeString() {
    var date = new Date(), day = padStartWithZeroes(date.getDate(), 2), month = padStartWithZeroes(date.getMonth() + 1, 2), year = date.getFullYear(), hours = padStartWithZeroes(date.getHours(), 2), minutes = padStartWithZeroes(date.getMinutes(), 2), seconds = padStartWithZeroes(date.getSeconds(), 2), milliseconds = padStartWithZeroes(date.getMilliseconds(), 3), currentDateAndTimeString = "".concat(day, "-").concat(month, "-").concat(year, " ").concat(hours, ":").concat(minutes, ":").concat(seconds, ".").concat(milliseconds);
    return currentDateAndTimeString;
}
function stackMessagesFromStack(stack) {
    var stackMessages = [], stackLines = stack.split(/\r\n|\n/);
    var stackMessage = "";
    stackLines.forEach(function(stackLine) {
        var matches = /^\s*at.*/.test(stackLine);
        stackMessage = stackMessage === "" ? stackLine : "".concat(stackMessage, "\n").concat(stackLine);
        if (matches) {
            stackMessages.push(stackMessage);
            stackMessage = "";
        }
    });
    return stackMessages;
}
function filePathFromStackMessage(stackMessage) {
    var matches = stackMessage.match(/(\/.+):\d+:\d+/m), secondMatch = _array.second(matches), absoluteFilePath = secondMatch, currentWorkingDirectoryPath = _path.default.resolve("."), currentWorkingDirectoryPathLength = currentWorkingDirectoryPath.length, start = currentWorkingDirectoryPathLength + 1, filePath = absoluteFilePath.substr(start);
    return filePath;
}
function lineNumberFromStackMessage(stackMessage) {
    var matches = stackMessage.match(/:(\d+)/m), secondMatch = _array.second(matches), lineNumber = secondMatch; ///
    return lineNumber;
}
function padStartWithZeroes(string, targetLength) {
    var padString = "0", paddedString = padStart(string, targetLength, padString);
    return paddedString;
}
function padStart(string, targetLength, padString) {
    var padding = "";
    for(var index = 0; index < targetLength; index++){
        padding += padString;
    }
    var paddedString = "".concat(padding).concat(string).substr(-targetLength);
    return paddedString;
}

//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL2VzNi91dGlsaXRpZXMvbG9nZ2luZy5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcblxuaW1wb3J0IHBhdGggZnJvbSBcInBhdGhcIjtcblxuaW1wb3J0IHsgc2Vjb25kIH0gZnJvbSBcIi4uL3V0aWxpdGllcy9hcnJheVwiO1xuaW1wb3J0IHsgY29uY2F0ZW5hdGVQYXRocyB9IGZyb20gXCIuLi91dGlsaXRpZXMvcGF0aFwiO1xuaW1wb3J0IHsgY2hlY2tGaWxlRXhpc3RzLCByZWFkRmlsZSwgYXBwZW5kVG9GaWxlLCByZW5hbWVGaWxlLCBnZXRTdGF0cyB9IGZyb20gXCIuLi91dGlsaXRpZXMvZmlsZVN5c3RlbVwiO1xuaW1wb3J0IHsgVFJBQ0UsIERFQlVHLCBJTkZPLCBXQVJOSU5HLCBFUlJPUiwgRkFUQUwsIERFRkFVTFRfTE9HX0xFVkVMLCBERUZBVUxUX0xPR19GSUxFX0JBU0VfTkFNRSwgREVGQVVMVF9MT0dfRElSRUNUT1JZX1BBVEggfSBmcm9tIFwiLi4vY29uc3RhbnRzXCI7XG5cbmNvbnN0IGxldmVscyA9IFtcbiAgVFJBQ0UsXG4gIERFQlVHLFxuICBJTkZPLFxuICBXQVJOSU5HLFxuICBFUlJPUixcbiAgRkFUQUwsXG5dO1xuXG5sZXQgbG9nTGV2ZWwgPSBERUZBVUxUX0xPR19MRVZFTCxcbiAgICBsb2dGaWxlQmFzZU5hbWUgPSBERUZBVUxUX0xPR19GSUxFX0JBU0VfTkFNRSxcbiAgICBsb2dEaXJlY3RvcnlQYXRoID0gREVGQVVMVF9MT0dfRElSRUNUT1JZX1BBVEg7XG5cbmV4cG9ydCBmdW5jdGlvbiBsb2cobWVzc2FnZU9yRXJyb3IsIGxldmVsID0gXCJcIikge1xuICBsZXQgc2FsaWVudFN0YWNrTWVzc2FnZUluZGV4ID0gMTtcblxuICBpZiAobGV2ZWwgIT09IFwiXCIpIHtcbiAgICBjb25zdCBsZXZlbEluZGV4ID0gbGV2ZWxzLmluZGV4T2YobGV2ZWwpLFxuICAgICAgICAgIGxvZ0xldmVsSW5kZXggPSBsZXZlbHMuaW5kZXhPZihsb2dMZXZlbCk7XG5cbiAgICBpZiAobGV2ZWxJbmRleCA8IGxvZ0xldmVsSW5kZXgpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBzYWxpZW50U3RhY2tNZXNzYWdlSW5kZXggKz0gMTtcblxuICAgIGxldmVsID0gYCR7bGV2ZWx9IGA7ICAvLy9cbiAgfVxuXG4gIGxldCBlcnJvcixcbiAgICAgIG1lc3NhZ2U7XG5cbiAgaWYgKG1lc3NhZ2VPckVycm9yIGluc3RhbmNlb2YgRXJyb3IpIHtcbiAgICBlcnJvciA9IG1lc3NhZ2VPckVycm9yOyAvLy9cblxuICAgICh7IG1lc3NhZ2UgfSA9IGVycm9yKTtcbiAgfSBlbHNlIHtcbiAgICBtZXNzYWdlID0gbWVzc2FnZU9yRXJyb3I7IC8vL1xuXG4gICAgZXJyb3IgPSBuZXcgRXJyb3IobWVzc2FnZSk7XG4gIH1cblxuICBjb25zdCB7IHN0YWNrIH0gPSBlcnJvcixcbiAgICAgICAgc3RhY2tNZXNzYWdlcyA9IHN0YWNrTWVzc2FnZXNGcm9tU3RhY2soc3RhY2spLFxuICAgICAgICBwZXJ0aW5lbnRTdGFja01lc3NhZ2UgPSBzdGFja01lc3NhZ2VzW3NhbGllbnRTdGFja01lc3NhZ2VJbmRleF0sXG4gICAgICAgIHN0YWNrTWVzc2FnZSA9IHBlcnRpbmVudFN0YWNrTWVzc2FnZSwgLy8vXG4gICAgICAgIGN1cnJlbnREYXRlQW5kVGltZVN0cmluZyA9IGdldEN1cnJlbnREYXRlQW5kVGltZVN0cmluZygpLFxuICAgICAgICBmaWxlUGF0aCA9IGZpbGVQYXRoRnJvbVN0YWNrTWVzc2FnZShzdGFja01lc3NhZ2UpLFxuICAgICAgICBsaW5lTnVtYmVyID0gbGluZU51bWJlckZyb21TdGFja01lc3NhZ2Uoc3RhY2tNZXNzYWdlKSxcbiAgICAgICAgbG9nTWVzc2FnZSA9IGAke2xldmVsfSR7Y3VycmVudERhdGVBbmRUaW1lU3RyaW5nfSAke2ZpbGVQYXRofSgke2xpbmVOdW1iZXJ9KSAke21lc3NhZ2V9YDtcblxuICBjb25zb2xlLmxvZyhsb2dNZXNzYWdlKTtcblxuICBpZiAobG9nRGlyZWN0b3J5UGF0aCAhPT0gbnVsbCkge1xuICAgIHJvbGxPdmVyTG9nRmlsZSgpO1xuXG4gICAgY29uc3QgbG9nRmlsZVBhdGggPSBnZXRMb2dGaWxlUGF0aCgpLFxuICAgICAgICAgIGxvZ0ZpbGVDb250ZW50ID0gYCR7bG9nTWVzc2FnZX1cXG5gO1xuXG4gICAgYXBwZW5kVG9GaWxlKGxvZ0ZpbGVQYXRoLCBsb2dGaWxlQ29udGVudCk7XG4gIH1cblxuICByZXR1cm4gbG9nTWVzc2FnZTtcbn1cblxuZXhwb3J0IGRlZmF1bHQge1xuICBsb2dcbn1cblxuZnVuY3Rpb24gdHJhY2UobWVzc2FnZSkgeyByZXR1cm4gbG9nKG1lc3NhZ2UsIFRSQUNFKTsgfVxuXG5mdW5jdGlvbiBkZWJ1ZyhtZXNzYWdlKSB7IHJldHVybiBsb2cobWVzc2FnZSwgREVCVUcpOyB9XG5cbmZ1bmN0aW9uIGluZm8obWVzc2FnZSkgeyByZXR1cm4gbG9nKG1lc3NhZ2UsIElORk8pOyB9XG5cbmZ1bmN0aW9uIHdhcm5pbmcobWVzc2FnZSkgeyByZXR1cm4gbG9nKG1lc3NhZ2UsIFdBUk5JTkcpOyB9XG5cbmZ1bmN0aW9uIGVycm9yKG1lc3NhZ2UpIHsgcmV0dXJuIGxvZyhtZXNzYWdlLCBFUlJPUik7IH1cblxuZnVuY3Rpb24gZmF0YWwobWVzc2FnZSkgeyByZXR1cm4gbG9nKG1lc3NhZ2UsIEZBVEFMKTsgfVxuXG5mdW5jdGlvbiBzZXRMb2dMZXZlbChsZXZlbCkgeyBsb2dMZXZlbCA9IGxldmVsOyB9XG5cbmZ1bmN0aW9uIHNldExvZ0ZpbGVCYXNlTmFtZShmaWxlQmFzZU5hbWUpIHsgbG9nRmlsZUJhc2VOYW1lID0gZmlsZUJhc2VOYW1lOyB9XG5cbmZ1bmN0aW9uIHNldExvZ0RpcmVjdG9yeVBhdGgoZGlyZWN0b3J5UGF0aCkgeyBsb2dEaXJlY3RvcnlQYXRoID0gZGlyZWN0b3J5UGF0aDsgfVxuXG5mdW5jdGlvbiBzZXRMb2dPcHRpb25zKGxvZ09wdGlvbnMpIHtcbiAgY29uc3QgeyBsZXZlbCwgZmlsZUJhc2VOYW1lLCBkaXJlY3RvcnlQYXRoIH0gPSBsb2dPcHRpb25zO1xuXG4gIHNldExvZ0xldmVsKGxldmVsKTtcblxuICBzZXRMb2dGaWxlQmFzZU5hbWUoZmlsZUJhc2VOYW1lKTtcblxuICBzZXRMb2dEaXJlY3RvcnlQYXRoKGRpcmVjdG9yeVBhdGgpO1xufVxuXG5mdW5jdGlvbiBnZXRMb2dGaWxlQ29udGVudCgpIHtcbiAgY29uc3QgbG9nRmlsZVBhdGggPSBnZXRMb2dGaWxlUGF0aCgpLFxuICAgICAgICBsb2dGaWxlQ29udGVudCA9IHJlYWRGaWxlKGxvZ0ZpbGVQYXRoKTtcblxuICByZXR1cm4gbG9nRmlsZUNvbnRlbnQ7XG59XG5cbk9iamVjdC5hc3NpZ24obG9nLCB7XG4gIFRSQUNFLFxuICBERUJVRyxcbiAgSU5GTyxcbiAgV0FSTklORyxcbiAgRVJST1IsXG4gIEZBVEFMLFxuICB0cmFjZSxcbiAgZGVidWcsXG4gIGluZm8sXG4gIHdhcm5pbmcsXG4gIGVycm9yLFxuICBmYXRhbCxcbiAgc2V0TG9nTGV2ZWwsXG4gIHNldExvZ0ZpbGVCYXNlTmFtZSxcbiAgc2V0TG9nRGlyZWN0b3J5UGF0aCxcbiAgc2V0TG9nT3B0aW9ucyxcbiAgZ2V0TG9nRmlsZUNvbnRlbnRcbn0pO1xuXG5mdW5jdGlvbiBnZXRMb2dGaWxlUGF0aCgpIHtcbiAgY29uc3QgbG9nRmlsZU5hbWUgPSBgJHtsb2dGaWxlQmFzZU5hbWV9LmxvZ2AsXG4gICAgICAgIGxvZ0ZpbGVQYXRoID0gY29uY2F0ZW5hdGVQYXRocyhsb2dEaXJlY3RvcnlQYXRoLCBsb2dGaWxlTmFtZSk7XG5cbiAgcmV0dXJuIGxvZ0ZpbGVQYXRoO1xufVxuXG5mdW5jdGlvbiBnZXRSb2xsZWRPdmVyTG9nRmlsZVBhdGgoKSB7XG4gIGNvbnN0IGN1cnJlbnREYXRlU3RyaW5nID0gZ2V0Q3VycmVudERhdGVTdHJpbmcoKSxcbiAgICAgICAgcm9sbGVkT3ZlckxvZ0ZpbGVOYW1lID0gYCR7bG9nRmlsZUJhc2VOYW1lfS4ke2N1cnJlbnREYXRlU3RyaW5nfS5sb2dgLFxuICAgICAgICByb2xsZWRPdmVyTG9nRmlsZVBhdGggPSBjb25jYXRlbmF0ZVBhdGhzKGxvZ0RpcmVjdG9yeVBhdGgsIHJvbGxlZE92ZXJMb2dGaWxlTmFtZSk7XG5cbiAgcmV0dXJuIHJvbGxlZE92ZXJMb2dGaWxlUGF0aDtcbn1cblxuZnVuY3Rpb24gZ2V0TG9nRmlsZUxhc3RNb2RpZmllZERhdGUoKSB7XG4gIGNvbnN0IGxvZ0ZpbGVQYXRoID0gZ2V0TG9nRmlsZVBhdGgoKSxcbiAgICAgICAgbG9nRmlsZVN0YXRzID0gZ2V0U3RhdHMobG9nRmlsZVBhdGgpLFxuICAgICAgICB7IG10aW1lIH0gPSBsb2dGaWxlU3RhdHMsXG4gICAgICAgIGxvZ0ZpbGVMYXN0TW9kaWZpZWREYXRlID0gbmV3IERhdGUobXRpbWUpOyAgLy8vXG5cbiAgcmV0dXJuIGxvZ0ZpbGVMYXN0TW9kaWZpZWREYXRlO1xufVxuXG5mdW5jdGlvbiByb2xsT3ZlckxvZ0ZpbGUoKSB7XG4gIGNvbnN0IGxvZ0ZpbGVQYXRoID0gZ2V0TG9nRmlsZVBhdGgoKSxcbiAgICAgICAgbG9nRmlsZUV4aXN0cyA9IGNoZWNrRmlsZUV4aXN0cyhsb2dGaWxlUGF0aCk7XG5cbiAgaWYgKCFsb2dGaWxlRXhpc3RzKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgY29uc3QgbG9nRmlsZUxhc3RNb2RpZmllZERhdGUgPSBnZXRMb2dGaWxlTGFzdE1vZGlmaWVkRGF0ZSgpLFxuICAgICAgICBsb2dGaWxlTGFzdE1vZGlmaWVkRGF0ZUN1cnJlbnREYXRlID0gaXNEYXRlQ3VycmVudERhdGUobG9nRmlsZUxhc3RNb2RpZmllZERhdGUpO1xuXG4gIGlmICghbG9nRmlsZUxhc3RNb2RpZmllZERhdGVDdXJyZW50RGF0ZSkge1xuICAgIGNvbnN0IHJvbGxlZE92ZXJMb2dGaWxlUGF0aCA9IGdldFJvbGxlZE92ZXJMb2dGaWxlUGF0aCgpO1xuXG4gICAgcmVuYW1lRmlsZShsb2dGaWxlUGF0aCwgcm9sbGVkT3ZlckxvZ0ZpbGVQYXRoKTtcbiAgfVxufVxuXG5mdW5jdGlvbiBpc0RhdGVDdXJyZW50RGF0ZShkYXRlKSB7XG4gIGNvbnN0IGN1cnJlbnREYXRlID0gbmV3IERhdGUoKSxcbiAgICAgICAgZGF0ZVN0cmluZyA9IGRhdGUudG9EYXRlU3RyaW5nKCksXG4gICAgICAgIGN1cnJlbnREYXRlU3RyaW5nID0gY3VycmVudERhdGUudG9EYXRlU3RyaW5nKCksXG4gICAgICAgIGRhdGVDdXJyZW50RGF0ZSA9IChkYXRlU3RyaW5nID09PSBjdXJyZW50RGF0ZVN0cmluZyk7XG5cbiAgcmV0dXJuIGRhdGVDdXJyZW50RGF0ZTtcbn1cblxuZnVuY3Rpb24gZ2V0Q3VycmVudERhdGVTdHJpbmcoKSB7XG4gIGNvbnN0IGRhdGUgPSBuZXcgRGF0ZSgpLFxuICAgICAgICBkYXkgPSBwYWRTdGFydFdpdGhaZXJvZXMoZGF0ZS5nZXREYXRlKCksIDIpLCAgLy8vXG4gICAgICAgIG1vbnRoID0gcGFkU3RhcnRXaXRoWmVyb2VzKGRhdGUuZ2V0TW9udGgoKSArIDEsIDIpLCAvLy9cbiAgICAgICAgeWVhciA9IGRhdGUuZ2V0RnVsbFllYXIoKSxcbiAgICAgICAgY3VycmVudERhdGVBbmRUaW1lU3RyaW5nID0gYCR7ZGF5fS0ke21vbnRofS0ke3llYXJ9YDtcblxuICByZXR1cm4gY3VycmVudERhdGVBbmRUaW1lU3RyaW5nO1xufVxuXG5mdW5jdGlvbiBnZXRDdXJyZW50RGF0ZUFuZFRpbWVTdHJpbmcoKSB7XG4gIGNvbnN0IGRhdGUgPSBuZXcgRGF0ZSgpLFxuICAgICAgICBkYXkgPSBwYWRTdGFydFdpdGhaZXJvZXMoZGF0ZS5nZXREYXRlKCksIDIpLCAgLy8vXG4gICAgICAgIG1vbnRoID0gcGFkU3RhcnRXaXRoWmVyb2VzKGRhdGUuZ2V0TW9udGgoKSArIDEsIDIpLCAvLy9cbiAgICAgICAgeWVhciA9IGRhdGUuZ2V0RnVsbFllYXIoKSxcbiAgICAgICAgaG91cnMgPSBwYWRTdGFydFdpdGhaZXJvZXMoZGF0ZS5nZXRIb3VycygpLCAyKSxcbiAgICAgICAgbWludXRlcyA9IHBhZFN0YXJ0V2l0aFplcm9lcyhkYXRlLmdldE1pbnV0ZXMoKSwgMiksXG4gICAgICAgIHNlY29uZHMgPSBwYWRTdGFydFdpdGhaZXJvZXMoZGF0ZS5nZXRTZWNvbmRzKCksIDIpLFxuICAgICAgICBtaWxsaXNlY29uZHMgPSBwYWRTdGFydFdpdGhaZXJvZXMoZGF0ZS5nZXRNaWxsaXNlY29uZHMoKSwgMyksXG4gICAgICAgIGN1cnJlbnREYXRlQW5kVGltZVN0cmluZyA9IGAke2RheX0tJHttb250aH0tJHt5ZWFyfSAke2hvdXJzfToke21pbnV0ZXN9OiR7c2Vjb25kc30uJHttaWxsaXNlY29uZHN9YDtcblxuICByZXR1cm4gY3VycmVudERhdGVBbmRUaW1lU3RyaW5nO1xufVxuXG5mdW5jdGlvbiBzdGFja01lc3NhZ2VzRnJvbVN0YWNrKHN0YWNrKSB7XG4gIGNvbnN0IHN0YWNrTWVzc2FnZXMgPSBbXSxcbiAgICAgICAgc3RhY2tMaW5lcyA9IHN0YWNrLnNwbGl0KC9cXHJcXG58XFxuLyk7XG5cbiAgbGV0IHN0YWNrTWVzc2FnZSA9IFwiXCI7XG5cbiAgc3RhY2tMaW5lcy5mb3JFYWNoKChzdGFja0xpbmUpID0+IHtcbiAgICBjb25zdCBtYXRjaGVzID0gL15cXHMqYXQuKi8udGVzdChzdGFja0xpbmUpO1xuXG4gICAgc3RhY2tNZXNzYWdlID0gKHN0YWNrTWVzc2FnZSA9PT0gXCJcIikgP1xuICAgICAgICAgICAgICAgICAgICAgIHN0YWNrTGluZSA6XG4gICAgICAgICAgICAgICAgICAgICAgICBgJHtzdGFja01lc3NhZ2V9XFxuJHtzdGFja0xpbmV9YDtcblxuICAgIGlmIChtYXRjaGVzKSB7XG4gICAgICBzdGFja01lc3NhZ2VzLnB1c2goc3RhY2tNZXNzYWdlKTtcblxuICAgICAgc3RhY2tNZXNzYWdlID0gXCJcIjtcbiAgICB9XG4gIH0pO1xuXG4gIHJldHVybiBzdGFja01lc3NhZ2VzO1xufVxuXG5mdW5jdGlvbiBmaWxlUGF0aEZyb21TdGFja01lc3NhZ2Uoc3RhY2tNZXNzYWdlKSB7XG4gIGNvbnN0IG1hdGNoZXMgPSBzdGFja01lc3NhZ2UubWF0Y2goLyhcXC8uKyk6XFxkKzpcXGQrL20pLFxuICAgICAgICBzZWNvbmRNYXRjaCA9IHNlY29uZChtYXRjaGVzKSxcbiAgICAgICAgYWJzb2x1dGVGaWxlUGF0aCA9IHNlY29uZE1hdGNoLCAgLy8vXG4gICAgICAgIGN1cnJlbnRXb3JraW5nRGlyZWN0b3J5UGF0aCA9IHBhdGgucmVzb2x2ZShcIi5cIiksICAvLy9cbiAgICAgICAgY3VycmVudFdvcmtpbmdEaXJlY3RvcnlQYXRoTGVuZ3RoID0gY3VycmVudFdvcmtpbmdEaXJlY3RvcnlQYXRoLmxlbmd0aCxcbiAgICAgICAgc3RhcnQgPSBjdXJyZW50V29ya2luZ0RpcmVjdG9yeVBhdGhMZW5ndGggKyAxLCAgLy8vXG4gICAgICAgIGZpbGVQYXRoID0gYWJzb2x1dGVGaWxlUGF0aC5zdWJzdHIoc3RhcnQpO1xuXG4gIHJldHVybiBmaWxlUGF0aDtcbn1cblxuZnVuY3Rpb24gbGluZU51bWJlckZyb21TdGFja01lc3NhZ2Uoc3RhY2tNZXNzYWdlKSB7XG4gIGNvbnN0IG1hdGNoZXMgPSBzdGFja01lc3NhZ2UubWF0Y2goLzooXFxkKykvbSksXG4gICAgICAgIHNlY29uZE1hdGNoID0gc2Vjb25kKG1hdGNoZXMpLFxuICAgICAgICBsaW5lTnVtYmVyID0gc2Vjb25kTWF0Y2g7IC8vL1xuXG4gIHJldHVybiBsaW5lTnVtYmVyO1xufVxuXG5mdW5jdGlvbiBwYWRTdGFydFdpdGhaZXJvZXMoc3RyaW5nLCB0YXJnZXRMZW5ndGgpIHtcbiAgY29uc3QgcGFkU3RyaW5nID0gXCIwXCIsXG4gICAgICAgIHBhZGRlZFN0cmluZyA9IHBhZFN0YXJ0KHN0cmluZywgdGFyZ2V0TGVuZ3RoLCBwYWRTdHJpbmcpO1xuXG4gIHJldHVybiBwYWRkZWRTdHJpbmc7XG59XG5cbmZ1bmN0aW9uIHBhZFN0YXJ0KHN0cmluZywgdGFyZ2V0TGVuZ3RoLCBwYWRTdHJpbmcpIHtcbiAgbGV0IHBhZGRpbmcgPSBcIlwiO1xuXG4gIGZvciAobGV0IGluZGV4ID0gMDsgaW5kZXggPCB0YXJnZXRMZW5ndGg7IGluZGV4KyspIHtcbiAgICBwYWRkaW5nICs9IHBhZFN0cmluZztcbiAgfVxuXG4gIGNvbnN0IHBhZGRlZFN0cmluZyA9IGAke3BhZGRpbmd9JHtzdHJpbmd9YC5zdWJzdHIoLXRhcmdldExlbmd0aCk7XG5cbiAgcmV0dXJuIHBhZGRlZFN0cmluZztcbn1cbiJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O1FBc0JBLEdBQUEsR0FBQSxHQUFBOztJQXBCQSxLQUFBO0lBRUEsTUFBQTtJQUNBLE1BQUE7SUFDQSxXQUFBO0lBQ0EsVUFBQTs7Ozs7Ozs7Ozs7OztDQVBBLFVBQUE7SUFTQSxNQUFBO0FBRkEsY0FBQTtBQUFBLGNBQUE7QUFBQSxjQUFBO0FBQUEsY0FBQTtBQUFBLGNBQUE7QUFBQSxjQUFBOztJQVdBLFFBQUEsR0FYQSxVQUFBLG9CQVlBLGVBQUEsR0FaQSxVQUFBLDZCQWFBLGdCQUFBLEdBYkEsVUFBQTtTQWVBLEdBQUEsQ0FBQSxjQUFBLEVBQUEsS0FBQTtRQUFBLEtBQUEsR0FBQSxLQUFBLG1CQUFBLEtBQUE7UUFDQSx3QkFBQSxHQUFBLENBQUE7UUFFQSxLQUFBO1lBQ0EsVUFBQSxHQUFBLE1BQUEsQ0FBQSxPQUFBLENBQUEsS0FBQSxHQUNBLGFBQUEsR0FBQSxNQUFBLENBQUEsT0FBQSxDQUFBLFFBQUE7WUFFQSxVQUFBLEdBQUEsYUFBQTs7O0FBSUEsZ0NBQUEsSUFBQSxDQUFBO0FBRUEsYUFBQSxNQUFBLE1BQUEsQ0FBQSxLQUFBLEdBQUEsQ0FBQSxHQUFBLENBQUEsRUFBQSxDQUFBOztRQUdBLEtBQUEsRUFDQSxPQUFBO1FBRUEsV0FBQSxDQUFBLGNBQUEsRUFBQSxLQUFBO0FBQ0EsYUFBQSxHQUFBLGNBQUEsQ0FBQSxDQUFBLEVBQUEsQ0FBQTs7Y0FFQSxLQUFBLEVBQUEsT0FBQSxPQUFBLE9BQUE7O0FBRUEs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QUEsSUFBQTtXQUVBLHdCQUFBOztTQUdBLDJCQUFBO1FBQ0EsSUFBQSxPQUFBLElBQUEsSUFDQSxHQUFBLEdBQUEsa0JBQUEsQ0FBQSxJQUFBLENBQUEsT0FBQSxJQUFBLENBQUEsR0FDQSxLQUFBLEdBQUEsa0JBQUEsQ0FBQSxJQUFBLENBQUEsUUFBQSxLQUFBLENBQUEsRUFBQSxDQUFBLEdBQ0EsSUFBQSxHQUFBLElBQUEsQ0FBQSxXQUFBLElBQ0EsS0FBQSxHQUFBLGtCQUFBLENBQUEsSUFBQSxDQUFBLFFBQUEsSUFBQSxDQUFBLEdBQ0EsT0FBQSxHQUFBLGtCQUFBLENBQUEsSUFBQSxDQUFBLFVBQUEsSUFBQSxDQUFBLEdBQ0EsT0FBQSxHQUFBLGtCQUFBLENBQUEsSUFBQSxDQUFBLFVBQUEsSUFBQSxDQUFBLEdBQ0EsWUFBQSxHQUFBLGtCQUFBLENBQUEsSUFBQSxDQUFBLGVBQUEsSUFBQSxDQUFBLEdBQ0Esd0JBQUEsTUFBQSxNQUFBLENBQUEsR0FBQSxHQUFBLENBQUEsR0FBQSxNQUFBLENBQUEsS0FBQSxHQUFBLENBQUEsR0FBQSxNQUFBLENBQUEsSUFBQSxHQUFBLENBQUEsR0FBQSxNQUFBLENBQUEsS0FBQSxHQUFBLENBQUEsR0FBQSxNQUFBLENBQUEsT0FBQSxHQUFBLENBQUEsR0FBQSxNQUFBLENBQUEsT0FBQSxHQUFBLENBQUEsR0FBQSxNQUFBLENBQUEsWUFBQTtXQUVBLHdCQUFBOztTQUdBLHNCQUFBLENBQUEsS0FBQTtRQUNBLGFBQUEsT0FDQSxVQUFBLEdBQUEsS0FBQSxDQUFBLEtBQUE7UUFFQSxZQUFBO0FBRUEsY0FBQSxDQUFBLE9BQUEsVUFBQSxTQUFBO1lBQ0EsT0FBQSxjQUFBLElBQUEsQ0FBQSxTQUFBO0FBRUEsb0JBQUEsR0FBQSxZQUFBLFVBQ0EsU0FBQSxNQUNBLE1BQUEsQ0FBQSxZQUFBLEdBQUEsRUFBQSxHQUFBLE1BQUEsQ0FBQSxTQUFBO1lBRUEsT0FBQTtBQUNBLHlCQUFBLENBQUEsSUFBQSxDQUFBLFlBQUE7QUFFQSx3QkFBQTs7O1dBSUEsYUFBQTs7U0FHQSx3QkFBQSxDQUFBLFlBQUE7UUFDQSxPQUFBLEdBQUEsWUFBQSxDQUFBLEtBQUEscUJBQ0EsV0FBQSxHQXJPQSxNQUFBLFFBcU9BLE9BQUEsR0FDQSxnQkFBQSxHQUFBLFdBQUEsRUFDQSwyQkFBQSxHQXpPQSxLQUFBLFNBeU9BLE9BQUEsRUFBQSxDQUFBLElBQ0EsaUNBQUEsR0FBQSwyQkFBQSxDQUFBLE1BQUEsRUFDQSxLQUFBLEdBQUEsaUNBQUEsR0FBQSxDQUFBLEVBQ0EsUUFBQSxHQUFBLGdCQUFBLENBQUEsTUFBQSxDQUFBLEtBQUE7V0FFQSxRQUFBOztTQUdBLDBCQUFBLENBQUEsWUFBQTtRQUNBLE9BQUEsR0FBQSxZQUFBLENBQUEsS0FBQSxhQUNBLFdBQUEsR0FqUEEsTUFBQSxRQWlQQSxPQUFBLEdBQ0EsVUFBQSxHQUFBLFdBQUEsQ0FBQSxDQUFBLEVBQUEsQ0FBQTtXQUVBLFVBQUE7O1NBR0Esa0JBQUEsQ0FBQSxNQUFBLEVBQUEsWUFBQTtRQUNBLFNBQUEsSUFBQSxDQUFBLEdBQ0EsWUFBQSxHQUFBLFFBQUEsQ0FBQSxNQUFBLEVBQUEsWUFBQSxFQUFBLFNBQUE7V0FFQSxZQUFBOztTQUdBLFFBQUEsQ0FBQSxNQUFBLEVBQUEsWUFBQSxFQUFBLFNBQUE7UUFDQSxPQUFBO1lBRUEsS0FBQSxHQUFBLENBQUEsRUFBQSxLQUFBLEdBQUEsWUFBQSxFQUFBLEtBQUE7QUFDQSxlQUFBLElBQUEsU0FBQTs7UUFHQSxZQUFBLE1BQUEsTUFBQSxDQUFBLE9BQUEsRUFBQSxNQUFBLENBQUEsTUFBQSxFQUFBLE1BQUEsRUFBQSxZQUFBO1dBRUEsWUFBQSJ9