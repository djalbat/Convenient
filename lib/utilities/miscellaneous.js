'use strict';

var GET_METHOD = 'GET',
    POST_METHOD = 'POST',
    ETX_CHARACTER = '\x03';

function get(host, uri, parameters, callback) {
  if (callback === undefined) {
    callback = parameters; ///
    parameters = {};
  }

  var method = GET_METHOD,
      body = undefined;

  request(host, uri, parameters, method, body, callback);
}

function post(host, uri, json, parameters, callback) {
  if (callback === undefined) {
    callback = parameters; ///
    parameters = {};
  }

  var method = POST_METHOD,
      body = JSON.stringify(json);

  request(host, uri, parameters, method, body, callback);
}

function onETX(handler) {
  var _process = process,
      stdin = _process.stdin,
      setRawMode = stdin.setRawMode;


  if (setRawMode) {
    var rawMode = true,
        encoding = 'utf8';

    stdin.setRawMode(rawMode);
    stdin.setEncoding(encoding);

    stdin.resume();

    stdin.addListener('data', dataHandler);

    return offExt;
  }

  function offExt() {
    stdin.removeListener('data', dataHandler);
  }

  function dataHandler(character) {
    if (character === ETX_CHARACTER) {
      handler();
    }
  }
}

module.exports = {
  get: get,
  post: post,
  onETX: onETX
};

function request(host, uri, parameters, method, body, callback) {
  var url = urlFromHostURIAndParameters(host, uri, parameters),
      xmlHttpRequest = new XMLHttpRequest();

  xmlHttpRequest.onreadystatechange = function () {
    var readyState = xmlHttpRequest.readyState,
        status = xmlHttpRequest.status,
        responseText = xmlHttpRequest.responseText;


    if (readyState == 4) {
      if (status == 200) {
        var jsonString = responseText,
            ///
        json = JSON.parse(jsonString);

        callback(json);
      } else {
        callback(null);
      }
    }
  };

  xmlHttpRequest.open(method, url, true);

  xmlHttpRequest.setRequestHeader('Content-Type', 'application/json');

  xmlHttpRequest.send(body);
}

function urlFromHostURIAndParameters(host, uri, parameters) {
  var queryString = queryStringFromParameters(parameters),
      url = queryString === '' ? host + '/' + uri : host + '/' + uri + '?' + queryString;

  return url;
}

function queryStringFromParameters(parameters) {
  var names = Object.keys(parameters),
      namesLength = names.length,
      lastIndex = namesLength - 1,
      queryString = names.reduce(function (queryString, name, index) {
    var value = parameters[name],
        encodedName = encodeURIComponent(name),
        encodedValue = encodeURIComponent(value),
        ampersandOrNothing = index !== lastIndex ? '&' : '';

    queryString += encodedName + '=' + encodedValue + ampersandOrNothing;

    return queryString;
  }, '');

  return queryString;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL2VzNi91dGlsaXRpZXMvbWlzY2VsbGFuZW91cy5qcyJdLCJuYW1lcyI6WyJHRVRfTUVUSE9EIiwiUE9TVF9NRVRIT0QiLCJFVFhfQ0hBUkFDVEVSIiwiZ2V0IiwiaG9zdCIsInVyaSIsInBhcmFtZXRlcnMiLCJjYWxsYmFjayIsInVuZGVmaW5lZCIsIm1ldGhvZCIsImJvZHkiLCJyZXF1ZXN0IiwicG9zdCIsImpzb24iLCJKU09OIiwic3RyaW5naWZ5Iiwib25FVFgiLCJoYW5kbGVyIiwicHJvY2VzcyIsInN0ZGluIiwic2V0UmF3TW9kZSIsInJhd01vZGUiLCJlbmNvZGluZyIsInNldEVuY29kaW5nIiwicmVzdW1lIiwiYWRkTGlzdGVuZXIiLCJkYXRhSGFuZGxlciIsIm9mZkV4dCIsInJlbW92ZUxpc3RlbmVyIiwiY2hhcmFjdGVyIiwibW9kdWxlIiwiZXhwb3J0cyIsInVybCIsInVybEZyb21Ib3N0VVJJQW5kUGFyYW1ldGVycyIsInhtbEh0dHBSZXF1ZXN0IiwiWE1MSHR0cFJlcXVlc3QiLCJvbnJlYWR5c3RhdGVjaGFuZ2UiLCJyZWFkeVN0YXRlIiwic3RhdHVzIiwicmVzcG9uc2VUZXh0IiwianNvblN0cmluZyIsInBhcnNlIiwib3BlbiIsInNldFJlcXVlc3RIZWFkZXIiLCJzZW5kIiwicXVlcnlTdHJpbmciLCJxdWVyeVN0cmluZ0Zyb21QYXJhbWV0ZXJzIiwibmFtZXMiLCJPYmplY3QiLCJrZXlzIiwibmFtZXNMZW5ndGgiLCJsZW5ndGgiLCJsYXN0SW5kZXgiLCJyZWR1Y2UiLCJuYW1lIiwiaW5kZXgiLCJ2YWx1ZSIsImVuY29kZWROYW1lIiwiZW5jb2RlVVJJQ29tcG9uZW50IiwiZW5jb2RlZFZhbHVlIiwiYW1wZXJzYW5kT3JOb3RoaW5nIl0sIm1hcHBpbmdzIjoiQUFBQTs7QUFFQSxJQUFNQSxhQUFhLEtBQW5CO0FBQUEsSUFDTUMsY0FBYyxNQURwQjtBQUFBLElBRU1DLGdCQUFnQixNQUZ0Qjs7QUFJQSxTQUFTQyxHQUFULENB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Z0JBQWYsQ0FBZ0MsY0FBaEMsRUFBZ0Qsa0JBQWhEOztBQUVBVCxpQkFBZVUsSUFBZixDQUFvQmxDLElBQXBCO0FBQ0Q7O0FBRUQsU0FBU3VCLDJCQUFULENBQXFDN0IsSUFBckMsRUFBMkNDLEdBQTNDLEVBQWdEQyxVQUFoRCxFQUE0RDtBQUMxRCxNQUFNdUMsY0FBY0MsMEJBQTBCeEMsVUFBMUIsQ0FBcEI7QUFBQSxNQUNNMEIsTUFBT2EsZ0JBQWdCLEVBQWpCLEdBQ0t6QyxJQURMLFNBQ2FDLEdBRGIsR0FFT0QsSUFGUCxTQUVlQyxHQUZmLFNBRXNCd0MsV0FIbEM7O0FBS0EsU0FBT2IsR0FBUDtBQUNEOztBQUVELFNBQVNjLHlCQUFULENBQW1DeEMsVUFBbkMsRUFBK0M7QUFDN0MsTUFBTXlDLFFBQVFDLE9BQU9DLElBQVAsQ0FBWTNDLFVBQVosQ0FBZDtBQUFBLE1BQ000QyxjQUFjSCxNQUFNSSxNQUQxQjtBQUFBLE1BRU1DLFlBQVlGLGNBQWMsQ0FGaEM7QUFBQSxNQUdNTCxjQUFjRSxNQUFNTSxNQUFOLENBQWEsVUFBU1IsV0FBVCxFQUFzQlMsSUFBdEIsRUFBNEJDLEtBQTVCLEVBQW1DO0FBQzVELFFBQU1DLFFBQVFsRCxXQUFXZ0QsSUFBWCxDQUFkO0FBQUEsUUFDTUcsY0FBY0MsbUJBQW1CSixJQUFuQixDQURwQjtBQUFBLFFBRU1LLGVBQWVELG1CQUFtQkYsS0FBbkIsQ0FGckI7QUFBQSxRQUdNSSxxQkFBc0JMLFVBQVVILFNBQVgsR0FBd0IsR0FBeEIsR0FBOEIsRUFIekQ7O0FBS0FQLG1CQUFrQlksV0FBbEIsU0FBaUNFLFlBQWpDLEdBQWdEQyxrQkFBaEQ7O0FBRUEsV0FBT2YsV0FBUDtBQUNELEdBVGEsRUFTWCxFQVRXLENBSHBCOztBQWNBLFNBQU9BLFdBQVA7QUFDRCIsImZpbGUiOiJtaXNjZWxsYW5lb3VzLmpzIiwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xuXG5jb25zdCBHRVRfTUVUSE9EID0gJ0dFVCcsXG4gICAgICBQT1NUX01FVEhPRCA9ICdQT1NUJyxcbiAgICAgIEVUWF9DSEFSQUNURVIgPSAnXFx1MDAwMyc7XG5cbmZ1bmN0aW9uIGdldChob3N0LCB1cmksIHBhcmFtZXRlcnMsIGNhbGxiYWNrKSB7XG4gIGlmIChjYWxsYmFjayA9PT0gdW5kZWZpbmVkKSB7XG4gICAgY2FsbGJhY2sgPSBwYXJhbWV0ZXJzOyAvLy9cbiAgICBwYXJhbWV0ZXJzID0ge307XG4gIH1cblxuICBjb25zdCBtZXRob2QgPSBHRVRfTUVUSE9ELFxuICAgICAgICBib2R5ID0gdW5kZWZpbmVkO1xuXG4gIHJlcXVlc3QoaG9zdCwgdXJpLCBwYXJhbWV0ZXJzLCBtZXRob2QsIGJvZHksIGNhbGxiYWNrKTtcbn1cblxuZnVuY3Rpb24gcG9zdChob3N0LCB1cmksIGpzb24sIHBhcmFtZXRlcnMsIGNhbGxiYWNrKSB7XG4gIGlmIChjYWxsYmFjayA9PT0gdW5kZWZpbmVkKSB7XG4gICAgY2FsbGJhY2sgPSBwYXJhbWV0ZXJzOyAvLy9cbiAgICBwYXJhbWV0ZXJzID0ge307XG4gIH1cblxuICBjb25zdCBtZXRob2QgPSBQT1NUX01FVEhPRCxcbiAgICAgICAgYm9keSA9IEpTT04uc3RyaW5naWZ5KGpzb24pO1xuXG4gIHJlcXVlc3QoaG9zdCwgdXJpLCBwYXJhbWV0ZXJzLCBtZXRob2QsIGJvZHksIGNhbGxiYWNrKTtcbn1cblxuZnVuY3Rpb24gb25FVFgoaGFuZGxlcikge1xuICBjb25zdCB7IHN0ZGluIH0gPSBwcm9jZXNzLFxuICAgICAgICB7IHNldFJhd01vZGUgfSA9IHN0ZGluO1xuXG4gIGlmIChzZXRSYXdNb2RlKSB7XG4gICAgY29uc3QgcmF3TW9kZSA9IHRydWUsXG4gICAgICAgICAgZW5jb2RpbmcgPSAndXRmOCc7XG5cbiAgICBzdGRpbi5zZXRSYXdNb2RlKHJhd01vZGUpO1xuICAgIHN0ZGluLnNldEVuY29kaW5nKGVuY29kaW5nKTtcblxuICAgIHN0ZGluLnJlc3VtZSgpO1xuXG4gICAgc3RkaW4uYWRkTGlzdGVuZXIoJ2RhdGEnLCBkYXRhSGFuZGxlcik7XG5cbiAgICByZXR1cm4gb2ZmRXh0O1xuICB9XG5cbiAgZnVuY3Rpb24gb2ZmRXh0KCkge1xuICAgIHN0ZGluLnJlbW92ZUxpc3RlbmVyKCdkYXRhJywgZGF0YUhhbmRsZXIpO1xuICB9XG5cbiAgZnVuY3Rpb24gZGF0YUhhbmRsZXIoY2hhcmFjdGVyKSB7XG4gICAgaWYgKGNoYXJhY3RlciA9PT0gRVRYX0NIQVJBQ1RFUikge1xuICAgICAgaGFuZGxlcigpO1xuICAgIH1cbiAgfVxufVxuXG5tb2R1bGUuZXhwb3J0cyA9IHtcbiAgZ2V0OiBnZXQsXG4gIHBvc3Q6IHBvc3QsXG4gIG9uRVRYOiBvbkVUWFxufTtcblxuZnVuY3Rpb24gcmVxdWVzdChob3N0LCB1cmksIHBhcmFtZXRlcnMsIG1ldGhvZCwgYm9keSwgY2FsbGJhY2spIHtcbiAgY29uc3QgdXJsID0gdXJsRnJvbUhvc3RVUklBbmRQYXJhbWV0ZXJzKGhvc3QsIHVyaSwgcGFyYW1ldGVycyksXG4gICAgICAgIHhtbEh0dHBSZXF1ZXN0ID0gbmV3IFhNTEh0dHBSZXF1ZXN0KCk7XG5cbiAgeG1sSHR0cFJlcXVlc3Qub25yZWFkeXN0YXRlY2hhbmdlID0gZnVuY3Rpb24oKSB7XG4gICAgY29uc3QgeyByZWFkeVN0YXRlLCBzdGF0dXMsIHJlc3BvbnNlVGV4dCB9ID0geG1sSHR0cFJlcXVlc3Q7XG5cbiAgICBpZiAocmVhZHlTdGF0ZSA9PSA0KSB7XG4gICAgICBpZiAoc3RhdHVzID09IDIwMCkge1xuICAgICAgICBjb25zdCBqc29uU3RyaW5nID0gcmVzcG9uc2VUZXh0LCAvLy9cbiAgICAgICAgICAgICAganNvbiA9IEpTT04ucGFyc2UoanNvblN0cmluZyk7XG5cbiAgICAgICAgY2FsbGJhY2soanNvbik7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBjYWxsYmFjayhudWxsKTtcbiAgICAgIH1cbiAgICB9XG4gIH07XG5cbiAgeG1sSHR0cFJlcXVlc3Qub3BlbihtZXRob2QsIHVybCwgdHJ1ZSk7XG5cbiAgeG1sSHR0cFJlcXVlc3Quc2V0UmVxdWVzdEhlYWRlcignQ29udGVudC1UeXBlJywgJ2FwcGxpY2F0aW9uL2pzb24nKTtcblxuICB4bWxIdHRwUmVxdWVzdC5zZW5kKGJvZHkpO1xufVxuXG5mdW5jdGlvbiB1cmxGcm9tSG9zdFVSSUFuZFBhcmFtZXRlcnMoaG9zdCwgdXJpLCBwYXJhbWV0ZXJzKSB7XG4gIGNvbnN0IHF1ZXJ5U3RyaW5nID0gcXVlcnlTdHJpbmdGcm9tUGFyYW1ldGVycyhwYXJhbWV0ZXJzKSxcbiAgICAgICAgdXJsID0gKHF1ZXJ5U3RyaW5nID09PSAnJykgP1xuICAgICAgICAgICAgICAgIGAke2hvc3R9LyR7dXJpfWAgOlxuICAgICAgICAgICAgICAgICAgYCR7aG9zdH0vJHt1cml9PyR7cXVlcnlTdHJpbmd9YDtcblxuICByZXR1cm4gdXJsO1xufVxuXG5mdW5jdGlvbiBxdWVyeVN0cmluZ0Zyb21QYXJhbWV0ZXJzKHBhcmFtZXRlcnMpIHtcbiAgY29uc3QgbmFtZXMgPSBPYmplY3Qua2V5cyhwYXJhbWV0ZXJzKSxcbiAgICAgICAgbmFtZXNMZW5ndGggPSBuYW1lcy5sZW5ndGgsXG4gICAgICAgIGxhc3RJbmRleCA9IG5hbWVzTGVuZ3RoIC0gMSxcbiAgICAgICAgcXVlcnlTdHJpbmcgPSBuYW1lcy5yZWR1Y2UoZnVuY3Rpb24ocXVlcnlTdHJpbmcsIG5hbWUsIGluZGV4KSB7XG4gICAgICAgICAgY29uc3QgdmFsdWUgPSBwYXJhbWV0ZXJzW25hbWVdLFxuICAgICAgICAgICAgICAgIGVuY29kZWROYW1lID0gZW5jb2RlVVJJQ29tcG9uZW50KG5hbWUpLFxuICAgICAgICAgICAgICAgIGVuY29kZWRWYWx1ZSA9IGVuY29kZVVSSUNvbXBvbmVudCh2YWx1ZSksXG4gICAgICAgICAgICAgICAgYW1wZXJzYW5kT3JOb3RoaW5nID0gKGluZGV4ICE9PSBsYXN0SW5kZXgpID8gJyYnIDogJyc7XG5cbiAgICAgICAgICBxdWVyeVN0cmluZyArPSBgJHtlbmNvZGVkTmFtZX09JHtlbmNvZGVkVmFsdWV9JHthbXBlcnNhbmRPck5vdGhpbmd9YDtcblxuICAgICAgICAgIHJldHVybiBxdWVyeVN0cmluZztcbiAgICAgICAgfSwgJycpO1xuXG4gIHJldHVybiBxdWVyeVN0cmluZztcbn1cbiJdfQ==