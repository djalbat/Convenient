'use strict';

var GET_METHOD = 'GET',
    POST_METHOD = 'POST',
    ETX_CHARACTER = '\x03';

function get(host, uri, parameters, callback) {
  if (callback === undefined) {
    callback = parameters; ///
    parameters = {};
  }

  var method = GET_METHOD,
      body = undefined;

  this.request(host, uri, parameters, method, body, callback);
}

function post(host, uri, json, parameters, callback) {
  if (callback === undefined) {
    callback = parameters; ///
    parameters = {};
  }

  var method = POST_METHOD,
      body = JSON.stringify(json);

  this.request(host, uri, parameters, method, body, callback);
}

function onETX(handler) {
  var _process = process,
      stdin = _process.stdin,
      setRawMode = stdin.setRawMode;


  if (setRawMode) {
    var rawMode = true,
        encoding = 'utf8';

    stdin.setRawMode(rawMode);
    stdin.setEncoding(encoding);

    stdin.resume();

    stdin.addListener('data', dataHandler);

    return offExt;
  }

  function offExt() {
    stdin.removeListener('data', dataHandler);
  }

  function dataHandler(character) {
    if (character === ETX_CHARACTER) {
      handler();
    }
  }
}

module.exports = {
  get: get,
  post: post,
  onETX: onETX
};

function request(host, uri, parameters, method, body, callback) {
  var url = urlFromHostURIAndParameters(host, uri, parameters),
      xmlHttpRequest = new XMLHttpRequest();

  xmlHttpRequest.onreadystatechange = function () {
    var readyState = xmlHttpRequest.readyState,
        status = xmlHttpRequest.status,
        responseText = xmlHttpRequest.responseText;


    if (readyState == 4) {
      if (status == 200) {
        var jsonString = responseText,
            ///
        json = JSON.parse(jsonString);

        callback(json);
      } else {
        callback(null);
      }
    }
  };

  xmlHttpRequest.open(method, url, true);

  xmlHttpRequest.setRequestHeader('Content-Type', 'application/json');

  xmlHttpRequest.send(body);
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL2VzNi91dGlsaXRpZXMvbWlzY2VsbGFuZW91cy5qcyJdLCJuYW1lcyI6WyJHRVRfTUVUSE9EIiwiUE9TVF9NRVRIT0QiLCJFVFhfQ0hBUkFDVEVSIiwiZ2V0IiwiaG9zdCIsInVyaSIsInBhcmFtZXRlcnMiLCJjYWxsYmFjayIsInVuZGVmaW5lZCIsIm1ldGhvZCIsImJvZHkiLCJyZXF1ZXN0IiwicG9zdCIsImpzb24iLCJKU09OIiwic3RyaW5naWZ5Iiwib25FVFgiLCJoYW5kbGVyIiwicHJvY2VzcyIsInN0ZGluIiwic2V0UmF3TW9kZSIsInJhd01vZGUiLCJlbmNvZGluZyIsInNldEVuY29kaW5nIiwicmVzdW1lIiwiYWRkTGlzdGVuZXIiLCJkYXRhSGFuZGxlciIsIm9mZkV4dCIsInJlbW92ZUxpc3RlbmVyIiwiY2hhcmFjdGVyIiwibW9kdWxlIiwiZXhwb3J0cyIsInVybCIsInVybEZyb21Ib3N0VVJJQW5kUGFyYW1ldGVycyIsInhtbEh0dHBSZXF1ZXN0IiwiWE1MSHR0cFJlcXVlc3QiLCJvbnJlYWR5c3RhdGVjaGFuZ2UiLCJyZWFkeVN0YXRlIiwic3RhdHVzIiwicmVzcG9uc2VUZXh0IiwianNvblN0cmluZyIsInBhcnNlIiwib3BlbiIsInNldFJlcXVlc3RIZWFkZXIiLCJzZW5kIl0sIm1hcHBpbmdzIjoiQUFBQTs7QUFFQSxJQUFNQSxhQUFhLEtBQW5CO0FBQUEsSUFDTUMsY0FBYyxNQURwQjtBQUFBLElBRU1DLGdCQUFnQixNQUZ0Qjs7QUFJQSxTQUFTQyxHQUFULENBQWFDLElBQWIsRUFBbUJDLEdBQW5CLEVBQXdCQyxVQUF4QixFQUFvQ0MsUUFBcEMsRUFBOEM7QUFDNUMsTUFBSUEsYUFBYUMsU0FBakIsRUFBNEI7QUFDMUJELGVBQVdELFVBQVgsQ0FEMEIsQ0FDSDtBQUN2QkEsaUJBQWEsRUFBYjtBQUNEOztBQUVELE1BQU1HLFNBQVNULFVBQWY7QUFBQSxNQUNNVSxPQUFPRixTQURiOztBQUdBLE9BQUtHLE9BQUwsQ0FBYVAsSUFBYixFQUFtQkMsR0FBbkIsRUFBd0JDLFVBQXhCLEVBQW9DRyxNQUFwQyxFQUE0Q0MsSUFBNUMsRUFBa0RILFFBQWxEO0FBQ0Q7O0FBRUQsU0FBU0ssSUFBVCxDQUFjUixJQUFkLEVBQW9CQyxHQUFwQixFQUF5QlEsSUFBekIsRUFBK0JQLFVBQS9CLEVBQTJDQyxRQUEzQyxFQUFxRDtBQUNuRCxNQUFJQSxhQUFhQyxTQUFqQixFQUE0QjtBQUMxQkQsZUFBV0QsVUFBWCxDQUQwQixDQUNIO0FBQ3ZCQSxpQkFBYSxFQUFiO0FBQ0Q7O0FBRUQsTUFBTUcsU0FBU1IsV0FBZjtBQUFBLE1BQ01TLE9BQU9JLEtBQUtDLFNBQUwsQ0FBZUYsSUFBZixDQURiOztBQUdBLE9BQUtGLE9BQUwsQ0FBYVAsSUFBYixFQUFtQkMsR0FBbkIsRUFBd0JDLFVBQXhCLEVBQW9DRyxNQUFwQyxFQUE0Q0MsSUFBNUMsRUFBa0RILFFBQWxEO0FBQ0Q7O0FBRUQsU0FBU1MsS0FBVCxDQUFlQyxPQUFmLEVBQXdCO0FBQUEsaUJBQ0pDLE9BREk7QUFBQSxNQUNkQyxLQURjLFlBQ2RBLEtBRGM7QUFBQSxNQUVkQyxVQUZjLEdBRUNELEtBRkQsQ0FFZEMsVUFGYzs7O0FBSXRCLE1BQUlBLFVBQUosRUFBZ0I7QUFDZCxRQUFNQyxVQUFVLElBQWhCO0FBQUEsUUFDTUMsV0FBVyxNQURqQjs7QUFHQUgsVUFBTUMsVUFBTixDQUFpQkMsT0FBakI7QUFDQUYsVUFBTUksV0FBTixDQUFrQkQsUUFBbEI7O0FBRUFILFVBQU1LLE1BQU47O0FBRUFMLFVBQU1NLFdBQU4sQ0FBa0IsTUFBbEIsRUFBMEJDLFdBQTFCOztBQUVBLFdBQU9DLE1BQVA7QUFDRDs7QUFFRCxXQUFTQSxNQUFULEdBQWtCO0FBQ2hCUixVQUFNUyxjQUFOLENBQXFCLE1BQXJCLEVBQTZCRixXQUE3QjtBQUNEOztBQUVELFdBQVNBLFdBQVQsQ0FBcUJHLFNBQXJCLEVBQWdDO0FBQzlCLFFBQUlBLGNBQWMzQixhQUFsQixFQUFpQztBQUMvQmU7QUFDRDtBQUNGO0FBQ0Y7O0FBRURhLE9BQU9DLE9BQVAsR0FBaUI7QUFDZjVCLE9BQUtBLEdBRFU7QUFFZlMsUUFBTUEsSUFGUztBQUdmSSxTQUFPQTtBQUhRLENBQWpCOztBQU1BLFNBQVNMLE9BQVQsQ0FBaUJQLElBQWpCLEVBQXVCQyxHQUF2QixFQUE0QkMsVUFBNUIsRUFBd0NHLE1BQXhDLEVBQWdEQyxJQUFoRCxFQUFzREgsUUFBdEQsRUFBZ0U7QUFDOUQsTUFBTXlCLE1BQU1DLDRCQUE0QjdCLElBQTVCLEVBQWtDQyxHQUFsQyxFQUF1Q0MsVUFBdkMsQ0FBWjtBQUFBLE1BQ000QixpQkFBaUIsSUFBSUMsY0FBSixFQUR2Qjs7QUFHQUQsaUJBQWVFLGtCQUFmLEdBQW9DLFlBQVc7QUFBQSxRQUNyQ0MsVUFEcUMsR0FDQUgsY0FEQSxDQUNyQ0csVUFEcUM7QUFBQSxRQUN6QkMsTUFEeUIsR0FDQUosY0FEQSxDQUN6QkksTUFEeUI7QUFBQSxRQUNqQkMsWUFEaUIsR0FDQUwsY0FEQSxDQUNqQkssWUFEaUI7OztBQUc3QyxRQUFJRixjQUFjLENBQWxCLEVBQXFCO0FBQ25CLFVBQUlDLFVBQVUsR0FBZCxFQUFtQjtBQUNqQixZQUFNRSxhQUFhRCxZQUFuQjtBQUFBLFlBQWlDO0FBQzNCMUIsZUFBT0MsS0FBSzJCLEtBQUwsQ0FBV0QsVUFBWCxDQURiOztBQUdBakMsaUJBQVNNLElBQVQ7QUFDRCxPQUxELE1BS087QUFDTE4saUJBQVMsSUFBVDtBQUNEO0FBQ0Y7QUFDRixHQWJEOztBQWVBMkIsaUJBQWVRLElBQWYsQ0FBb0JqQyxNQUFwQixFQUE0QnVCLEdBQTVCLEVBQWlDLElBQWpDOztBQUVBRSxpQkFBZVMsZ0JBQWYsQ0FBZ0MsY0FBaEMsRUFBZ0Qsa0JBQWhEOztBQUVBVCxpQkFBZVUsSUFBZixDQUFvQmxDLElBQXBCO0FBQ0QiLCJmaWxlIjoibWlzY2VsbGFuZW91cy5qcyIsInNvdXJjZXNDb250ZW50IjpbIid1c2Ugc3RyaWN0JztcblxuY29uc3QgR0VUX01FVEhPRCA9ICdHRVQnLFxuICAgICAgUE9TVF9NRVRIT0QgPSAnUE9TVCcsXG4gICAgICBFVFhfQ0hBUkFDVEVSID0gJ1xcdTAwMDMnO1xuXG5mdW5jdGlvbiBnZXQoaG9zdCwgdXJpLCBwYXJhbWV0ZXJzLCBjYWxsYmFjaykge1xuICBpZiAoY2FsbGJhY2sgPT09IHVuZGVmaW5lZCkge1xuICAgIGNhbGxiYWNrID0gcGFyYW1ldGVyczsgLy8vXG4gICAgcGFyYW1ldGVycyA9IHt9O1xuICB9XG5cbiAgY29uc3QgbWV0aG9kID0gR0VUX01FVEhPRCxcbiAgICAgICAgYm9keSA9IHVuZGVmaW5lZDtcblxuICB0aGlzLnJlcXVlc3QoaG9zdCwgdXJpLCBwYXJhbWV0ZXJzLCBtZXRob2QsIGJvZHksIGNhbGxiYWNrKTtcbn1cblxuZnVuY3Rpb24gcG9zdChob3N0LCB1cmksIGpzb24sIHBhcmFtZXRlcnMsIGNhbGxiYWNrKSB7XG4gIGlmIChjYWxsYmFjayA9PT0gdW5kZWZpbmVkKSB7XG4gICAgY2FsbGJhY2sgPSBwYXJhbWV0ZXJzOyAvLy9cbiAgICBwYXJhbWV0ZXJzID0ge307XG4gIH1cblxuICBjb25zdCBtZXRob2QgPSBQT1NUX01FVEhPRCxcbiAgICAgICAgYm9keSA9IEpTT04uc3RyaW5naWZ5KGpzb24pO1xuXG4gIHRoaXMucmVxdWVzdChob3N0LCB1cmksIHBhcmFtZXRlcnMsIG1ldGhvZCwgYm9keSwgY2FsbGJhY2spO1xufVxuXG5mdW5jdGlvbiBvbkVUWChoYW5kbGVyKSB7XG4gIGNvbnN0IHsgc3RkaW4gfSA9IHByb2Nlc3MsXG4gICAgICAgIHsgc2V0UmF3TW9kZSB9ID0gc3RkaW47XG5cbiAgaWYgKHNldFJhd01vZGUpIHtcbiAgICBjb25zdCByYXdNb2RlID0gdHJ1ZSxcbiAgICAgICAgICBlbmNvZGluZyA9ICd1dGY4JztcblxuICAgIHN0ZGluLnNldFJhd01vZGUocmF3TW9kZSk7XG4gICAgc3RkaW4uc2V0RW5jb2RpbmcoZW5jb2RpbmcpO1xuXG4gICAgc3RkaW4ucmVzdW1lKCk7XG5cbiAgICBzdGRpbi5hZGRMaXN0ZW5lcignZGF0YScsIGRhdGFIYW5kbGVyKTtcblxuICAgIHJldHVybiBvZmZFeHQ7XG4gIH1cblxuICBmdW5jdGlvbiBvZmZFeHQoKSB7XG4gICAgc3RkaW4ucmVtb3ZlTGlzdGVuZXIoJ2RhdGEnLCBkYXRhSGFuZGxlcik7XG4gIH1cblxuICBmdW5jdGlvbiBkYXRhSGFuZGxlcihjaGFyYWN0ZXIpIHtcbiAgICBpZiAoY2hhcmFjdGVyID09PSBFVFhfQ0hBUkFDVEVSKSB7XG4gICAgICBoYW5kbGVyKCk7XG4gICAgfVxuICB9XG59XG5cbm1vZHVsZS5leHBvcnRzID0ge1xuICBnZXQ6IGdldCxcbiAgcG9zdDogcG9zdCxcbiAgb25FVFg6IG9uRVRYXG59O1xuXG5mdW5jdGlvbiByZXF1ZXN0KGhvc3QsIHVyaSwgcGFyYW1ldGVycywgbWV0aG9kLCBib2R5LCBjYWxsYmFjaykge1xuICBjb25zdCB1cmwgPSB1cmxGcm9tSG9zdFVSSUFuZFBhcmFtZXRlcnMoaG9zdCwgdXJpLCBwYXJhbWV0ZXJzKSxcbiAgICAgICAgeG1sSHR0cFJlcXVlc3QgPSBuZXcgWE1MSHR0cFJlcXVlc3QoKTtcblxuICB4bWxIdHRwUmVxdWVzdC5vbnJlYWR5c3RhdGVjaGFuZ2UgPSBmdW5jdGlvbigpIHtcbiAgICBjb25zdCB7IHJlYWR5U3RhdGUsIHN0YXR1cywgcmVzcG9uc2VUZXh0IH0gPSB4bWxIdHRwUmVxdWVzdDtcblxuICAgIGlmIChyZWFkeVN0YXRlID09IDQpIHtcbiAgICAgIGlmIChzdGF0dXMgPT0gMjAwKSB7XG4gICAgICAgIGNvbnN0IGpzb25TdHJpbmcgPSByZXNwb25zZVRleHQsIC8vL1xuICAgICAgICAgICAgICBqc29uID0gSlNPTi5wYXJzZShqc29uU3RyaW5nKTtcblxuICAgICAgICBjYWxsYmFjayhqc29uKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGNhbGxiYWNrKG51bGwpO1xuICAgICAgfVxuICAgIH1cbiAgfTtcblxuICB4bWxIdHRwUmVxdWVzdC5vcGVuKG1ldGhvZCwgdXJsLCB0cnVlKTtcblxuICB4bWxIdHRwUmVxdWVzdC5zZXRSZXF1ZXN0SGVhZGVyKCdDb250ZW50LVR5cGUnLCAnYXBwbGljYXRpb24vanNvbicpO1xuXG4gIHhtbEh0dHBSZXF1ZXN0LnNlbmQoYm9keSk7XG59XG5cbiJdfQ==