'use strict';

var GET_METHOD = 'GET',
    POST_METHOD = 'POST',
    ETX_CHARACTER = '\x03';

function get(host, uri, parameters, callback) {
  if (callback === undefined) {
    callback = parameters; ///
    parameters = {};
  }

  var method = GET_METHOD,
      body = undefined;

  request(host, uri, parameters, method, body, callback);
}

function post(host, uri, json, parameters, callback) {
  if (callback === undefined) {
    callback = parameters; ///
    parameters = {};
  }

  var method = POST_METHOD,
      body = JSON.stringify(json);

  request(host, uri, parameters, method, body, callback);
}

function onETX(handler) {
  var _process = process,
      stdin = _process.stdin,
      setRawMode = stdin.setRawMode;


  if (setRawMode) {
    var rawMode = true,
        encoding = 'utf8';

    stdin.setRawMode(rawMode);
    stdin.setEncoding(encoding);

    stdin.resume();

    stdin.addListener('data', dataHandler);

    return offExt;
  }

  function offExt() {
    stdin.removeListener('data', dataHandler);
  }

  function dataHandler(character) {
    if (character === ETX_CHARACTER) {
      handler();
    }
  }
}

module.exports = {
  get: get,
  post: post,
  onETX: onETX
};

function request(host, uri, parameters, method, body, callback) {
  var url = urlFromHostURIAndParameters(host, uri, parameters),
      xmlHttpRequest = new XMLHttpRequest();

  xmlHttpRequest.onreadystatechange = function () {
    var readyState = xmlHttpRequest.readyState,
        status = xmlHttpRequest.status,
        responseText = xmlHttpRequest.responseText;


    if (readyState == 4) {
      if (status == 200) {
        var jsonString = responseText,
            ///
        json = JSON.parse(jsonString);

        callback(json);
      } else {
        callback(null);
      }
    }
  };

  xmlHttpRequest.open(method, url, true);

  xmlHttpRequest.send(body);
}

function urlFromHostURIAndParameters(host, uri, parameters) {
  var queryString = queryStringFromParameters(parameters),
      url = queryString === '' ? host + '/' + uri : host + '/' + uri + '?' + queryString;

  return url;
}

function queryStringFromParameters(parameters) {
  var names = Object.keys(parameters),
      namesLength = names.length,
      lastIndex = namesLength - 1,
      queryString = names.reduce(function (queryString, name, index) {
    var value = parameters[name],
        encodedName = encodeURIComponent(name),
        encodedValue = encodeURIComponent(value),
        ampersandOrNothing = index !== lastIndex ? '&' : '';

    queryString += encodedName + '=' + encodedValue + ampersandOrNothing;

    return queryString;
  }, '');

  return queryString;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL2VzNi91dGlsaXRpZXMvbWlzY2VsbGFuZW91cy5qcyJdLCJuYW1lcyI6WyJHRVRfTUVUSE9EIiwiUE9TVF9NRVRIT0QiLCJFVFhfQ0hBUkFDVEVSIiwiZ2V0IiwiaG9zdCIsInVyaSIsInBhcmFtZXRlcnMiLCJjYWxsYmFjayIsInVuZGVmaW5lZCIsIm1ldGhvZCIsImJvZHkiLCJyZXF1ZXN0IiwicG9zdCIsImpzb24iLCJKU09OIiwic3RyaW5naWZ5Iiwib25FVFgiLCJoYW5kbGVyIiwicHJvY2VzcyIsInN0ZGluIiwic2V0UmF3TW9kZSIsInJhd01vZGUiLCJlbmNvZGluZyIsInNldEVuY29kaW5nIiwicmVzdW1lIiwiYWRkTGlzdGVuZXIiLCJkYXRhSGFuZGxlciIsIm9mZkV4dCIsInJlbW92ZUxpc3RlbmVyIiwiY2hhcmFjdGVyIiwibW9kdWxlIiwiZXhwb3J0cyIsInVybCIsInVybEZyb21Ib3N0VVJJQW5kUGFyYW1ldGVycyIsInhtbEh0dHBSZXF1ZXN0IiwiWE1MSHR0cFJlcXVlc3QiLCJvbnJlYWR5c3RhdGVjaGFuZ2UiLCJyZWFkeVN0YXRlIiwic3RhdHVzIiwicmVzcG9uc2VUZXh0IiwianNvblN0cmluZyIsInBhcnNlIiwib3BlbiIsInNlbmQiLCJxdWVyeVN0cmluZyIsInF1ZXJ5U3RyaW5nRnJvbVBhcmFtZXRlcnMiLCJuYW1lcyIsIk9iamVjdCIsImtleXMiLCJuYW1lc0xlbmd0aCIsImxlbmd0aCIsImxhc3RJbmRleCIsInJlZHVjZSIsIm5hbWUiLCJpbmRleCIsInZhbHVlIiwiZW5jb2RlZE5hbWUiLCJlbmNvZGVVUklDb21wb25lbnQiLCJlbmNvZGVkVmFsdWUiLCJhbXBlcnNhbmRPck5vdGhpbmciXSwibWFwcGluZ3MiOiJBQUFBOztBQUVBLElBQU1BLGFBQWEsS0FBbkI7QUFBQSxJQUNNQyxjQUFjLE1BRHBCO0FBQUEsSUFFTUMsZ0JBQWdCLE1BRnRCOztBQUlBLFNBQVNDLEdBQVQsQ0FBYUMsSUFBYixFQUFtQkMsR0FB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QUFDRDs7QUFFRCxTQUFTdUIsMkJBQVQsQ0FBcUM3QixJQUFyQyxFQUEyQ0MsR0FBM0MsRUFBZ0RDLFVBQWhELEVBQTREO0FBQzFELE1BQU1zQyxjQUFjQywwQkFBMEJ2QyxVQUExQixDQUFwQjtBQUFBLE1BQ00wQixNQUFPWSxnQkFBZ0IsRUFBakIsR0FDS3hDLElBREwsU0FDYUMsR0FEYixHQUVPRCxJQUZQLFNBRWVDLEdBRmYsU0FFc0J1QyxXQUhsQzs7QUFLQSxTQUFPWixHQUFQO0FBQ0Q7O0FBRUQsU0FBU2EseUJBQVQsQ0FBbUN2QyxVQUFuQyxFQUErQztBQUM3QyxNQUFNd0MsUUFBUUMsT0FBT0MsSUFBUCxDQUFZMUMsVUFBWixDQUFkO0FBQUEsTUFDTTJDLGNBQWNILE1BQU1JLE1BRDFCO0FBQUEsTUFFTUMsWUFBWUYsY0FBYyxDQUZoQztBQUFBLE1BR01MLGNBQWNFLE1BQU1NLE1BQU4sQ0FBYSxVQUFTUixXQUFULEVBQXNCUyxJQUF0QixFQUE0QkMsS0FBNUIsRUFBbUM7QUFDNUQsUUFBTUMsUUFBUWpELFdBQVcrQyxJQUFYLENBQWQ7QUFBQSxRQUNNRyxjQUFjQyxtQkFBbUJKLElBQW5CLENBRHBCO0FBQUEsUUFFTUssZUFBZUQsbUJBQW1CRixLQUFuQixDQUZyQjtBQUFBLFFBR01JLHFCQUFzQkwsVUFBVUgsU0FBWCxHQUF3QixHQUF4QixHQUE4QixFQUh6RDs7QUFLQVAsbUJBQWtCWSxXQUFsQixTQUFpQ0UsWUFBakMsR0FBZ0RDLGtCQUFoRDs7QUFFQSxXQUFPZixXQUFQO0FBQ0QsR0FUYSxFQVNYLEVBVFcsQ0FIcEI7O0FBY0EsU0FBT0EsV0FBUDtBQUNEIiwiZmlsZSI6Im1pc2NlbGxhbmVvdXMuanMiLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIHN0cmljdCc7XG5cbmNvbnN0IEdFVF9NRVRIT0QgPSAnR0VUJyxcbiAgICAgIFBPU1RfTUVUSE9EID0gJ1BPU1QnLFxuICAgICAgRVRYX0NIQVJBQ1RFUiA9ICdcXHUwMDAzJztcblxuZnVuY3Rpb24gZ2V0KGhvc3QsIHVyaSwgcGFyYW1ldGVycywgY2FsbGJhY2spIHtcbiAgaWYgKGNhbGxiYWNrID09PSB1bmRlZmluZWQpIHtcbiAgICBjYWxsYmFjayA9IHBhcmFtZXRlcnM7IC8vL1xuICAgIHBhcmFtZXRlcnMgPSB7fTtcbiAgfVxuXG4gIGNvbnN0IG1ldGhvZCA9IEdFVF9NRVRIT0QsXG4gICAgICAgIGJvZHkgPSB1bmRlZmluZWQ7XG5cbiAgcmVxdWVzdChob3N0LCB1cmksIHBhcmFtZXRlcnMsIG1ldGhvZCwgYm9keSwgY2FsbGJhY2spO1xufVxuXG5mdW5jdGlvbiBwb3N0KGhvc3QsIHVyaSwganNvbiwgcGFyYW1ldGVycywgY2FsbGJhY2spIHtcbiAgaWYgKGNhbGxiYWNrID09PSB1bmRlZmluZWQpIHtcbiAgICBjYWxsYmFjayA9IHBhcmFtZXRlcnM7IC8vL1xuICAgIHBhcmFtZXRlcnMgPSB7fTtcbiAgfVxuXG4gIGNvbnN0IG1ldGhvZCA9IFBPU1RfTUVUSE9ELFxuICAgICAgICBib2R5ID0gSlNPTi5zdHJpbmdpZnkoanNvbik7XG5cbiAgcmVxdWVzdChob3N0LCB1cmksIHBhcmFtZXRlcnMsIG1ldGhvZCwgYm9keSwgY2FsbGJhY2spO1xufVxuXG5mdW5jdGlvbiBvbkVUWChoYW5kbGVyKSB7XG4gIGNvbnN0IHsgc3RkaW4gfSA9IHByb2Nlc3MsXG4gICAgICAgIHsgc2V0UmF3TW9kZSB9ID0gc3RkaW47XG5cbiAgaWYgKHNldFJhd01vZGUpIHtcbiAgICBjb25zdCByYXdNb2RlID0gdHJ1ZSxcbiAgICAgICAgICBlbmNvZGluZyA9ICd1dGY4JztcblxuICAgIHN0ZGluLnNldFJhd01vZGUocmF3TW9kZSk7XG4gICAgc3RkaW4uc2V0RW5jb2RpbmcoZW5jb2RpbmcpO1xuXG4gICAgc3RkaW4ucmVzdW1lKCk7XG5cbiAgICBzdGRpbi5hZGRMaXN0ZW5lcignZGF0YScsIGRhdGFIYW5kbGVyKTtcblxuICAgIHJldHVybiBvZmZFeHQ7XG4gIH1cblxuICBmdW5jdGlvbiBvZmZFeHQoKSB7XG4gICAgc3RkaW4ucmVtb3ZlTGlzdGVuZXIoJ2RhdGEnLCBkYXRhSGFuZGxlcik7XG4gIH1cblxuICBmdW5jdGlvbiBkYXRhSGFuZGxlcihjaGFyYWN0ZXIpIHtcbiAgICBpZiAoY2hhcmFjdGVyID09PSBFVFhfQ0hBUkFDVEVSKSB7XG4gICAgICBoYW5kbGVyKCk7XG4gICAgfVxuICB9XG59XG5cbm1vZHVsZS5leHBvcnRzID0ge1xuICBnZXQ6IGdldCxcbiAgcG9zdDogcG9zdCxcbiAgb25FVFg6IG9uRVRYXG59O1xuXG5mdW5jdGlvbiByZXF1ZXN0KGhvc3QsIHVyaSwgcGFyYW1ldGVycywgbWV0aG9kLCBib2R5LCBjYWxsYmFjaykge1xuICBjb25zdCB1cmwgPSB1cmxGcm9tSG9zdFVSSUFuZFBhcmFtZXRlcnMoaG9zdCwgdXJpLCBwYXJhbWV0ZXJzKSxcbiAgICAgICAgeG1sSHR0cFJlcXVlc3QgPSBuZXcgWE1MSHR0cFJlcXVlc3QoKTtcblxuICB4bWxIdHRwUmVxdWVzdC5vbnJlYWR5c3RhdGVjaGFuZ2UgPSBmdW5jdGlvbigpIHtcbiAgICBjb25zdCB7IHJlYWR5U3RhdGUsIHN0YXR1cywgcmVzcG9uc2VUZXh0IH0gPSB4bWxIdHRwUmVxdWVzdDtcblxuICAgIGlmIChyZWFkeVN0YXRlID09IDQpIHtcbiAgICAgIGlmIChzdGF0dXMgPT0gMjAwKSB7XG4gICAgICAgIGNvbnN0IGpzb25TdHJpbmcgPSByZXNwb25zZVRleHQsIC8vL1xuICAgICAgICAgICAgICBqc29uID0gSlNPTi5wYXJzZShqc29uU3RyaW5nKTtcblxuICAgICAgICBjYWxsYmFjayhqc29uKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGNhbGxiYWNrKG51bGwpO1xuICAgICAgfVxuICAgIH1cbiAgfTtcblxuICB4bWxIdHRwUmVxdWVzdC5vcGVuKG1ldGhvZCwgdXJsLCB0cnVlKTtcblxuICB4bWxIdHRwUmVxdWVzdC5zZW5kKGJvZHkpO1xufVxuXG5mdW5jdGlvbiB1cmxGcm9tSG9zdFVSSUFuZFBhcmFtZXRlcnMoaG9zdCwgdXJpLCBwYXJhbWV0ZXJzKSB7XG4gIGNvbnN0IHF1ZXJ5U3RyaW5nID0gcXVlcnlTdHJpbmdGcm9tUGFyYW1ldGVycyhwYXJhbWV0ZXJzKSxcbiAgICAgICAgdXJsID0gKHF1ZXJ5U3RyaW5nID09PSAnJykgP1xuICAgICAgICAgICAgICAgIGAke2hvc3R9LyR7dXJpfWAgOlxuICAgICAgICAgICAgICAgICAgYCR7aG9zdH0vJHt1cml9PyR7cXVlcnlTdHJpbmd9YDtcblxuICByZXR1cm4gdXJsO1xufVxuXG5mdW5jdGlvbiBxdWVyeVN0cmluZ0Zyb21QYXJhbWV0ZXJzKHBhcmFtZXRlcnMpIHtcbiAgY29uc3QgbmFtZXMgPSBPYmplY3Qua2V5cyhwYXJhbWV0ZXJzKSxcbiAgICAgICAgbmFtZXNMZW5ndGggPSBuYW1lcy5sZW5ndGgsXG4gICAgICAgIGxhc3RJbmRleCA9IG5hbWVzTGVuZ3RoIC0gMSxcbiAgICAgICAgcXVlcnlTdHJpbmcgPSBuYW1lcy5yZWR1Y2UoZnVuY3Rpb24ocXVlcnlTdHJpbmcsIG5hbWUsIGluZGV4KSB7XG4gICAgICAgICAgY29uc3QgdmFsdWUgPSBwYXJhbWV0ZXJzW25hbWVdLFxuICAgICAgICAgICAgICAgIGVuY29kZWROYW1lID0gZW5jb2RlVVJJQ29tcG9uZW50KG5hbWUpLFxuICAgICAgICAgICAgICAgIGVuY29kZWRWYWx1ZSA9IGVuY29kZVVSSUNvbXBvbmVudCh2YWx1ZSksXG4gICAgICAgICAgICAgICAgYW1wZXJzYW5kT3JOb3RoaW5nID0gKGluZGV4ICE9PSBsYXN0SW5kZXgpID8gJyYnIDogJyc7XG5cbiAgICAgICAgICBxdWVyeVN0cmluZyArPSBgJHtlbmNvZGVkTmFtZX09JHtlbmNvZGVkVmFsdWV9JHthbXBlcnNhbmRPck5vdGhpbmd9YDtcblxuICAgICAgICAgIHJldHVybiBxdWVyeVN0cmluZztcbiAgICAgICAgfSwgJycpO1xuXG4gIHJldHVybiBxdWVyeVN0cmluZztcbn1cbiJdfQ==